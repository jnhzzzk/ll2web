<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能诊断标签卡片弹窗示例</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#309C9F',
                        'primary-light': '#e6f1f1',
                        'primary-dark': '#256e70',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h1 class="text-2xl font-bold text-gray-900 mb-6">智能诊断标签卡片弹窗示例</h1>
        
        <div class="bg-white rounded-lg shadow-sm p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">智能诊断标签</h2>
            <div class="flex flex-col space-y-3" id="diagnosticTags">
                <!-- 诊断标签会通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 返回按钮 -->
        <div class="mt-6">
            <a href="/cn/diagnostic.html" class="inline-flex items-center bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-md text-sm transition-colors duration-200">
                <i class="fas fa-arrow-left mr-1"></i> 返回诊断分析页面
            </a>
        </div>
    </div>
    
    <!-- 诊断标签详情弹窗 -->
    <div id="tagDetailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-3xl max-h-[90vh] overflow-auto">
            <div class="px-5 py-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white">
                <h2 id="tagModalTitle" class="text-lg font-medium text-gray-900">标签详情</h2>
                <button id="closeTagModal" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="tagModalContent" class="p-5">
                <!-- 弹窗内容将由JS动态生成 -->
            </div>
        </div>
    </div>
    
    <script>
        // 诊断标签数据
        const diagnosticTags = {
            // 长期高损标签
            'long-high': [
                {
                    title: 'CT互感器倍率错误',
                    probability: '92%',
                    icon: 'exclamation-triangle',
                    color: 'red'
                },
                {
                    title: '档案户变关系异常',
                    probability: '68%',
                    icon: 'file-alt',
                    color: 'orange'
                },
                {
                    title: '疑似低压窃电',
                    probability: '45%',
                    icon: 'bolt',
                    color: 'yellow'
                },
                {
                    title: '采集设备故障',
                    probability: '38%',
                    icon: 'wifi',
                    color: 'blue'
                },
                {
                    title: '电能表超容量运行',
                    probability: '30%',
                    icon: 'tachometer-alt',
                    color: 'green'
                },
                {
                    title: '三相不平衡度高',
                    probability: '25%',
                    icon: 'balance-scale',
                    color: 'purple'
                }
            ],
            
            // 突发高损标签
            'sudden-high': [
                {
                    title: '用电负荷突增',
                    probability: '87%',
                    icon: 'bolt',
                    color: 'red'
                },
                {
                    title: '低压设备故障',
                    probability: '65%',
                    icon: 'exclamation-triangle',
                    color: 'orange'
                },
                {
                    title: '新增用户接入异常',
                    probability: '52%',
                    icon: 'user-plus',
                    color: 'yellow'
                },
                {
                    title: '恶劣天气引发问题',
                    probability: '48%',
                    icon: 'cloud-rain',
                    color: 'blue'
                },
                {
                    title: '短时漏电故障',
                    probability: '35%',
                    icon: 'tint',
                    color: 'green'
                }
            ],
            
            // 长期负损标签
            'long-negative': [
                {
                    title: '计量装置接线错误',
                    probability: '94%',
                    icon: 'plug',
                    color: 'red'
                },
                {
                    title: '电表正反向接错',
                    probability: '78%',
                    icon: 'exchange-alt',
                    color: 'orange'
                },
                {
                    title: '台户关系不一致',
                    probability: '63%',
                    icon: 'file-alt',
                    color: 'yellow'
                },
                {
                    title: '光伏发电档案错误',
                    probability: '42%',
                    icon: 'solar-panel',
                    color: 'blue'
                },
                {
                    title: '台区总表前接电',
                    probability: '38%',
                    icon: 'plug',
                    color: 'green'
                }
            ],
            
            // 小负损标签
            'small-negative': [
                {
                    title: '理论模型计算偏差',
                    probability: '89%',
                    icon: 'calculator',
                    color: 'red'
                },
                {
                    title: '采集数据偏差',
                    probability: '72%',
                    icon: 'database',
                    color: 'orange'
                },
                {
                    title: '互感器配置不合理',
                    probability: '58%',
                    icon: 'cogs',
                    color: 'yellow'
                },
                {
                    title: '电表时钟超差',
                    probability: '45%',
                    icon: 'clock',
                    color: 'blue'
                },
                {
                    title: '供电半径过长',
                    probability: '35%',
                    icon: 'ruler',
                    color: 'green'
                }
            ],
            
            // 突发负损标签
            'sudden-negative': [
                {
                    title: '电表计量故障',
                    probability: '91%',
                    icon: 'tachometer-alt',
                    color: 'red'
                },
                {
                    title: '功率因数补偿设备异常',
                    probability: '79%',
                    icon: 'bolt',
                    color: 'orange'
                },
                {
                    title: '台区总表某相异常',
                    probability: '64%',
                    icon: 'exclamation-triangle',
                    color: 'yellow'
                },
                {
                    title: '倍率变更未同步',
                    probability: '58%',
                    icon: 'sync',
                    color: 'blue'
                },
                {
                    title: '联合接线盒故障',
                    probability: '35%',
                    icon: 'box',
                    color: 'green'
                }
            ]
        };
        
        // 当前显示的异常类型
        let currentType = 'long-high';
        
        // 显示标签
        function renderTags(type) {
            currentType = type;
            const tagContainer = document.getElementById('diagnosticTags');
            tagContainer.innerHTML = '';
            
            // 添加标题
            const titleMap = {
                'long-high': '长期高损诊断标签',
                'sudden-high': '突发高损诊断标签',
                'long-negative': '长期负损诊断标签',
                'small-negative': '小负损诊断标签',
                'sudden-negative': '突发负损诊断标签'
            };
            
            const titleElement = document.createElement('h2');
            titleElement.className = 'text-lg font-medium text-gray-900 mb-4';
            titleElement.textContent = titleMap[type];
            tagContainer.appendChild(titleElement);
            
            // 添加切换按钮
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'flex flex-wrap gap-2 mb-4';
            
            Object.keys(titleMap).forEach(key => {
                const button = document.createElement('button');
                button.className = `px-3 py-1 rounded text-sm ${key === type ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`;
                button.textContent = titleMap[key];
                button.addEventListener('click', () => renderTags(key));
                buttonsContainer.appendChild(button);
            });
            
            tagContainer.appendChild(buttonsContainer);
            
            // 添加标签
            const tagsContainer = document.createElement('div');
            tagsContainer.className = 'flex flex-col space-y-3';
            
            diagnosticTags[type].forEach((tag, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = `flex items-center p-3 bg-${tag.color}-50 border border-${tag.color}-100 rounded-lg cursor-pointer hover:shadow-md transition-shadow`;
                tagElement.innerHTML = `
                    <div class="flex-shrink-0 h-10 w-10 flex items-center justify-center bg-${tag.color}-100 rounded-full">
                        <i class="fas fa-${tag.icon} text-${tag.color}-500"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-${tag.color}-800">${tag.title}</h3>
                        <p class="text-xs text-${tag.color}-700 mt-1">匹配概率：${tag.probability}</p>
                    </div>
                `;
                tagElement.addEventListener('click', () => showTagDetail(type, index));
                tagsContainer.appendChild(tagElement);
            });
            
            tagContainer.appendChild(tagsContainer);
        }
        
        // 显示标签详情弹窗
        function showTagDetail(type, tagIndex) {
            const tagData = diagnosticTags[type][tagIndex];
            const modal = document.getElementById('tagDetailModal');
            const modalTitle = document.getElementById('tagModalTitle');
            const modalContent = document.getElementById('tagModalContent');
            
            // 设置标题
            modalTitle.textContent = tagData.title;
            
            // 设置弹窗内容
            modalContent.innerHTML = '';
            
            // 针对CT互感器倍率错误标签显示特殊内容
            if (type === 'long-high' && tagData.title === 'CT互感器倍率错误') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">交互式排查工具</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="col-span-1">
                                <p class="text-xs text-gray-500 mb-1">调整CT倍率</p>
                                <div class="flex rounded-md shadow-sm">
                                    <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">当前</span>
                                    <input type="text" value="300/5" class="flex-1 min-w-0 block w-full px-3 py-1.5 rounded-none border border-gray-300 focus:ring-primary focus:border-primary text-sm">
                                    <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">A</span>
                                </div>
                                <div class="mt-2">
                                    <select class="block w-full pl-3 pr-10 py-1.5 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                        <option>模拟修正为 150/5 A</option>
                                        <option>模拟修正为 200/5 A</option>
                                        <option selected>模拟修正为 250/5 A</option>
                                        <option>模拟修正为 400/5 A</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-span-2">
                                <p class="text-xs text-gray-500 mb-1">修正后线损预测</p>
                                <div class="flex h-20 items-center">
                                    <div class="flex-1 flex items-center space-x-2">
                                        <div class="h-16 w-16 rounded-full bg-primary flex items-center justify-center text-white text-xl font-bold">
                                            6.51%
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">修正后预计线损率</p>
                                            <p class="text-xs text-green-500 font-medium mt-1">与理论线损偏差: +0.19%</p>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="relative w-full h-4 bg-gray-200 rounded">
                                            <div class="absolute h-4 bg-primary rounded" style="width: 21.7%;"></div>
                                        </div>
                                        <div class="flex justify-between mt-1 text-xs text-gray-500">
                                            <span>0%</span>
                                            <span>6.51%</span>
                                            <span>30%</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">线损率降低了 <span class="text-green-500 font-medium">6.25%</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>系统记录CT变比为<span class="text-red-500 font-medium">300/5</span>，但实际铭牌为<span class="text-primary font-medium">250/5</span></li>
                                <li>CT变比错误导致计量电流值偏低，计算得到的线损率偏高</li>
                                <li>修正变比后，线损率从<span class="text-red-500 font-medium">12.76%</span>降至<span class="text-green-500 font-medium">6.51%</span></li>
                                <li>修正后线损率与理论线损率<span class="text-primary font-medium">6.32%</span>相近，符合正常水平</li>
                            </ul>
                        </div>
                        <div class="mt-4 bg-green-50 p-3 rounded-md border border-green-100">
                            <p class="text-sm font-medium text-green-800 mb-1">治理建议</p>
                            <ol class="text-xs text-green-700 list-decimal pl-4">
                                <li>核实现场CT互感器实际型号，检查铭牌信息</li>
                                <li>修正系统中CT变比参数设置</li>
                                <li>校验电能计量装置，确保计量准确</li>
                                <li>建立计量设备档案更新机制，确保参数变更同步更新</li>
                            </ol>
                        </div>
                    </div>
                `;
            }
            
            // 针对三相不平衡度高标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '三相不平衡度高') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">三相不平衡度分析</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500">三相不平衡度</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">17.3%</span>
                                    <span class="text-xs text-gray-500 ml-1">(本台区)</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">12.1%</span>
                                    <span class="text-xs text-gray-500 ml-1">(对比组)</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">功率因数</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-primary rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">0.92</span>
                                    <span class="text-xs text-gray-500 ml-1">(本台区)</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">0.94</span>
                                    <span class="text-xs text-gray-500 ml-1">(对比组)</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 h-60">
                            <canvas id="phaseBalanceChartModal"></canvas>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>本台区三相不平衡度为<span class="text-yellow-500 font-medium">17.3%</span>，高于系统警戒值15%</li>
                                <li>A相和C相电流过高，B相电流明显偏低</li>
                                <li>三相不平衡会导致零序电流增大，引起额外线损</li>
                                <li>建议进行三相负荷均衡调整，优化配电侧运行效率</li>
                            </ul>
                        </div>
                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>检查三相负荷分布情况，调整单相负荷接入相位</li>
                                <li>排查B相接触不良或连接松动问题</li>
                                <li>监控三相负荷动态变化，适时调整</li>
                                <li>检查零线连接情况，确保接触良好</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const phaseCtx = document.getElementById('phaseBalanceChartModal').getContext('2d');
                    const phaseBalanceChartModal = new Chart(phaseCtx, {
                        type: 'bar',
                        data: {
                            labels: ['A相', 'B相', 'C相'],
                            datasets: [
                                {
                                    label: '本台区',
                                    data: [145, 98, 162],
                                    backgroundColor: '#309C9F',
                                },
                                {
                                    label: '对比组',
                                    data: [125, 118, 142],
                                    backgroundColor: '#9ca3af',
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: '电流 (A)'
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对用电负荷突增标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '用电负荷突增') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">线损率季节性变化</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500">本季度平均线损率</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">11.95%</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">去年同期平均线损率</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">6.48%</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 h-60">
                            <canvas id="seasonalLossChartModal"></canvas>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区线损率在近期内出现突然上升，从<span class="text-primary font-medium">6.2%</span>突增至<span class="text-red-500 font-medium">11.95%</span></li>
                                <li>分析近期负荷变化，发现<span class="text-red-500 font-medium">4月28日</span>起负荷增长了<span class="text-red-500 font-medium">32.6%</span></li>
                                <li>负荷突增程度超过理论线损模型的适用范围，导致实际线损与理论线损偏差增大</li>
                                <li>季节性因素分析显示，去年同期无类似突增现象，提示本次突增不属于季节性规律变化</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">关键节点分析</h3>
                            <div class="relative">
                                <div class="absolute h-full w-1 bg-gray-200 left-2.5 top-0"></div>
                                <div class="space-y-4 relative">
                                    <div class="flex items-start">
                                        <div class="h-5 w-5 rounded-full bg-red-500 flex-shrink-0 z-10"></div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-800">2023年4月28日</p>
                                            <p class="text-xs text-gray-600">线损率突然从6.2%上升至11.8%，同时用电负荷大幅增加</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="h-5 w-5 rounded-full bg-primary flex-shrink-0 z-10"></div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-800">2023年4月30日</p>
                                            <p class="text-xs text-gray-600">现场排查发现季节性空调设备大量启用</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="h-5 w-5 rounded-full bg-gray-400 flex-shrink-0 z-10"></div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-800">2022年同期</p>
                                            <p class="text-xs text-gray-600">线损率稳定在6.3%~6.5%之间，属于正常范围</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-orange-50 p-3 rounded-md border border-orange-100">
                            <p class="text-sm font-medium text-orange-800 mb-1">治理建议</p>
                            <ol class="text-xs text-orange-700 list-decimal pl-4">
                                <li>评估台区负荷增长趋势，必要时及时进行增容改造</li>
                                <li>调整线损计算模型参数，适应负荷突增情况</li>
                                <li>巡查台区设备运行状态，确保大负荷下安全运行</li>
                                <li>分析用户用电构成，实行错峰用电指导</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const seasonalCtx = document.getElementById('seasonalLossChartModal').getContext('2d');
                    const seasonalLossChartModal = new Chart(seasonalCtx, {
                        type: 'line',
                        data: {
                            labels: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                            datasets: [
                                {
                                    label: '今年',
                                    data: [6.3, 6.2, 6.1, 11.9, null, null, null, null, null, null, null, null],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '去年',
                                    data: [6.5, 6.4, 6.5, 6.5, 6.4, 6.3, 6.2, 6.4, 6.5, 6.7, 6.8, 6.6],
                                    borderColor: '#9ca3af',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    min: 4,
                                    max: 14,
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对档案户变关系异常标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '档案户变关系异常') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">户变关系信息</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500">台区总表采集</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-primary rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">1/1</span>
                                    <span class="text-xs text-gray-500 ml-1">(100%)</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">用户表采集</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">145/165</span>
                                    <span class="text-xs text-gray-500 ml-1">(87.9%)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">档案户变一致性分析</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">异常</span>
                            </div>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="border-r pr-2">
                                        <p class="text-xs text-gray-500">系统档案记录</p>
                                        <p class="text-sm font-medium mt-1">165个用户表</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">GIS识别结果</p>
                                        <p class="text-sm font-medium mt-1">193个用户表</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">空间距离异常</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">28个表</span>
                            </div>
                            <div class="h-60 mt-3">
                                <canvas id="distanceChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>系统档案记录<span class="text-primary font-medium">165</span>个用户表，但GIS空间识别到<span class="text-red-500 font-medium">193</span>个</li>
                                <li>存在<span class="text-red-500 font-medium">28个</span>用户表距离台区变压器超过<span class="text-red-500 font-medium">300米</span></li>
                                <li>通过电压相关性分析，发现<span class="text-red-500 font-medium">12个</span>表与本台区电压特征不符</li>
                                <li>系统户变关系档案可能存在错误，导致实际供电与计量不一致</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">异常户表清单</h3>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">表号</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">距离</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">疑似归属</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21025367</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">415m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853421台区</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21037842</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">368m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">A相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853428台区</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21041253</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">391m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853421台区</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21039685</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">325m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">A相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853428台区</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bg-gray-50 px-3 py-1.5 text-xs text-gray-500 text-center">
                                    显示前4条 (共28条异常记录)
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-blue-50 p-3 rounded-md border border-blue-100">
                            <p class="text-sm font-medium text-blue-800 mb-1">治理建议</p>
                            <ol class="text-xs text-blue-700 list-decimal pl-4">
                                <li>开展现场实地测绘，核实用户表归属关系</li>
                                <li>调整系统档案记录，修正户变关系数据</li>
                                <li>对疑似归属错误的电表，进行专项抄表核实</li>
                                <li>建立户变关系定期核查机制，确保档案数据准确性</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const distCtx = document.getElementById('distanceChartModal').getContext('2d');
                    const distanceChartModal = new Chart(distCtx, {
                        type: 'scatter',
                        data: {
                            datasets: [
                                {
                                    label: '正常户表',
                                    data: [
                                        {x: 95, y: 0.92}, {x: 120, y: 0.91}, {x: 78, y: 0.94},
                                        {x: 105, y: 0.93}, {x: 135, y: 0.88}, {x: 165, y: 0.87},
                                        {x: 205, y: 0.85}, {x: 185, y: 0.86}, {x: 225, y: 0.82},
                                        {x: 175, y: 0.85}, {x: 215, y: 0.83}, {x: 145, y: 0.87},
                                        {x: 235, y: 0.81}, {x: 255, y: 0.80}, {x: 195, y: 0.85},
                                        {x: 265, y: 0.78}, {x: 245, y: 0.80}, {x: 275, y: 0.77},
                                        {x: 215, y: 0.84}, {x: 285, y: 0.76}, {x: 115, y: 0.91}
                                    ],
                                    backgroundColor: '#3b82f6',
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                },
                                {
                                    label: '异常户表',
                                    data: [
                                        {x: 415, y: 0.45}, {x: 368, y: 0.52}, {x: 391, y: 0.49},
                                        {x: 325, y: 0.55}, {x: 435, y: 0.42}, {x: 358, y: 0.53},
                                        {x: 402, y: 0.47}, {x: 382, y: 0.51}, {x: 425, y: 0.44},
                                        {x: 345, y: 0.54}, {x: 372, y: 0.52}, {x: 408, y: 0.46}
                                    ],
                                    backgroundColor: '#ef4444',
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `距离: ${context.parsed.x}m, 电压相关性: ${context.parsed.y}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: '距离台区变压器距离 (米)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 450
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: '电压相关性系数'
                                    },
                                    suggestedMin: 0.4,
                                    suggestedMax: 1
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对疑似低压窃电标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '疑似低压窃电') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">窃电风险指标</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">异常事件数量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">17</span>
                                    <span class="text-xs text-gray-500 ml-1">次/月</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">高于正常水平 (2.5次)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">用电量异常下降</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">-68%</span>
                                    <span class="text-xs text-gray-500 ml-1">环比变化</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">低于历史均值 (±15%)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">负荷曲线异常</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">83%</span>
                                    <span class="text-xs text-gray-500 ml-1">异常度</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">偏离正常模式</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">关键事件记录</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">高频异常</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">发生时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">风险等级</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">强磁场干扰</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-15 23:42</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-297</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">表箱门打开</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-16 02:18</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-291</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">端子盖打开</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-16 02:21</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-289</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流反向</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-16 02:47</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-249</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-3">用电负荷异常分析</h3>
                            <div class="h-60">
                                <canvas id="stealingChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>用户电表在<span class="text-red-500 font-medium">4月15日23:42</span>至<span class="text-red-500 font-medium">4月16日凌晨</span>期间出现多个高风险事件</li>
                                <li>事件包括强磁场干扰、表箱开启、端子盖打开和电流反向，符合典型窃电特征</li>
                                <li>事件发生后，用电量下降<span class="text-red-500 font-medium">68%</span>，与用户历史用电规律严重偏离</li>
                                <li>夜间负荷异常波动，与同类用户负荷曲线差异度达到<span class="text-red-500 font-medium">83%</span></li>
                                <li>综合分析认为该用户存在人为窃电可能性，建议立即现场核查</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>立即派专业抄核人员进行现场检查，重点检查电表接线、表计密封</li>
                                <li>对电能表进行准确性检测，排查是否存在人为干扰计量</li>
                                <li>进行用电量追补测算，复盘分析窃电量</li>
                                <li>联合稽查部门开展联合执法检查，固定证据</li>
                                <li>加装智能防窃电装置，增加远程监控密度</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const stealCtx = document.getElementById('stealingChartModal').getContext('2d');
                    const stealingChartModal = new Chart(stealCtx, {
                        type: 'line',
                        data: {
                            labels: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
                            datasets: [
                                {
                                    label: '当前日期',
                                    data: [1.2, 1.1, 1.0, 0.3, 0.2, 0.3, 0.4, 0.3, 0.2, 0.3, 0.5, 0.6],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '历史同期均值',
                                    data: [1.1, 1.0, 1.1, 1.2, 1.5, 1.8, 2.1, 2.0, 1.7, 1.6, 1.5, 1.3],
                                    borderColor: '#3b82f6',
                                    borderDash: [5, 5],
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '异常事件点',
                                    data: [null, null, 0.3, null, null, null, null, null, null, null, null, null],
                                    borderColor: '#ef4444',
                                    backgroundColor: '#ef4444',
                                    borderWidth: 0,
                                    pointRadius: 6,
                                    pointHoverRadius: 8,
                                    pointStyle: 'triangle'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            if (context.datasetIndex === 2) {
                                                return '异常事件发生点';
                                            }
                                            return `${context.dataset.label}: ${context.parsed.y} kW`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '负荷 (kW)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 2.5
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对电能表超容量运行标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '电能表超容量运行') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">设备运行状态</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">电表额定容量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-gray-700">80</span>
                                    <span class="text-xs text-gray-500 ml-1">A</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-xs text-gray-500">标准配置</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">最大负荷电流</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">97.5</span>
                                    <span class="text-xs text-gray-500 ml-1">A</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超出额定容量 (121.9%)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">过载时长</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">17.3</span>
                                    <span class="text-xs text-gray-500 ml-1">小时/周</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">高风险运行状态</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">负荷走势分析</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">持续上升</span>
                            </div>
                            <div class="h-60">
                                <canvas id="overloadChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">过流告警事件</h3>
                                <span class="text-xs py-1 px-2 bg-orange-100 text-orange-800 rounded-full">频繁</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">发生时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">电流值</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-12 19:35</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-255</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">97.5A</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-11 19:42</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-255</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">96.8A</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">A相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-10 19:28</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-251</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">92.7A</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-09 19:38</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-255</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">95.2A</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>该电表额定容量为<span class="text-primary font-medium">80A</span>，实际最大电流达<span class="text-red-500 font-medium">97.5A</span>，超出额定容量<span class="text-red-500 font-medium">21.9%</span></li>
                                <li>过载运行时间累计达到每周<span class="text-red-500 font-medium">17.3小时</span>，主要发生在晚高峰</li>
                                <li>C相电流值最高，电流过载事件主要集中在C相，提示三相负荷分布不均</li>
                                <li>近一周内电表发生<span class="text-red-500 font-medium">13次</span>过流告警事件，频率呈上升趋势</li>
                                <li>电表长期超负荷运行可能导致计量误差增大、设备损坏和安全风险</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">设备风险评估</h3>
                            </div>
                            <div class="bg-white rounded-lg p-3 border">
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-primary bg-primary-light">
                                                计量误差风险
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-primary">
                                                中等
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 65%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-primary"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                设备损坏风险
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                高风险
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                安全隐患风险
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                高风险
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-green-50 p-3 rounded-md border border-green-100">
                            <p class="text-sm font-medium text-green-800 mb-1">治理建议</p>
                            <ol class="text-xs text-green-700 list-decimal pl-4">
                                <li>更换更大容量的电能表，建议选用100A或150A量程</li>
                                <li>优化三相负荷分布，降低C相负荷比例</li>
                                <li>对用户用电情况进行评估，必要时增容改造</li>
                                <li>安装负荷监测装置，实时监控电表运行状态</li>
                                <li>加强安全巡检，消除设备过热引发的安全隐患</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const overloadCtx = document.getElementById('overloadChartModal').getContext('2d');
                    const overloadChartModal = new Chart(overloadCtx, {
                        type: 'line',
                        data: {
                            labels: ['5-6', '5-7', '5-8', '5-9', '5-10', '5-11', '5-12', '5-13'],
                            datasets: [
                                {
                                    label: 'A相最大电流',
                                    data: [72.3, 75.8, 81.2, 85.7, 92.7, 90.2, 91.5, 90.8],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                },
                                {
                                    label: 'B相最大电流',
                                    data: [68.7, 70.2, 72.6, 74.1, 77.3, 78.9, 81.2, 82.5],
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                },
                                {
                                    label: 'C相最大电流',
                                    data: [78.5, 82.3, 87.9, 95.2, 94.7, 96.8, 97.5, 95.9],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                },
                                {
                                    label: '额定容量',
                                    data: [80, 80, 80, 80, 80, 80, 80, 80],
                                    borderColor: '#9ca3af',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    pointRadius: 0,
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '电流 (A)'
                                    },
                                    suggestedMin: 60,
                                    suggestedMax: 100
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对新增用户接入异常标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '新增用户接入异常') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">台区用户变动监测</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">新增用户数量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-yellow-500">7</span>
                                    <span class="text-xs text-gray-500 ml-1">户</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-yellow-500">较正常月增长183%</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">新增负荷容量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">38.7</span>
                                    <span class="text-xs text-gray-500 ml-1">kW</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">台区总容量的21.5%</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率变化</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">+4.8%</span>
                                    <span class="text-xs text-gray-500 ml-1">绝对值</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">高于预警阈值(2.5%)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">新增用户情况</h3>
                                <span class="text-xs py-1 px-2 bg-yellow-100 text-yellow-800 rounded-full">异常用电特征</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">表号</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">用电类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">接入时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">负荷容量</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253489</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">工业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-22</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">14.5kW</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253492</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">工业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-22</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">12.8kW</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253495</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">工业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-22</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">5.2kW</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253501</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">商业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-23</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">6.2kW</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bg-gray-50 px-3 py-1.5 text-xs text-gray-500 text-center">
                                    显示4条 (共7条记录)
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-3">线损率与用户数变化趋势</h3>
                            <div class="h-60">
                                <canvas id="newUserChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-yellow-500 font-medium">5月22日至23日</span>期间集中新增<span class="text-yellow-500 font-medium">7户</span>用户</li>
                                <li>新增用户中工业用电比例高达<span class="text-red-500 font-medium">71.4%</span>，与台区现有用户结构不符</li>
                                <li>新增容量<span class="text-red-500 font-medium">38.7kW</span>，占台区总容量的<span class="text-red-500 font-medium">21.5%</span>，已超过台区剩余容量</li>
                                <li>线损率在新增用户接入后<span class="text-red-500 font-medium">急剧攀升</span>，从6.3%上升至11.1%</li>
                                <li>新增接入用户中<span class="text-red-500 font-medium">未进行负荷测算和容量评估</span>，导致台区重载运行</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">异常识别</h3>
                            </div>
                            <div class="bg-white rounded-lg p-3 border">
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                用户接入规范性
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                严重不规范
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                台区负荷水平
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                超载运行
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 90%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-500 bg-yellow-100">
                                                线损异常指数
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-yellow-500">
                                                高度异常
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 75%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>对新增用户开展负荷测算和验收检查，确保接入规范性</li>
                                <li>调整台区负荷分布，必要时分流部分用户至相邻台区</li>
                                <li>开展台区增容改造评估，加装无功补偿装置</li>
                                <li>完善新用户接入流程管理，规范负荷评估和容量验证</li>
                                <li>重点监测工业用户负荷特性，避免低质量用电影响线损指标</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const newUserCtx = document.getElementById('newUserChartModal').getContext('2d');
                    const newUserChartModal = new Chart(newUserCtx, {
                        type: 'line',
                        data: {
                            labels: ['5-17', '5-18', '5-19', '5-20', '5-21', '5-22', '5-23', '5-24', '5-25', '5-26'],
                            datasets: [
                                {
                                    label: '线损率(%)',
                                    data: [6.3, 6.2, 6.4, 6.3, 6.5, 8.8, 11.1, 11.3, 11.2, 11.0],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '用户数量',
                                    data: [145, 145, 145, 146, 146, 151, 153, 153, 153, 153],
                                    borderColor: '#3b82f6',
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    min: 5,
                                    max: 12,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '用户数量'
                                    },
                                    min: 140,
                                    max: 160,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对低压设备故障标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '低压设备故障') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">故障情况分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">故障开始时间</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-gray-700">06-05</span>
                                    <span class="text-xs text-gray-500 ml-1">22:47</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-orange-500">夜间高峰时段</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率异常上升</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">+9.6%</span>
                                    <span class="text-xs text-gray-500 ml-1">绝对值</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">突发性异常</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">电压波动</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">±12.3%</span>
                                    <span class="text-xs text-gray-500 ml-1">波动范围</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超出标准限值</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">电压异常分析</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">断相/接触不良</span>
                            </div>
                            <div class="h-60">
                                <canvas id="voltageChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">异常事件记录</h3>
                                <span class="text-xs py-1 px-2 bg-orange-100 text-orange-800 rounded-full">设备故障</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电压过低</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:47</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-5635</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相缺相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:55</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-204</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:55</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-279</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电压不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:56</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-283</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">巡检排查情况</h3>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-bolt text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">熔断器故障</p>
                                            <p class="text-xs text-gray-500">6月6日01:15分现场巡检发现B相熔断器烧毁</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-plug text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">接头连接故障</p>
                                            <p class="text-xs text-gray-500">导线接头过热，绝缘层有烧蚀痕迹</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-green-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-tools text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">故障处理</p>
                                            <p class="text-xs text-gray-500">更换熔断器并重新压接导线接头，故障排除时间：6月6日03:20</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-red-500 font-medium">06月05日22:47</span>开始出现B相电压异常，随后发生断相</li>
                                <li>事件发生后，台区线损率迅速上升<span class="text-red-500 font-medium">9.6%</span>，达到<span class="text-red-500 font-medium">15.9%</span></li>
                                <li>主要故障原因为<span class="text-red-500 font-medium">B相熔断器烧毁</span>以及<span class="text-red-500 font-medium">导线接头过热</span></li>
                                <li>故障持续时长<span class="text-yellow-500 font-medium">4小时33分钟</span>，影响台区<span class="text-yellow-500 font-medium">47户</span>用户</li>
                                <li>缺相运行期间，A相和C相电流增大，出现<span class="text-red-500 font-medium">三相不平衡</span>情况</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-orange-50 p-3 rounded-md border border-orange-100">
                            <p class="text-sm font-medium text-orange-800 mb-1">治理建议</p>
                            <ol class="text-xs text-orange-700 list-decimal pl-4">
                                <li>加强台区关键点导线接头红外测温，排查过热隐患</li>
                                <li>开展台区熔断器老化替换计划，优先更换投运超5年熔断器</li>
                                <li>优化三相负荷分布，降低单相负荷集中度</li>
                                <li>对线路关键节点进行标识，提高紧急抢修效率</li>
                                <li>完善突发故障快速响应机制，减少故障持续时间</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const voltageCtx = document.getElementById('voltageChartModal').getContext('2d');
                    const voltageChartModal = new Chart(voltageCtx, {
                        type: 'line',
                        data: {
                            labels: ['22:00', '22:30', '23:00', '23:30', '00:00', '00:30', '01:00', '01:30', '02:00', '02:30', '03:00', '03:30'],
                            datasets: [
                                {
                                    label: 'A相电压(V)',
                                    data: [220, 218, 223, 225, 230, 232, 233, 231, 229, 226, 223, 221],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: 'B相电压(V)',
                                    data: [219, 217, 202, 165, 32, 0, 0, 0, 0, 0, 0, 210],
                                    borderColor: '#10b981',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: 'C相电压(V)',
                                    data: [222, 220, 225, 228, 233, 237, 235, 230, 227, 225, 222, 220],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '故障发生点',
                                    data: [null, null, 202, null, null, null, null, null, null, null, null, null],
                                    borderColor: '#ef4444',
                                    backgroundColor: '#ef4444',
                                    borderWidth: 0,
                                    pointRadius: 6,
                                    pointHoverRadius: 8,
                                    pointStyle: 'triangle'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            if (context.datasetIndex === 3) {
                                                return '故障发生点';
                                            }
                                            return `${context.dataset.label}: ${context.parsed.y} V`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '电压 (V)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 250
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对恶劣天气引发问题标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '恶劣天气引发问题') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">天气情况分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">天气状况</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-blue-600">暴雨</span>
                                    <span class="text-xs text-gray-500 ml-1">雷暴</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-blue-600 rounded-full mr-1"></div>
                                    <span class="text-xs text-blue-600">气象台Ⅲ级预警</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">降雨量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">87.5</span>
                                    <span class="text-xs text-gray-500 ml-1">mm/3h</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超出警戒值(50mm)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率波动</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">+7.2%</span>
                                    <span class="text-xs text-gray-500 ml-1">暴雨期间</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">短期波动异常</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">台区运行状态变化</h3>
                                <span class="text-xs py-1 px-2 bg-blue-100 text-blue-800 rounded-full">降雨影响</span>
                            </div>
                            <div class="h-60">
                                <canvas id="weatherChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">异常事件记录</h3>
                                <span class="text-xs py-1 px-2 bg-blue-100 text-blue-800 rounded-full">暴雨相关</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">关联天气</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 18:42</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-279</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">降雨初期</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">接地故障</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 19:15</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-307</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">降雨高峰</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">短时掉电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 19:27</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-7</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">雷击频发</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">功率因数异常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 19:50</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-301</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">持续降雨</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">现场检查情况</h3>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-blue-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-tint text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">配电箱浸水</p>
                                            <p class="text-xs text-gray-500">多处低洼地带配电箱遭雨水浸泡，引起短路故障</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-bolt text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">设备接地泄漏</p>
                                            <p class="text-xs text-gray-500">雨水浸泡导致部分设备接地不良，引发泄漏电流增大</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-exclamation-triangle text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">防雷器损坏</p>
                                            <p class="text-xs text-gray-500">多处配电设施防雷装置失效，发现1处雷击痕迹</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-blue-600 font-medium">7月12日</span>遭遇<span class="text-blue-600 font-medium">暴雨雷暴天气</span>，3小时降雨量达<span class="text-red-500 font-medium">87.5mm</span></li>
                                <li>降雨导致多处配电设施<span class="text-red-500 font-medium">浸水</span>，引起接地泄漏电流增大</li>
                                <li>暴雨期间台区线损率<span class="text-red-500 font-medium">短时异常升高</span>，从6.3%上升至13.5%</li>
                                <li>防雷设施发挥有限作用，仍有<span class="text-red-500 font-medium">1处遭雷击</span>导致设备损坏</li>
                                <li>暴雨过后，线损恢复正常，但<span class="text-yellow-500 font-medium">波动幅度较大</span>，与设备潮湿有关</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-blue-50 p-3 rounded-md border border-blue-100">
                            <p class="text-sm font-medium text-blue-800 mb-1">治理建议</p>
                            <ol class="text-xs text-blue-700 list-decimal pl-4">
                                <li>提升低洼地带配电设施防水等级，增设防水墙和排水设施</li>
                                <li>增强防雷系统建设，更新老化避雷器</li>
                                <li>优化恶劣天气预警机制，提前做好应急准备</li>
                                <li>针对设备接地系统开展专项检查，提升绝缘等级</li>
                                <li>建立台区"一站一案"极端天气应对方案</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const weatherCtx = document.getElementById('weatherChartModal').getContext('2d');
                    const weatherChartModal = new Chart(weatherCtx, {
                        type: 'line',
                        data: {
                            labels: ['16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00', '00:00', '01:00', '02:00'],
                            datasets: [
                                {
                                    label: '线损率(%)',
                                    data: [6.3, 6.4, 8.2, 13.5, 12.7, 11.3, 9.5, 8.3, 7.4, 6.8, 6.5],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '降雨量(mm)',
                                    data: [2, 8, 22, 38, 27, 19, 12, 5, 2, 0, 0],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.3)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y1'
                                },
                                {
                                    label: '雷击次数',
                                    data: [0, 0, 3, 7, 4, 2, 1, 0, 0, 0, 0],
                                    borderColor: '#f59e0b',
                                    backgroundColor: '#f59e0b',
                                    borderWidth: 0,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    yAxisID: 'y2'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    suggestedMin: 5,
                                    suggestedMax: 15
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '降雨量 (mm)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 40,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                },
                                y2: {
                                    type: 'linear',
                                    display: false,
                                    position: 'right',
                                    suggestedMin: 0,
                                    suggestedMax: 10
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对短时漏电故障标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '短时漏电故障') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">漏电故障分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">故障持续时长</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-green-600">1.5</span>
                                    <span class="text-xs text-gray-500 ml-1">小时</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-green-600 rounded-full mr-1"></div>
                                    <span class="text-xs text-green-600">短暂性故障</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">漏电电流大小</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">2.8</span>
                                    <span class="text-xs text-gray-500 ml-1">A</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超过安全阈值(0.5A)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率波动</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-yellow-500">+5.2%</span>
                                    <span class="text-xs text-gray-500 ml-1">故障期间</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-yellow-500">中度异常</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">漏电电流趋势</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">绝缘性故障</span>
                            </div>
                            <div class="h-60">
                                <canvas id="leakageChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">发生的事件</h3>
                                <span class="text-xs py-1 px-2 bg-green-100 text-green-800 rounded-full">自愈性故障</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 14:22</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-279</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">L2电流异常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 14:23</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-309</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">PE-N电压异常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 14:25</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-303</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">N线</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流恢复正常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 15:53</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-280</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">故障定位分析</h3>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex">
                                        <div class="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white flex-shrink-0 mt-0.5">
                                            <i class="fas fa-map-marker-alt text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">故障位置</p>
                                            <p class="text-xs text-gray-500">台区支线末端211号电缆分接箱</p>
                                            <div class="mt-1 flex space-x-2">
                                                <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs">B相</span>
                                                <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs">分接箱</span>
                                                <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs">接地系统</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex">
                                        <div class="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-white flex-shrink-0 mt-0.5">
                                            <i class="fas fa-exclamation-circle text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">故障特征</p>
                                            <p class="text-xs text-gray-500">电缆终端头绝缘层老化，潮湿环境下引发暂时性接地故障</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex">
                                        <div class="h-6 w-6 rounded-full bg-green-500 flex items-center justify-center text-white flex-shrink-0 mt-0.5">
                                            <i class="fas fa-check-circle text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">自愈现象</p>
                                            <p class="text-xs text-gray-500">随着绝缘层干燥，漏电电流逐渐减小至安全范围，故障自动消除</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-yellow-500 font-medium">8月3日14:22</span>开始出现漏电故障，持续<span class="text-green-600 font-medium">1.5小时</span>后自愈</li>
                                <li>漏电电流峰值达<span class="text-red-500 font-medium">2.8A</span>，属于较大漏电电流，主要路径经过<span class="text-red-500 font-medium">B相</span>和<span class="text-red-500 font-medium">接地线</span></li>
                                <li>故障期间线损率上升<span class="text-yellow-500 font-medium">5.2%</span>，随漏电电流下降逐渐恢复正常</li>
                                <li>根据波形分析，故障性质为<span class="text-yellow-500 font-medium">湿度导致的暂时性绝缘降低</span></li>
                                <li>此类漏电故障具有<span class="text-green-600 font-medium">间歇性</span>特点，可能在潮湿条件下再次发生</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-green-50 p-3 rounded-md border border-green-100">
                            <p class="text-sm font-medium text-green-800 mb-1">治理建议</p>
                            <ol class="text-xs text-green-700 list-decimal pl-4">
                                <li>对211号分接箱进行绝缘测试，更换老化的电缆终端头</li>
                                <li>加强接地系统检查，改善接地连接点的防潮措施</li>
                                <li>安装漏电监测装置，对此类易发故障点进行重点监控</li>
                                <li>对潮湿环境下的电气设备增加防潮措施，如增设保护罩</li>
                                <li>制定预防性维护计划，定期对老化电缆终端进行更换</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const leakageCtx = document.getElementById('leakageChartModal').getContext('2d');
                    const leakageChartModal = new Chart(leakageCtx, {
                        type: 'line',
                        data: {
                            labels: ['14:00', '14:15', '14:30', '14:45', '15:00', '15:15', '15:30', '15:45', '16:00', '16:15', '16:30'],
                            datasets: [
                                {
                                    label: '漏电电流(A)',
                                    data: [0.2, 0.3, 2.8, 2.5, 1.8, 1.3, 0.8, 0.5, 0.3, 0.2, 0.2],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '线损率(%)',
                                    data: [6.3, 6.4, 11.5, 11.2, 10.3, 9.5, 8.2, 7.5, 6.8, 6.4, 6.3],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    tension: 0.3,
                                    yAxisID: 'y1'
                                },
                                {
                                    label: '安全阈值',
                                    data: [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5],
                                    borderColor: '#22c55e',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [2, 2],
                                    pointRadius: 0,
                                    tension: 0,
                                    yAxisID: 'y'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '漏电电流 (A)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 3
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    suggestedMin: 5,
                                    suggestedMax: 12,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对光伏发电档案错误标签显示特殊内容
            else if (type === 'long-negative' && tagData.title === '光伏发电档案错误') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">光伏接入情况</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">系统档案记录</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-gray-700">2</span>
                                    <span class="text-xs text-gray-500 ml-1">户</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-gray-500">总容量: 12.5kW</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">实际光伏接入</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">8</span>
                                    <span class="text-xs text-gray-500 ml-1">户</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">总容量: 42.8kW</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">台区线损率</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">-8.6%</span>
                                    <span class="text-xs text-gray-500 ml-1">月平均</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">明显负损</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">负损与光伏发电关系</h3>
                                <span class="text-xs py-1 px-2 bg-yellow-100 text-yellow-800 rounded-full">强相关</span>
                            </div>
                            <div class="h-60">
                                <canvas id="solarChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">未登记光伏用户</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">档案缺失</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">表号</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">反向电量</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">容量</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">逆流占比</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21264851</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">687 kWh</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">8.5 kW</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">62%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21268473</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">542 kWh</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">6.8 kW</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">51%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21271569</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">478 kWh</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">5.5 kW</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">48%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21265928</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">425 kWh</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">5.2 kW</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">46%</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bg-gray-50 px-3 py-1.5 text-xs text-gray-500 text-center">
                                    显示4条 (共6条未登记光伏用户)
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">反向电量分析</h3>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-xs text-gray-500 mb-2">日反向电量分布 (kWh)</p>
                                        <div class="h-36">
                                            <canvas id="solarDailyChartModal"></canvas>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 mb-2">月反向电量趋势 (kWh)</p>
                                        <div class="h-36">
                                            <canvas id="solarMonthlyChartModal"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>系统档案中仅记录<span class="text-gray-700 font-medium">2户</span>光伏用户，总容量<span class="text-gray-700 font-medium">12.5kW</span></li>
                                <li>实际接入光伏用户<span class="text-red-500 font-medium">8户</span>，总容量达<span class="text-red-500 font-medium">42.8kW</span>，超出档案记录<span class="text-red-500 font-medium">242%</span></li>
                                <li>台区总表测量的反向电量与户表数据对比，确认存在<span class="text-red-500 font-medium">6户</span>未登记光伏用户</li>
                                <li>光伏发电高峰期（10:00-15:00）台区线损率达<span class="text-red-500 font-medium">-15.2%</span>，明显呈负值</li>
                                <li>台区线损率与光照强度呈<span class="text-yellow-500 font-medium">明显负相关</span>，证实负损主要由光伏发电引起</li>
                                <li>未登记光伏装机容量预计<span class="text-red-500 font-medium">30.3kW</span>，占台区总光伏容量的<span class="text-red-500 font-medium">70.8%</span></li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>开展台区光伏用户专项普查，更新系统档案记录</li>
                                <li>对未登记光伏用户进行规范接入管理，完善装机容量和并网手续</li>
                                <li>建立光伏用户动态监测机制，及时掌握新增装机情况</li>
                                <li>调整线损考核指标，对光伏高渗透台区制定合理评价标准</li>
                                <li>开展居民光伏接入宣传，引导规范申报和安装</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    // 光伏发电与线损率关系图
                    const solarCtx = document.getElementById('solarChartModal').getContext('2d');
                    const solarChartModal = new Chart(solarCtx, {
                        type: 'line',
                        data: {
                            labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                            datasets: [
                                {
                                    label: '线损率(%)',
                                    data: [3.8, 3.6, 2.1, -4.5, -15.2, -12.6, -2.1, 2.5],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '光照强度(kW/㎡)',
                                    data: [0, 0, 0.1, 0.5, 0.95, 0.8, 0.2, 0],
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.2)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    suggestedMin: -20,
                                    suggestedMax: 10
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '光照强度 (kW/㎡)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 1,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                    
                    // 日反向电量分布图
                    const solarDailyCtx = document.getElementById('solarDailyChartModal').getContext('2d');
                    const solarDailyChartModal = new Chart(solarDailyCtx, {
                        type: 'bar',
                        data: {
                            labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                            datasets: [
                                {
                                    label: '反向电量',
                                    data: [142, 165, 148, 138, 155, 172, 168],
                                    backgroundColor: '#3b82f6',
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    
                    // 月反向电量趋势图
                    const solarMonthlyCtx = document.getElementById('solarMonthlyChartModal').getContext('2d');
                    const solarMonthlyChartModal = new Chart(solarMonthlyCtx, {
                        type: 'line',
                        data: {
                            labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                            datasets: [
                                {
                                    label: '反向电量',
                                    data: [820, 1250, 2850, 3620, 4150, 4280],
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    fill: true,
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对台区总表前接电标签显示特殊内容
            else if (type === 'long-negative' && tagData.title === '台区总表前接电') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">总表前接电分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">台区线损率</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">-12.8%</span>
                                    <span class="text-xs text-gray-500 ml-1">月平均</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">明显负损</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">估计接入负荷</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">32.5</span>
                                    <span class="text-xs text-gray-500 ml-1">kW</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">占台区容量17.6%</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">负损持续时间</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">76</span>
                                    <span class="text-xs text-gray-500 ml-1">天</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">长期持续状态</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">线损率异常趋势</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">持续负损</span>
                            </div>
                            <div class="h-60">
                                <canvas id="preConnectChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">异常类型定位</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">总表计量点前越线</span>
                            </div>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-sm font-medium text-gray-700 mb-2">供电线路示意图</p>
                                        <div class="bg-gray-50 p-3 rounded-lg relative">
                                            <div class="flex items-start justify-between">
                                                <div class="text-center">
                                                    <div class="h-12 w-12 mx-auto bg-blue-100 rounded-lg flex items-center justify-center">
                                                        <i class="fas fa-bolt text-blue-600"></i>
                                                    </div>
                                                    <p class="text-xs mt-1">配变</p>
                                                </div>
                                                <div class="flex-1 flex items-center justify-center">
                                                    <div class="h-1 bg-gray-400 flex-1"></div>
                                                </div>
                                                <div class="text-center">
                                                    <div class="h-12 w-12 mx-auto bg-yellow-100 rounded-lg flex items-center justify-center">
                                                        <i class="fas fa-tachometer-alt text-yellow-600"></i>
                                                    </div>
                                                    <p class="text-xs mt-1">总表</p>
                                                </div>
                                                <div class="flex-1 flex items-center justify-center relative">
                                                    <div class="h-1 bg-gray-400 flex-1"></div>
                                                    <div class="absolute -top-5 w-full text-center">
                                                        <div class="inline-block bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded">
                                                            <i class="fas fa-arrow-up mr-1"></i>异常接入点
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-center">
                                                    <div class="h-12 w-12 mx-auto bg-green-100 rounded-lg flex items-center justify-center">
                                                        <i class="fas fa-home text-green-600"></i>
                                                    </div>
                                                    <p class="text-xs mt-1">用户</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700 mb-2">总表与用户表电量统计</p>
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">电量类型</th>
                                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">用户表合计</th>
                                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">总表测量</th>
                                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">差值</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-200 bg-white">
                                                <tr>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">月供电量</td>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">54,385 kWh</td>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">48,215 kWh</td>
                                                    <td class="px-3 py-1.5 text-xs text-red-600 font-medium">-6,170 kWh</td>
                                                </tr>
                                                <tr>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">日最大负荷</td>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">228.6 kW</td>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">186.2 kW</td>
                                                    <td class="px-3 py-1.5 text-xs text-red-600 font-medium">-42.4 kW</td>
                                                </tr>
                                                <tr>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">日平均负荷</td>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">75.5 kW</td>
                                                    <td class="px-3 py-1.5 text-xs text-gray-900">66.9 kW</td>
                                                    <td class="px-3 py-1.5 text-xs text-red-600 font-medium">-8.6 kW</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">负载特性分析</h3>
                            <div class="h-48">
                                <canvas id="loadProfileChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区线损率持续<span class="text-red-500 font-medium">76天</span>呈现负值，月平均线损率达<span class="text-red-500 font-medium">-12.8%</span></li>
                                <li>用户表电量合计<span class="text-red-500 font-medium">大于</span>总表测量电量，差值<span class="text-red-500 font-medium">6,170 kWh/月</span></li>
                                <li>负载特性分析显示异常接入用电主要发生在<span class="text-red-500 font-medium">工作日白天</span>，符合工商业用电特征</li>
                                <li>根据负荷差异情况，估计总表前接入负荷约<span class="text-red-500 font-medium">32.5 kW</span>，占台区总容量<span class="text-red-500 font-medium">17.6%</span></li>
                                <li>负损状况持续恶化，从4月初<span class="text-red-500 font-medium">-8.3%</span>下降至目前<span class="text-red-500 font-medium">-12.8%</span>，需紧急处理</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-red-50 p-3 rounded-md border border-red-100">
                            <p class="text-sm font-medium text-red-800 mb-1">治理建议</p>
                            <ol class="text-xs text-red-700 list-decimal pl-4">
                                <li>组织专业人员现场勘查，确认总表前接电点位置</li>
                                <li>开展对台区沿线用户检查，重点排查总表前区域工商业用户</li>
                                <li>采用红外测温、负荷测量等技术手段定位异常接入点</li>
                                <li>联合稽查部门调查处理越线接入行为，规范用电秩序</li>
                                <li>优化台区供电线路设计，消除总表前接入可能性</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    // 线损率异常趋势图
                    const preConnectCtx = document.getElementById('preConnectChartModal').getContext('2d');
                    const preConnectChartModal = new Chart(preConnectCtx, {
                        type: 'line',
                        data: {
                            labels: ['4月初', '4月中', '4月底', '5月初', '5月中', '5月底', '6月初', '6月中'],
                            datasets: [
                                {
                                    label: '线损率(%)',
                                    data: [-8.3, -9.1, -10.5, -11.2, -11.8, -12.3, -12.6, -12.8],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '正常线损警戒线',
                                    data: [2, 2, 2, 2, 2, 2, 2, 2],
                                    borderColor: '#22c55e',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    pointRadius: 0,
                                    fill: false,
                                    tension: 0
                                },
                                {
                                    label: '负损警戒线',
                                    data: [-3, -3, -3, -3, -3, -3, -3, -3],
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    pointRadius: 0,
                                    fill: false,
                                    tension: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                annotation: {
                                    annotations: {
                                        line1: {
                                            type: 'line',
                                            yMin: 0,
                                            yMax: 0,
                                            borderColor: 'rgba(0, 0, 0, 0.3)',
                                            borderWidth: 1,
                                            borderDash: [2, 2]
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    suggestedMin: -15,
                                    suggestedMax: 5
                                }
                            }
                        }
                    });
                    
                    // 负载特性分析图
                    const loadProfileCtx = document.getElementById('loadProfileChartModal').getContext('2d');
                    const loadProfileChartModal = new Chart(loadProfileCtx, {
                        type: 'line',
                        data: {
                            labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                            datasets: [
                                {
                                    label: '工作日(kW)',
                                    data: [8.2, 7.5, 14.8, 32.5, 28.4, 30.2, 18.5, 12.3],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '节假日(kW)',
                                    data: [7.8, 6.9, 7.2, 11.3, 12.8, 10.5, 9.6, 8.5],
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.parsed.y} kW`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '估计总表前用电负荷 (kW)'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对理论模型计算偏差标签显示特殊内容
            else if (type === 'small-negative' && tagData.title === '理论模型计算偏差') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">模型计算偏差分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">理论模型与实际线损对比</h4>
                                <div class="h-48">
                                    <canvas id="modelDeviationChart"></canvas>
                                </div>
                            </div>
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">计算参数偏差分析</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">理论线损率:</span>
                                        <span class="text-xs font-medium text-primary">6.82%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">实际线损率:</span>
                                        <span class="text-xs font-medium text-blue-600">-2.35%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">偏差值:</span>
                                        <span class="text-xs font-medium text-red-500">-9.17%</span>
                                    </div>
                                    <div class="h-px bg-gray-200 my-2"></div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">模型失效置信度:</span>
                                        <span class="text-xs font-medium text-red-500">89%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">影响因素分析</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">参数名称</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">模型假设值</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">实际测量值</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">偏差率</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">影响程度</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">线路参数</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">R=0.642Ω/km</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">R=0.587Ω/km</td>
                                            <td class="px-4 py-2 text-xs text-green-600">-8.6%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-yellow-500 h-1.5 rounded-full" style="width: 40%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">平均功率因数</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">cosφ=0.85</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">cosφ=0.93</td>
                                            <td class="px-4 py-2 text-xs text-green-600">+9.4%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-yellow-500 h-1.5 rounded-full" style="width: 45%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">三相不平衡度</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">10%</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">4.2%</td>
                                            <td class="px-4 py-2 text-xs text-green-600">-58.0%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-red-500 h-1.5 rounded-full" style="width: 85%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">变压器负载率</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">65%</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">38%</td>
                                            <td class="px-4 py-2 text-xs text-red-600">-41.5%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-red-500 h-1.5 rounded-full" style="width: 75%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">供电半径</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">520m</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">635m</td>
                                            <td class="px-4 py-2 text-xs text-red-600">+22.1%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-red-500 h-1.5 rounded-full" style="width: 65%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">数据采集精度分析</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div class="p-2 bg-white rounded-lg border border-gray-200 flex items-center">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 flex-shrink-0">
                                        <i class="fas fa-tachometer-alt text-sm"></i>
                                    </div>
                                    <div class="ml-2">
                                        <p class="text-xs text-gray-600">电表采集率</p>
                                        <p class="text-sm font-medium">98.5% <span class="text-xs text-green-500">(合格)</span></p>
                                    </div>
                                </div>
                                <div class="p-2 bg-white rounded-lg border border-gray-200 flex items-center">
                                    <div class="h-8 w-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 flex-shrink-0">
                                        <i class="fas fa-clock text-sm"></i>
                                    </div>
                                    <div class="ml-2">
                                        <p class="text-xs text-gray-600">电表时钟准确率</p>
                                        <p class="text-sm font-medium">96.2% <span class="text-xs text-green-500">(合格)</span></p>
                                    </div>
                                </div>
                                <div class="p-2 bg-white rounded-lg border border-gray-200 flex items-center">
                                    <div class="h-8 w-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 flex-shrink-0">
                                        <i class="fas fa-database text-sm"></i>
                                    </div>
                                    <div class="ml-2">
                                        <p class="text-xs text-gray-600">数据完整率</p>
                                        <p class="text-sm font-medium">92.4% <span class="text-xs text-yellow-500">(警告)</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>理论模型与实际线损存在<span class="text-red-500 font-medium">-9.17%</span>的显著偏差</li>
                                <li>主要影响因素为<span class="text-red-500 font-medium">变压器负载率</span>和<span class="text-red-500 font-medium">三相不平衡度</span>的实际值远低于模型假设值</li>
                                <li>供电半径实际值超出模型假设值<span class="text-red-500 font-medium">22.1%</span>，增加了线路损耗的不确定性</li>
                                <li>数据采集精度总体良好，但数据完整率存在一定问题</li>
                                <li>理论模型未考虑用户侧<span class="text-red-500 font-medium">功率因数补偿设备</span>的影响，导致理论线损率估计偏高</li>
                            </ul>
                        </div>

                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>更新理论线损模型参数，根据实测数据校准模型参数</li>
                                <li>对台区用户进行详细调查，核实是否有未登记的功率因数补偿设备</li>
                                <li>提高现场测量数据的准确性和完整性，增加关键参数抽样检测频率</li>
                                <li>针对变压器负载率偏低问题，优化台区配置或负荷转移</li>
                                <li>建立台区模型参数动态调整机制，定期校准模型参数</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const modelDeviationCtx = document.getElementById('modelDeviationChart').getContext('2d');
                    const modelDeviationChart = new Chart(modelDeviationCtx, {
                        type: 'line',
                        data: {
                            labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月'],
                            datasets: [
                                {
                                    label: '理论线损率(%)',
                                    data: [6.75, 6.82, 6.79, 6.84, 6.80, 6.83, 6.78, 6.82],
                                    borderColor: '#309C9F',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3,
                                    pointRadius: 3
                                },
                                {
                                    label: '实际线损率(%)',
                                    data: [0.25, -0.62, -1.25, -1.84, -2.17, -2.35, -2.28, -2.35],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3,
                                    pointRadius: 3
                                },
                                {
                                    label: '理论线损警戒线',
                                    data: [2, 2, 2, 2, 2, 2, 2, 2],
                                    borderColor: '#22c55e',
                                    backgroundColor: 'transparent',
                                    borderWidth: 1.5,
                                    borderDash: [5, 5],
                                    pointRadius: 0
                                },
                                {
                                    label: '负损警戒线',
                                    data: [-3, -3, -3, -3, -3, -3, -3, -3],
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'transparent',
                                    borderWidth: 1.5,
                                    borderDash: [5, 5],
                                    pointRadius: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    suggestedMin: -4,
                                    suggestedMax: 8
                                }
                            }
                        }
                    });
                }, 100);
            }
            // 针对采集数据偏差标签显示特殊内容
            else if (type === 'small-negative' && tagData.title === '采集数据偏差') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">数据采集偏差分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">采集成功率趋势</h4>
                                <div class="h-48">
                                    <canvas id="dataCollectionChart"></canvas>
                                </div>
                            </div>
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">数据质量统计</h4>
                                <div class="space-y-3 mt-3">
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-xs text-gray-600">普通表采集率</span>
                                            <span class="text-xs font-medium text-orange-500">78.4%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                                            <div class="bg-orange-500 h-1.5 rounded-full" style="width: 78.4%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-xs text-gray-600">总表采集率</span>
                                            <span class="text-xs font-medium text-green-500">100%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                                            <div class="bg-green-500 h-1.5 rounded-full" style="width: 100%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-xs text-gray-600">数据完整性</span>
                                            <span class="text-xs font-medium text-orange-500">82.5%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                                            <div class="bg-orange-500 h-1.5 rounded-full" style="width: 82.5%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-xs text-gray-600">数据时效性</span>
                                            <span class="text-xs font-medium text-red-500">68.2%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                                            <div class="bg-red-500 h-1.5 rounded-full" style="width: 68.2%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">采集异常事件分析</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">异常类型</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">事件数量</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">影响电表数</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">占比</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">影响程度</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">通信模块异常</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">42</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">15</td>
                                            <td class="px-4 py-2 text-xs text-red-600">28.3%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-red-500 h-1.5 rounded-full" style="width: 85%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">电表时钟超差</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">28</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">8</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">15.1%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-orange-500 h-1.5 rounded-full" style="width: 65%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">采集器故障</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">8</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">6</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">11.3%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-orange-500 h-1.5 rounded-full" style="width: 60%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">网络信号弱</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">36</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">12</td>
                                            <td class="px-4 py-2 text-xs text-yellow-600">22.6%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-yellow-500 h-1.5 rounded-full" style="width: 45%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">数据冻结失败</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">15</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">7</td>
                                            <td class="px-4 py-2 text-xs text-yellow-600">13.2%</td>
                                            <td class="px-4 py-2 text-xs">
                                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                                    <div class="bg-yellow-500 h-1.5 rounded-full" style="width: 40%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">采集数据缺失影响评估</h3>
                            <div class="bg-white rounded-lg border border-gray-200 p-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 flex-shrink-0">
                                            <i class="fas fa-exclamation-triangle text-sm"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm font-medium text-gray-700">数据缺失估算误差</p>
                                            <p class="text-xs text-gray-500">相比完整采集数据的估算误差范围</p>
                                        </div>
                                    </div>
                                    <div class="text-orange-500 font-medium text-lg">-8.2%</div>
                                </div>
                                <div class="mt-3">
                                    <div class="text-xs text-gray-500 mb-1">数据缺失对线损计算影响</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-orange-500 h-2 rounded-full" style="width: 72%"></div>
                                    </div>
                                    <div class="flex justify-between mt-1">
                                        <span class="text-xs text-gray-500">轻微</span>
                                        <span class="text-xs text-orange-500 font-medium">显著</span>
                                        <span class="text-xs text-gray-500">严重</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">失采用户负荷特性分析</h3>
                            <div class="h-48">
                                <canvas id="missedUserLoadChart"></canvas>
                            </div>
                        </div>

                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>普通表采集率低于标准要求，仅达到<span class="text-orange-500 font-medium">78.4%</span>，数据质量不高</li>
                                <li>通信模块异常是主要问题，影响<span class="text-red-500 font-medium">28.3%</span>的采集失败电表</li>
                                <li>采集失败用户多为<span class="text-red-500 font-medium">工商业用户</span>，用电负荷较大</li>
                                <li>数据缺失造成线损计算有显著偏差，估算误差高达<span class="text-orange-500 font-medium">-8.2%</span></li>
                                <li>近期采集率呈下降趋势，且波动较大，网络稳定性差</li>
                                <li>夜间和早期采集成功率明显高于工作日用电高峰期</li>
                            </ul>
                        </div>

                        <div class="mt-4 bg-orange-50 p-3 rounded-md border border-orange-100">
                            <p class="text-sm font-medium text-orange-800 mb-1">治理建议</p>
                            <ol class="text-xs text-orange-700 list-decimal pl-4">
                                <li>及时更换或修复故障通信模块，提高电表通信可靠性</li>
                                <li>检查并优化通信网络覆盖，解决信号弱区域问题</li>
                                <li>对电表时钟进行校准，确保数据采集时间准确性</li>
                                <li>优先解决工商业用户的采集问题，减少大负荷用户数据缺失</li>
                                <li>建立数据质量监测预警机制，提前发现并解决采集异常</li>
                                <li>设置数据修复和估算规则，减少缺失数据对线损计算的影响</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    // 采集成功率趋势图
                    const dataCollectionCtx = document.getElementById('dataCollectionChart').getContext('2d');
                    const dataCollectionChart = new Chart(dataCollectionCtx, {
                        type: 'line',
                        data: {
                            labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月'],
                            datasets: [
                                {
                                    label: '总表采集率',
                                    data: [100, 100, 100, 100, 100, 100, 100, 100],
                                    borderColor: '#22c55e',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.1,
                                    pointRadius: 3
                                },
                                {
                                    label: '普通表采集率',
                                    data: [92.3, 90.4, 86.2, 83.5, 81.7, 80.2, 79.5, 78.4],
                                    borderColor: '#f97316',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.1,
                                    pointRadius: 3
                                },
                                {
                                    label: '合格线',
                                    data: [95, 95, 95, 95, 95, 95, 95, 95],
                                    borderColor: '#22c55e',
                                    backgroundColor: 'transparent',
                                    borderWidth: 1.5,
                                    borderDash: [5, 5],
                                    pointRadius: 0
                                },
                                {
                                    label: '警戒线',
                                    data: [85, 85, 85, 85, 85, 85, 85, 85],
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'transparent',
                                    borderWidth: 1.5,
                                    borderDash: [5, 5],
                                    pointRadius: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '采集成功率 (%)'
                                    },
                                    min: 70,
                                    max: 100
                                }
                            }
                        }
                    });
                    
                    // 失采用户负荷特性分析图
                    const missedUserLoadCtx = document.getElementById('missedUserLoadChart').getContext('2d');
                    const missedUserLoadChart = new Chart(missedUserLoadCtx, {
                        type: 'bar',
                        data: {
                            labels: ['居民用户', '商业用户', '工业用户', '农业用户', '公共事业'],
                            datasets: [
                                {
                                    label: '失采率(%)',
                                    data: [12.5, 28.7, 38.2, 15.3, 18.6],
                                    backgroundColor: '#f97316',
                                    borderWidth: 0,
                                    borderRadius: 4,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '平均日用电量(kWh)',
                                    data: [8.5, 75.3, 186.2, 42.5, 58.7],
                                    backgroundColor: '#3b82f6',
                                    borderWidth: 0,
                                    borderRadius: 4,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '失采率 (%)'
                                    },
                                    beginAtZero: true,
                                    max: 50
                                },
                                y1: {
                                    type: 'linear',
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '平均日用电量 (kWh)'
                                    },
                                    beginAtZero: true,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            // 针对电表时钟超差标签显示特殊内容
            else if (type === 'small-negative' && tagData.title === '电表时钟超差') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">电表时钟偏差分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">时钟偏差统计</h4>
                                <div class="h-48">
                                    <canvas id="clockDeviationChart"></canvas>
                                </div>
                            </div>
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">台区时钟同步状态</h4>
                                <div class="mt-3 space-y-2">
                                    <div class="flex items-center">
                                        <div class="h-3 w-3 bg-green-500 rounded-full mr-2"></div>
                                        <div class="text-xs text-gray-600 flex-1">正常同步 (±1分钟内)</div>
                                        <div class="text-xs text-gray-800 font-medium">22块 (41.5%)</div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="h-3 w-3 bg-yellow-500 rounded-full mr-2"></div>
                                        <div class="text-xs text-gray-600 flex-1">轻微偏差 (±1~5分钟)</div>
                                        <div class="text-xs text-gray-800 font-medium">13块 (24.5%)</div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="h-3 w-3 bg-orange-500 rounded-full mr-2"></div>
                                        <div class="text-xs text-gray-600 flex-1">中度偏差 (±5~15分钟)</div>
                                        <div class="text-xs text-gray-800 font-medium">10块 (18.9%)</div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="h-3 w-3 bg-red-500 rounded-full mr-2"></div>
                                        <div class="text-xs text-gray-600 flex-1">严重偏差 (>±15分钟)</div>
                                        <div class="text-xs text-gray-800 font-medium">8块 (15.1%)</div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-xs text-gray-600">时钟超差事件数量</span>
                                        <span class="text-xs font-medium text-red-500">62次 / 月</span>
                                    </div>
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-xs text-gray-600">最大时钟偏差</span>
                                        <span class="text-xs font-medium text-red-500">+127分钟</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">平均时钟偏差</span>
                                        <span class="text-xs font-medium text-orange-500">±8.3分钟</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">时钟偏差对计量的影响</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-3 bg-white rounded-lg border border-gray-200">
                                    <div class="flex items-center">
                                        <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 flex-shrink-0">
                                            <i class="fas fa-tachometer-alt text-sm"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-xs text-gray-600">尖峰电量偏差</p>
                                            <p class="text-sm font-medium text-blue-600">-587 kWh/月</p>
                                            <p class="text-xs text-red-500">偏差率 -12.8%</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 bg-white rounded-lg border border-gray-200">
                                    <div class="flex items-center">
                                        <div class="h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 flex-shrink-0">
                                            <i class="fas fa-bolt text-sm"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-xs text-gray-600">峰谷计量错误</p>
                                            <p class="text-sm font-medium text-orange-600">815 kWh/月</p>
                                            <p class="text-xs text-red-500">偏差率 +9.7%</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 bg-white rounded-lg border border-gray-200">
                                    <div class="flex items-center">
                                        <div class="h-10 w-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 flex-shrink-0">
                                            <i class="fas fa-chart-line text-sm"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-xs text-gray-600">线损计算偏差</p>
                                            <p class="text-sm font-medium text-red-600">-3.85%</p>
                                            <p class="text-xs text-red-500">影响显著</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">时钟超差事件记录</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">电表号</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">首次记录时间</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">偏差值</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">状态</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">21253487</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2023-07-12 08:34</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">Event-1538</td>
                                            <td class="px-4 py-2 text-xs text-red-600">+127分钟</td>
                                            <td class="px-4 py-2 text-xs">
                                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">未修复</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">21385692</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2023-07-15 14:22</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">Event-12803</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">-18分钟</td>
                                            <td class="px-4 py-2 text-xs">
                                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">已修复</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">21146783</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2023-07-18 22:05</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">Event-12803</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">+22分钟</td>
                                            <td class="px-4 py-2 text-xs">
                                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">处理中</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">21659324</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2023-07-20 06:17</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">Event-1538</td>
                                            <td class="px-4 py-2 text-xs text-red-600">+85分钟</td>
                                            <td class="px-4 py-2 text-xs">
                                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">未修复</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">21498275</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2023-07-22 19:56</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">Event-12803</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">-13分钟</td>
                                            <td class="px-4 py-2 text-xs">
                                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">已修复</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">负荷曲线时移分析</h3>
                            <div class="h-48">
                                <canvas id="loadCurveShiftChart"></canvas>
                            </div>
                        </div>

                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区内<span class="text-red-500 font-medium">34%</span>的电表存在明显的时钟偏差问题</li>
                                <li>事件统计显示每月约有<span class="text-red-500 font-medium">62次</span>时钟超差报警事件</li>
                                <li>最大时钟偏差达<span class="text-red-500 font-medium">+127分钟</span>，严重影响分时计量准确性</li>
                                <li>时钟超差主要集中在<span class="text-orange-500 font-medium">工商业用户</span>的电表中，导致尖峰电量记录偏少</li>
                                <li>负荷曲线分析显示存在明显的<span class="text-orange-500 font-medium">时移现象</span>，峰谷特征不明显</li>
                                <li>时钟偏差导致线损计算出现<span class="text-red-500 font-medium">-3.85%</span>的负偏差，是小负损主要成因之一</li>
                            </ul>
                        </div>

                        <div class="mt-4 bg-blue-50 p-3 rounded-md border border-blue-100">
                            <p class="text-sm font-medium text-blue-800 mb-1">治理建议</p>
                            <ol class="text-xs text-blue-700 list-decimal pl-4">
                                <li>组织专项校时工作，优先处理偏差超过15分钟的电表</li>
                                <li>加强主站校时功能建设，提高自动校时成功率</li>
                                <li>针对重点工商业用户进行现场校时，确保分时计量准确</li>
                                <li>定期检查时钟偏差情况，建立常态化监测和预警机制</li>
                                <li>完善电能数据校核方法，对有明显时钟偏差的数据进行时间修正</li>
                                <li>对不能远程校时的电表进行硬件检查，必要时更换电表</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    // 时钟偏差统计图
                    const clockDeviationCtx = document.getElementById('clockDeviationChart').getContext('2d');
                    const clockDeviationChart = new Chart(clockDeviationCtx, {
                        type: 'bar',
                        data: {
                            labels: ['<-15分钟', '-15~-5分钟', '-5~-1分钟', '±1分钟内', '1~5分钟', '5~15分钟', '>15分钟'],
                            datasets: [{
                                label: '电表数量',
                                data: [3, 5, 7, 22, 6, 5, 5],
                                backgroundColor: [
                                    '#ef4444', '#f97316', '#facc15', '#22c55e', '#facc15', '#f97316', '#ef4444'
                                ],
                                borderWidth: 0,
                                borderRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: '电表数量'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: '时钟偏差范围'
                                    }
                                }
                            }
                        }
                    });
                    
                    // 负荷曲线时移分析图
                    const loadCurveShiftCtx = document.getElementById('loadCurveShiftChart').getContext('2d');
                    const loadCurveShiftChart = new Chart(loadCurveShiftCtx, {
                        type: 'line',
                        data: {
                            labels: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
                            datasets: [
                                {
                                    label: '正常时钟负荷曲线',
                                    data: [42, 38, 35, 48, 72, 95, 88, 93, 105, 115, 82, 60],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '时钟偏差负荷曲线',
                                    data: [46, 40, 37, 42, 58, 76, 85, 91, 98, 112, 102, 75],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '负荷 (kW)'
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对供电半径过长标签显示特殊内容
            else if (type === 'small-negative' && tagData.title === '供电半径过长') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">供电半径分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">台区供电半径分布</h4>
                                <div class="h-48">
                                    <canvas id="supplyRadiusChart"></canvas>
                                </div>
                            </div>
                            <div class="p-3 bg-white rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium text-gray-700 mb-2">供电半径基本指标</h4>
                                <div class="space-y-3 mt-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">当前台区平均供电半径</span>
                                        <span class="text-xs font-medium text-red-500">635m</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">最远供电距离</span>
                                        <span class="text-xs font-medium text-red-500">842m</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">标准供电半径</span>
                                        <span class="text-xs font-medium text-green-500">≤350m</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">超长供电用户数</span>
                                        <span class="text-xs font-medium text-red-500">32户 (60.4%)</span>
                                    </div>
                                    <div class="h-px bg-gray-200 my-2"></div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">理论线损率(当前半径)</span>
                                        <span class="text-xs font-medium text-red-500">8.65%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">理论线损率(标准半径)</span>
                                        <span class="text-xs font-medium text-green-500">4.32%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">电压降分析</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-3 bg-white rounded-lg border border-gray-200">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">电压降与距离关系</h4>
                                    <div class="h-48">
                                        <canvas id="voltageDropChart"></canvas>
                                    </div>
                                </div>
                                <div class="p-3 bg-white rounded-lg border border-gray-200">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">三相电压降情况</h4>
                                    <div class="mt-3 space-y-2">
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-xs text-gray-600">A相平均电压降</span>
                                                <span class="text-xs font-medium text-red-500">6.83%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                <div class="bg-red-500 h-1.5 rounded-full" style="width: 68.3%"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-xs text-gray-600">B相平均电压降</span>
                                                <span class="text-xs font-medium text-red-500">5.75%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                <div class="bg-red-500 h-1.5 rounded-full" style="width: 57.5%"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-xs text-gray-600">C相平均电压降</span>
                                                <span class="text-xs font-medium text-orange-500">4.92%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                <div class="bg-orange-500 h-1.5 rounded-full" style="width: 49.2%"></div>
                                            </div>
                                        </div>
                                        <div class="h-px bg-gray-200 my-2"></div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-xs text-gray-600">最大电压降</span>
                                                <span class="text-xs font-medium text-red-500">9.38% (A相)</span>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-xs text-gray-600">标准电压允许偏差</span>
                                                <span class="text-xs font-medium text-green-500">±7%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">用户分布与负荷情况</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">距离范围</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">用户数量</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">平均负荷(kW)</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">平均电压(V)</th>
                                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500">电压合格率</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">0-200m</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">8</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">3.8</td>
                                            <td class="px-4 py-2 text-xs text-green-600">227.5</td>
                                            <td class="px-4 py-2 text-xs text-green-600">100%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">200-350m</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">13</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2.9</td>
                                            <td class="px-4 py-2 text-xs text-green-600">225.8</td>
                                            <td class="px-4 py-2 text-xs text-green-600">100%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">350-500m</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">15</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2.2</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">221.3</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">93.3%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">500-650m</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">10</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">1.8</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">218.4</td>
                                            <td class="px-4 py-2 text-xs text-orange-600">80.0%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">650-800m</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">5</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">1.5</td>
                                            <td class="px-4 py-2 text-xs text-red-600">214.6</td>
                                            <td class="px-4 py-2 text-xs text-red-600">60.0%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 text-xs text-gray-900">>800m</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">2</td>
                                            <td class="px-4 py-2 text-xs text-gray-600">1.2</td>
                                            <td class="px-4 py-2 text-xs text-red-600">208.3</td>
                                            <td class="px-4 py-2 text-xs text-red-600">0%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">线损异常原因分析</h3>
                            <div class="bg-white rounded-lg border border-gray-200 p-3">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <div class="flex items-center">
                                        <div class="h-8 w-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 flex-shrink-0">
                                            <i class="fas fa-ruler text-sm"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-xs text-gray-600">导线阻抗增加</p>
                                            <p class="text-sm font-medium text-red-600">线损增加 2.7%</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="h-8 w-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 flex-shrink-0">
                                            <i class="fas fa-bolt text-sm"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-xs text-gray-600">计量不准确</p>
                                            <p class="text-sm font-medium text-orange-600">线损偏差 -1.8%</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="h-8 w-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 flex-shrink-0">
                                            <i class="fas fa-balance-scale text-sm"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-xs text-gray-600">三相不平衡</p>
                                            <p class="text-sm font-medium text-yellow-600">线损增加 1.2%</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <h4 class="text-xs font-medium text-gray-700 mb-1">电压偏低导致计量误差</h4>
                                    <p class="text-xs text-gray-600">远端用户电压低于额定电压，计量装置存在负误差，导致计量电量少于实际用电量。</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区平均供电半径<span class="text-red-500 font-medium">635m</span>，远超标准供电半径<span class="text-green-500 font-medium">350m</span></li>
                                <li>超过<span class="text-red-500 font-medium">60%</span>的用户供电半径超长，导致电压质量问题</li>
                                <li>A相电压降最严重，最大电压降达<span class="text-red-500 font-medium">9.38%</span>，超出标准电压允许偏差</li>
                                <li>距离总表<span class="text-red-500 font-medium">650m以上</span>的用户电压合格率低于70%</li>
                                <li>供电半径过长导致线损增加，同时远端电压偏低引起计量误差</li>
                                <li>远端用户的计量装置电压低于额定值，产生<span class="text-red-500 font-medium">-1.8%</span>的计量负误差</li>
                            </ul>
                        </div>

                        <div class="mt-4 bg-green-50 p-3 rounded-md border border-green-100">
                            <p class="text-sm font-medium text-green-800 mb-1">治理建议</p>
                            <ol class="text-xs text-green-700 list-decimal pl-4">
                                <li>优化台区规划，拆分供电半径过长的台区，新建变压器靠近负荷中心</li>
                                <li>增设无功补偿装置，提高远端用户电压质量</li>
                                <li>更换远端线路为大截面导线，降低线路阻抗</li>
                                <li>调整分界点，将远端用户转供至相邻台区</li>
                                <li>定期开展电压监测分析，确保各相电压均衡</li>
                                <li>校验远端用户计量装置，消除低电压引起的计量误差</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    // 台区供电半径分布图
                    const supplyRadiusCtx = document.getElementById('supplyRadiusChart').getContext('2d');
                    const supplyRadiusChart = new Chart(supplyRadiusCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['0-200m', '200-350m', '350-500m', '500-650m', '650-800m', '>800m'],
                            datasets: [{
                                data: [8, 13, 15, 10, 5, 2],
                                backgroundColor: [
                                    '#22c55e', '#15803d', '#facc15', '#f97316', '#ef4444', '#b91c1c'
                                ],
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        boxWidth: 10,
                                        font: {
                                            size: 10
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                    // 电压降与距离关系图
                    const voltageDropCtx = document.getElementById('voltageDropChart').getContext('2d');
                    const voltageDropChart = new Chart(voltageDropCtx, {
                        type: 'scatter',
                        data: {
                            datasets: [
                                {
                                    label: '电压降-距离关系',
                                    data: [
                                        {x: 50, y: 0.8}, {x: 120, y: 1.5}, {x: 180, y: 2.2},
                                        {x: 250, y: 3.1}, {x: 320, y: 3.8}, {x: 380, y: 4.2},
                                        {x: 430, y: 4.8}, {x: 490, y: 5.3}, {x: 530, y: 5.7},
                                        {x: 580, y: 6.2}, {x: 630, y: 6.7}, {x: 680, y: 7.2},
                                        {x: 720, y: 7.8}, {x: 780, y: 8.5}, {x: 840, y: 9.4}
                                    ],
                                    backgroundColor: '#ef4444',
                                    borderColor: '#ef4444',
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                },
                                {
                                    label: '允许偏差上限',
                                    data: [{x: 0, y: 7}, {x: 900, y: 7}],
                                    borderColor: '#f59e0b',
                                    borderWidth: 1.5,
                                    borderDash: [5, 5],
                                    pointRadius: 0,
                                    fill: false,
                                    tension: 0,
                                    type: 'line'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '电压降 (%)'
                                    },
                                    beginAtZero: true,
                                    suggestedMax: 10
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: '距离 (m)'
                                    },
                                    beginAtZero: true,
                                    suggestedMax: 900
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 显示弹窗
            modal.classList.remove('hidden');
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 渲染标签
            renderTags('long-high');
            
            // 标签弹窗关闭按钮
            const closeTagModalBtn = document.getElementById('closeTagModal');
            const tagModal = document.getElementById('tagDetailModal');
            
            closeTagModalBtn.addEventListener('click', function() {
                tagModal.classList.add('hidden');
            });
            
            // 点击弹窗外部关闭
            tagModal.addEventListener('click', function(event) {
                if (event.target === tagModal) {
                    tagModal.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html> 