<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能诊断标签卡片弹窗示例</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#309C9F',
                        'primary-light': '#e6f1f1',
                        'primary-dark': '#256e70',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h1 class="text-2xl font-bold text-gray-900 mb-6">智能诊断标签卡片弹窗示例</h1>
        
        <div class="bg-white rounded-lg shadow-sm p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">智能诊断标签</h2>
            <div class="flex flex-col space-y-3" id="diagnosticTags">
                <!-- 诊断标签会通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 返回按钮 -->
        <div class="mt-6">
            <a href="/cn/diagnostic.html" class="inline-flex items-center bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-md text-sm transition-colors duration-200">
                <i class="fas fa-arrow-left mr-1"></i> 返回诊断分析页面
            </a>
        </div>
    </div>
    
    <!-- 诊断标签详情弹窗 -->
    <div id="tagDetailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-3xl max-h-[90vh] overflow-auto">
            <div class="px-5 py-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white">
                <h2 id="tagModalTitle" class="text-lg font-medium text-gray-900">标签详情</h2>
                <button id="closeTagModal" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="tagModalContent" class="p-5">
                <!-- 弹窗内容将由JS动态生成 -->
            </div>
        </div>
    </div>
    
    <script>
        // 诊断标签数据
        const diagnosticTags = {
            // 长期高损标签
            'long-high': [
                {
                    title: 'CT互感器倍率错误',
                    probability: '92%',
                    icon: 'exclamation-triangle',
                    color: 'red'
                },
                {
                    title: '档案户变关系异常',
                    probability: '68%',
                    icon: 'file-alt',
                    color: 'orange'
                },
                {
                    title: '疑似低压窃电',
                    probability: '45%',
                    icon: 'bolt',
                    color: 'yellow'
                },
                {
                    title: '采集设备故障',
                    probability: '38%',
                    icon: 'wifi',
                    color: 'blue'
                },
                {
                    title: '电能表超容量运行',
                    probability: '30%',
                    icon: 'tachometer-alt',
                    color: 'green'
                },
                {
                    title: '三相不平衡度高',
                    probability: '25%',
                    icon: 'balance-scale',
                    color: 'purple'
                }
            ],
            
            // 突发高损标签
            'sudden-high': [
                {
                    title: '用电负荷突增',
                    probability: '87%',
                    icon: 'bolt',
                    color: 'red'
                },
                {
                    title: '低压设备故障',
                    probability: '65%',
                    icon: 'exclamation-triangle',
                    color: 'orange'
                },
                {
                    title: '新增用户接入异常',
                    probability: '52%',
                    icon: 'user-plus',
                    color: 'yellow'
                },
                {
                    title: '恶劣天气引发问题',
                    probability: '48%',
                    icon: 'cloud-rain',
                    color: 'blue'
                },
                {
                    title: '短时漏电故障',
                    probability: '35%',
                    icon: 'tint',
                    color: 'green'
                }
            ],
            
            // 长期负损标签
            'long-negative': [
                {
                    title: '计量装置接线错误',
                    probability: '94%',
                    icon: 'plug',
                    color: 'red'
                },
                {
                    title: '电表正反向接错',
                    probability: '78%',
                    icon: 'exchange-alt',
                    color: 'orange'
                },
                {
                    title: '台户关系不一致',
                    probability: '63%',
                    icon: 'file-alt',
                    color: 'yellow'
                },
                {
                    title: '光伏发电档案错误',
                    probability: '42%',
                    icon: 'solar-panel',
                    color: 'blue'
                },
                {
                    title: '台区总表前接电',
                    probability: '38%',
                    icon: 'plug',
                    color: 'green'
                }
            ],
            
            // 小负损标签
            'small-negative': [
                {
                    title: '理论模型计算偏差',
                    probability: '89%',
                    icon: 'calculator',
                    color: 'red'
                },
                {
                    title: '采集数据偏差',
                    probability: '72%',
                    icon: 'database',
                    color: 'orange'
                },
                {
                    title: '互感器配置不合理',
                    probability: '58%',
                    icon: 'cogs',
                    color: 'yellow'
                },
                {
                    title: '电表时钟超差',
                    probability: '45%',
                    icon: 'clock',
                    color: 'blue'
                },
                {
                    title: '供电半径过长',
                    probability: '35%',
                    icon: 'ruler',
                    color: 'green'
                }
            ],
            
            // 突发负损标签
            'sudden-negative': [
                {
                    title: '电表计量故障',
                    probability: '91%',
                    icon: 'tachometer-alt',
                    color: 'red'
                },
                {
                    title: '功率因数补偿设备异常',
                    probability: '79%',
                    icon: 'bolt',
                    color: 'orange'
                },
                {
                    title: '台区总表某相异常',
                    probability: '64%',
                    icon: 'exclamation-triangle',
                    color: 'yellow'
                },
                {
                    title: '倍率变更未同步',
                    probability: '58%',
                    icon: 'sync',
                    color: 'blue'
                },
                {
                    title: '联合接线盒故障',
                    probability: '35%',
                    icon: 'box',
                    color: 'green'
                }
            ]
        };
        
        // 当前显示的异常类型
        let currentType = 'long-high';
        
        // 显示标签
        function renderTags(type) {
            currentType = type;
            const tagContainer = document.getElementById('diagnosticTags');
            tagContainer.innerHTML = '';
            
            // 添加标题
            const titleMap = {
                'long-high': '长期高损诊断标签',
                'sudden-high': '突发高损诊断标签',
                'long-negative': '长期负损诊断标签',
                'small-negative': '小负损诊断标签',
                'sudden-negative': '突发负损诊断标签'
            };
            
            const titleElement = document.createElement('h2');
            titleElement.className = 'text-lg font-medium text-gray-900 mb-4';
            titleElement.textContent = titleMap[type];
            tagContainer.appendChild(titleElement);
            
            // 添加切换按钮
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'flex flex-wrap gap-2 mb-4';
            
            Object.keys(titleMap).forEach(key => {
                const button = document.createElement('button');
                button.className = `px-3 py-1 rounded text-sm ${key === type ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`;
                button.textContent = titleMap[key];
                button.addEventListener('click', () => renderTags(key));
                buttonsContainer.appendChild(button);
            });
            
            tagContainer.appendChild(buttonsContainer);
            
            // 添加标签
            const tagsContainer = document.createElement('div');
            tagsContainer.className = 'flex flex-col space-y-3';
            
            diagnosticTags[type].forEach((tag, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = `flex items-center p-3 bg-${tag.color}-50 border border-${tag.color}-100 rounded-lg cursor-pointer hover:shadow-md transition-shadow`;
                tagElement.innerHTML = `
                    <div class="flex-shrink-0 h-10 w-10 flex items-center justify-center bg-${tag.color}-100 rounded-full">
                        <i class="fas fa-${tag.icon} text-${tag.color}-500"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-${tag.color}-800">${tag.title}</h3>
                        <p class="text-xs text-${tag.color}-700 mt-1">匹配概率：${tag.probability}</p>
                    </div>
                `;
                tagElement.addEventListener('click', () => showTagDetail(type, index));
                tagsContainer.appendChild(tagElement);
            });
            
            tagContainer.appendChild(tagsContainer);
        }
        
        // 显示标签详情弹窗
        function showTagDetail(type, tagIndex) {
            const tagData = diagnosticTags[type][tagIndex];
            const modal = document.getElementById('tagDetailModal');
            const modalTitle = document.getElementById('tagModalTitle');
            const modalContent = document.getElementById('tagModalContent');
            
            // 设置标题
            modalTitle.textContent = tagData.title;
            
            // 设置弹窗内容
            modalContent.innerHTML = '';
            
            // 针对CT互感器倍率错误标签显示特殊内容
            if (type === 'long-high' && tagData.title === 'CT互感器倍率错误') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">交互式排查工具</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="col-span-1">
                                <p class="text-xs text-gray-500 mb-1">调整CT倍率</p>
                                <div class="flex rounded-md shadow-sm">
                                    <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">当前</span>
                                    <input type="text" value="300/5" class="flex-1 min-w-0 block w-full px-3 py-1.5 rounded-none border border-gray-300 focus:ring-primary focus:border-primary text-sm">
                                    <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">A</span>
                                </div>
                                <div class="mt-2">
                                    <select class="block w-full pl-3 pr-10 py-1.5 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                        <option>模拟修正为 150/5 A</option>
                                        <option>模拟修正为 200/5 A</option>
                                        <option selected>模拟修正为 250/5 A</option>
                                        <option>模拟修正为 400/5 A</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-span-2">
                                <p class="text-xs text-gray-500 mb-1">修正后线损预测</p>
                                <div class="flex h-20 items-center">
                                    <div class="flex-1 flex items-center space-x-2">
                                        <div class="h-16 w-16 rounded-full bg-primary flex items-center justify-center text-white text-xl font-bold">
                                            6.51%
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">修正后预计线损率</p>
                                            <p class="text-xs text-green-500 font-medium mt-1">与理论线损偏差: +0.19%</p>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="relative w-full h-4 bg-gray-200 rounded">
                                            <div class="absolute h-4 bg-primary rounded" style="width: 21.7%;"></div>
                                        </div>
                                        <div class="flex justify-between mt-1 text-xs text-gray-500">
                                            <span>0%</span>
                                            <span>6.51%</span>
                                            <span>30%</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">线损率降低了 <span class="text-green-500 font-medium">6.25%</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>系统记录CT变比为<span class="text-red-500 font-medium">300/5</span>，但实际铭牌为<span class="text-primary font-medium">250/5</span></li>
                                <li>CT变比错误导致计量电流值偏低，计算得到的线损率偏高</li>
                                <li>修正变比后，线损率从<span class="text-red-500 font-medium">12.76%</span>降至<span class="text-green-500 font-medium">6.51%</span></li>
                                <li>修正后线损率与理论线损率<span class="text-primary font-medium">6.32%</span>相近，符合正常水平</li>
                            </ul>
                        </div>
                        <div class="mt-4 bg-green-50 p-3 rounded-md border border-green-100">
                            <p class="text-sm font-medium text-green-800 mb-1">治理建议</p>
                            <ol class="text-xs text-green-700 list-decimal pl-4">
                                <li>核实现场CT互感器实际型号，检查铭牌信息</li>
                                <li>修正系统中CT变比参数设置</li>
                                <li>校验电能计量装置，确保计量准确</li>
                                <li>建立计量设备档案更新机制，确保参数变更同步更新</li>
                            </ol>
                        </div>
                    </div>
                `;
            }
            
            // 针对三相不平衡度高标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '三相不平衡度高') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">三相不平衡度分析</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500">三相不平衡度</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">17.3%</span>
                                    <span class="text-xs text-gray-500 ml-1">(本台区)</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">12.1%</span>
                                    <span class="text-xs text-gray-500 ml-1">(对比组)</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">功率因数</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-primary rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">0.92</span>
                                    <span class="text-xs text-gray-500 ml-1">(本台区)</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">0.94</span>
                                    <span class="text-xs text-gray-500 ml-1">(对比组)</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 h-60">
                            <canvas id="phaseBalanceChartModal"></canvas>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>本台区三相不平衡度为<span class="text-yellow-500 font-medium">17.3%</span>，高于系统警戒值15%</li>
                                <li>A相和C相电流过高，B相电流明显偏低</li>
                                <li>三相不平衡会导致零序电流增大，引起额外线损</li>
                                <li>建议进行三相负荷均衡调整，优化配电侧运行效率</li>
                            </ul>
                        </div>
                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>检查三相负荷分布情况，调整单相负荷接入相位</li>
                                <li>排查B相接触不良或连接松动问题</li>
                                <li>监控三相负荷动态变化，适时调整</li>
                                <li>检查零线连接情况，确保接触良好</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const phaseCtx = document.getElementById('phaseBalanceChartModal').getContext('2d');
                    const phaseBalanceChartModal = new Chart(phaseCtx, {
                        type: 'bar',
                        data: {
                            labels: ['A相', 'B相', 'C相'],
                            datasets: [
                                {
                                    label: '本台区',
                                    data: [145, 98, 162],
                                    backgroundColor: '#309C9F',
                                },
                                {
                                    label: '对比组',
                                    data: [125, 118, 142],
                                    backgroundColor: '#9ca3af',
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: '电流 (A)'
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对用电负荷突增标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '用电负荷突增') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">线损率季节性变化</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500">本季度平均线损率</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">11.95%</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">去年同期平均线损率</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">6.48%</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 h-60">
                            <canvas id="seasonalLossChartModal"></canvas>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区线损率在近期内出现突然上升，从<span class="text-primary font-medium">6.2%</span>突增至<span class="text-red-500 font-medium">11.95%</span></li>
                                <li>分析近期负荷变化，发现<span class="text-red-500 font-medium">4月28日</span>起负荷增长了<span class="text-red-500 font-medium">32.6%</span></li>
                                <li>负荷突增程度超过理论线损模型的适用范围，导致实际线损与理论线损偏差增大</li>
                                <li>季节性因素分析显示，去年同期无类似突增现象，提示本次突增不属于季节性规律变化</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">关键节点分析</h3>
                            <div class="relative">
                                <div class="absolute h-full w-1 bg-gray-200 left-2.5 top-0"></div>
                                <div class="space-y-4 relative">
                                    <div class="flex items-start">
                                        <div class="h-5 w-5 rounded-full bg-red-500 flex-shrink-0 z-10"></div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-800">2023年4月28日</p>
                                            <p class="text-xs text-gray-600">线损率突然从6.2%上升至11.8%，同时用电负荷大幅增加</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="h-5 w-5 rounded-full bg-primary flex-shrink-0 z-10"></div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-800">2023年4月30日</p>
                                            <p class="text-xs text-gray-600">现场排查发现季节性空调设备大量启用</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start">
                                        <div class="h-5 w-5 rounded-full bg-gray-400 flex-shrink-0 z-10"></div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-800">2022年同期</p>
                                            <p class="text-xs text-gray-600">线损率稳定在6.3%~6.5%之间，属于正常范围</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-orange-50 p-3 rounded-md border border-orange-100">
                            <p class="text-sm font-medium text-orange-800 mb-1">治理建议</p>
                            <ol class="text-xs text-orange-700 list-decimal pl-4">
                                <li>评估台区负荷增长趋势，必要时及时进行增容改造</li>
                                <li>调整线损计算模型参数，适应负荷突增情况</li>
                                <li>巡查台区设备运行状态，确保大负荷下安全运行</li>
                                <li>分析用户用电构成，实行错峰用电指导</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const seasonalCtx = document.getElementById('seasonalLossChartModal').getContext('2d');
                    const seasonalLossChartModal = new Chart(seasonalCtx, {
                        type: 'line',
                        data: {
                            labels: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                            datasets: [
                                {
                                    label: '今年',
                                    data: [6.3, 6.2, 6.1, 11.9, null, null, null, null, null, null, null, null],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '去年',
                                    data: [6.5, 6.4, 6.5, 6.5, 6.4, 6.3, 6.2, 6.4, 6.5, 6.7, 6.8, 6.6],
                                    borderColor: '#9ca3af',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    min: 4,
                                    max: 14,
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对档案户变关系异常标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '档案户变关系异常') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">户变关系信息</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500">台区总表采集</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-primary rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">1/1</span>
                                    <span class="text-xs text-gray-500 ml-1">(100%)</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">用户表采集</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full mr-1"></div>
                                    <span class="text-sm font-medium">145/165</span>
                                    <span class="text-xs text-gray-500 ml-1">(87.9%)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">档案户变一致性分析</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">异常</span>
                            </div>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="border-r pr-2">
                                        <p class="text-xs text-gray-500">系统档案记录</p>
                                        <p class="text-sm font-medium mt-1">165个用户表</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">GIS识别结果</p>
                                        <p class="text-sm font-medium mt-1">193个用户表</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">空间距离异常</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">28个表</span>
                            </div>
                            <div class="h-60 mt-3">
                                <canvas id="distanceChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>系统档案记录<span class="text-primary font-medium">165</span>个用户表，但GIS空间识别到<span class="text-red-500 font-medium">193</span>个</li>
                                <li>存在<span class="text-red-500 font-medium">28个</span>用户表距离台区变压器超过<span class="text-red-500 font-medium">300米</span></li>
                                <li>通过电压相关性分析，发现<span class="text-red-500 font-medium">12个</span>表与本台区电压特征不符</li>
                                <li>系统户变关系档案可能存在错误，导致实际供电与计量不一致</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">异常户表清单</h3>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">表号</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">距离</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">疑似归属</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21025367</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">415m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853421台区</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21037842</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">368m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">A相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853428台区</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21041253</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">391m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853421台区</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21039685</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">325m</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">A相</td>
                                            <td class="px-3 py-1.5 text-xs text-blue-600">1853428台区</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bg-gray-50 px-3 py-1.5 text-xs text-gray-500 text-center">
                                    显示前4条 (共28条异常记录)
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-blue-50 p-3 rounded-md border border-blue-100">
                            <p class="text-sm font-medium text-blue-800 mb-1">治理建议</p>
                            <ol class="text-xs text-blue-700 list-decimal pl-4">
                                <li>开展现场实地测绘，核实用户表归属关系</li>
                                <li>调整系统档案记录，修正户变关系数据</li>
                                <li>对疑似归属错误的电表，进行专项抄表核实</li>
                                <li>建立户变关系定期核查机制，确保档案数据准确性</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const distCtx = document.getElementById('distanceChartModal').getContext('2d');
                    const distanceChartModal = new Chart(distCtx, {
                        type: 'scatter',
                        data: {
                            datasets: [
                                {
                                    label: '正常户表',
                                    data: [
                                        {x: 95, y: 0.92}, {x: 120, y: 0.91}, {x: 78, y: 0.94},
                                        {x: 105, y: 0.93}, {x: 135, y: 0.88}, {x: 165, y: 0.87},
                                        {x: 205, y: 0.85}, {x: 185, y: 0.86}, {x: 225, y: 0.82},
                                        {x: 175, y: 0.85}, {x: 215, y: 0.83}, {x: 145, y: 0.87},
                                        {x: 235, y: 0.81}, {x: 255, y: 0.80}, {x: 195, y: 0.85},
                                        {x: 265, y: 0.78}, {x: 245, y: 0.80}, {x: 275, y: 0.77},
                                        {x: 215, y: 0.84}, {x: 285, y: 0.76}, {x: 115, y: 0.91}
                                    ],
                                    backgroundColor: '#3b82f6',
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                },
                                {
                                    label: '异常户表',
                                    data: [
                                        {x: 415, y: 0.45}, {x: 368, y: 0.52}, {x: 391, y: 0.49},
                                        {x: 325, y: 0.55}, {x: 435, y: 0.42}, {x: 358, y: 0.53},
                                        {x: 402, y: 0.47}, {x: 382, y: 0.51}, {x: 425, y: 0.44},
                                        {x: 345, y: 0.54}, {x: 372, y: 0.52}, {x: 408, y: 0.46}
                                    ],
                                    backgroundColor: '#ef4444',
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `距离: ${context.parsed.x}m, 电压相关性: ${context.parsed.y}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: '距离台区变压器距离 (米)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 450
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: '电压相关性系数'
                                    },
                                    suggestedMin: 0.4,
                                    suggestedMax: 1
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对疑似低压窃电标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '疑似低压窃电') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">窃电风险指标</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">异常事件数量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">17</span>
                                    <span class="text-xs text-gray-500 ml-1">次/月</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">高于正常水平 (2.5次)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">用电量异常下降</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">-68%</span>
                                    <span class="text-xs text-gray-500 ml-1">环比变化</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">低于历史均值 (±15%)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">负荷曲线异常</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">83%</span>
                                    <span class="text-xs text-gray-500 ml-1">异常度</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">偏离正常模式</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">关键事件记录</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">高频异常</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">发生时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">风险等级</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">强磁场干扰</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-15 23:42</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-297</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">表箱门打开</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-16 02:18</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-291</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">端子盖打开</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-16 02:21</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-289</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流反向</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">04-16 02:47</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-249</td>
                                            <td class="px-3 py-1.5"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">高</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-3">用电负荷异常分析</h3>
                            <div class="h-60">
                                <canvas id="stealingChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>用户电表在<span class="text-red-500 font-medium">4月15日23:42</span>至<span class="text-red-500 font-medium">4月16日凌晨</span>期间出现多个高风险事件</li>
                                <li>事件包括强磁场干扰、表箱开启、端子盖打开和电流反向，符合典型窃电特征</li>
                                <li>事件发生后，用电量下降<span class="text-red-500 font-medium">68%</span>，与用户历史用电规律严重偏离</li>
                                <li>夜间负荷异常波动，与同类用户负荷曲线差异度达到<span class="text-red-500 font-medium">83%</span></li>
                                <li>综合分析认为该用户存在人为窃电可能性，建议立即现场核查</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>立即派专业抄核人员进行现场检查，重点检查电表接线、表计密封</li>
                                <li>对电能表进行准确性检测，排查是否存在人为干扰计量</li>
                                <li>进行用电量追补测算，复盘分析窃电量</li>
                                <li>联合稽查部门开展联合执法检查，固定证据</li>
                                <li>加装智能防窃电装置，增加远程监控密度</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const stealCtx = document.getElementById('stealingChartModal').getContext('2d');
                    const stealingChartModal = new Chart(stealCtx, {
                        type: 'line',
                        data: {
                            labels: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
                            datasets: [
                                {
                                    label: '当前日期',
                                    data: [1.2, 1.1, 1.0, 0.3, 0.2, 0.3, 0.4, 0.3, 0.2, 0.3, 0.5, 0.6],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '历史同期均值',
                                    data: [1.1, 1.0, 1.1, 1.2, 1.5, 1.8, 2.1, 2.0, 1.7, 1.6, 1.5, 1.3],
                                    borderColor: '#3b82f6',
                                    borderDash: [5, 5],
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '异常事件点',
                                    data: [null, null, 0.3, null, null, null, null, null, null, null, null, null],
                                    borderColor: '#ef4444',
                                    backgroundColor: '#ef4444',
                                    borderWidth: 0,
                                    pointRadius: 6,
                                    pointHoverRadius: 8,
                                    pointStyle: 'triangle'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            if (context.datasetIndex === 2) {
                                                return '异常事件发生点';
                                            }
                                            return `${context.dataset.label}: ${context.parsed.y} kW`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '负荷 (kW)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 2.5
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对电能表超容量运行标签显示特殊内容
            else if (type === 'long-high' && tagData.title === '电能表超容量运行') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">设备运行状态</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">电表额定容量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-gray-700">80</span>
                                    <span class="text-xs text-gray-500 ml-1">A</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-1"></div>
                                    <span class="text-xs text-gray-500">标准配置</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">最大负荷电流</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">97.5</span>
                                    <span class="text-xs text-gray-500 ml-1">A</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超出额定容量 (121.9%)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">过载时长</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">17.3</span>
                                    <span class="text-xs text-gray-500 ml-1">小时/周</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">高风险运行状态</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">负荷走势分析</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">持续上升</span>
                            </div>
                            <div class="h-60">
                                <canvas id="overloadChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">过流告警事件</h3>
                                <span class="text-xs py-1 px-2 bg-orange-100 text-orange-800 rounded-full">频繁</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">发生时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">电流值</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-12 19:35</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-255</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">97.5A</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-11 19:42</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-255</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">96.8A</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">A相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-10 19:28</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-251</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">92.7A</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">C相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-09 19:38</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-255</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">95.2A</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>该电表额定容量为<span class="text-primary font-medium">80A</span>，实际最大电流达<span class="text-red-500 font-medium">97.5A</span>，超出额定容量<span class="text-red-500 font-medium">21.9%</span></li>
                                <li>过载运行时间累计达到每周<span class="text-red-500 font-medium">17.3小时</span>，主要发生在晚高峰</li>
                                <li>C相电流值最高，电流过载事件主要集中在C相，提示三相负荷分布不均</li>
                                <li>近一周内电表发生<span class="text-red-500 font-medium">13次</span>过流告警事件，频率呈上升趋势</li>
                                <li>电表长期超负荷运行可能导致计量误差增大、设备损坏和安全风险</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">设备风险评估</h3>
                            </div>
                            <div class="bg-white rounded-lg p-3 border">
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-primary bg-primary-light">
                                                计量误差风险
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-primary">
                                                中等
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 65%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-primary"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                设备损坏风险
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                高风险
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                安全隐患风险
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                高风险
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-green-50 p-3 rounded-md border border-green-100">
                            <p class="text-sm font-medium text-green-800 mb-1">治理建议</p>
                            <ol class="text-xs text-green-700 list-decimal pl-4">
                                <li>更换更大容量的电能表，建议选用100A或150A量程</li>
                                <li>优化三相负荷分布，降低C相负荷比例</li>
                                <li>对用户用电情况进行评估，必要时增容改造</li>
                                <li>安装负荷监测装置，实时监控电表运行状态</li>
                                <li>加强安全巡检，消除设备过热引发的安全隐患</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const overloadCtx = document.getElementById('overloadChartModal').getContext('2d');
                    const overloadChartModal = new Chart(overloadCtx, {
                        type: 'line',
                        data: {
                            labels: ['5-6', '5-7', '5-8', '5-9', '5-10', '5-11', '5-12', '5-13'],
                            datasets: [
                                {
                                    label: 'A相最大电流',
                                    data: [72.3, 75.8, 81.2, 85.7, 92.7, 90.2, 91.5, 90.8],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                },
                                {
                                    label: 'B相最大电流',
                                    data: [68.7, 70.2, 72.6, 74.1, 77.3, 78.9, 81.2, 82.5],
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                },
                                {
                                    label: 'C相最大电流',
                                    data: [78.5, 82.3, 87.9, 95.2, 94.7, 96.8, 97.5, 95.9],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                },
                                {
                                    label: '额定容量',
                                    data: [80, 80, 80, 80, 80, 80, 80, 80],
                                    borderColor: '#9ca3af',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    pointRadius: 0,
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '电流 (A)'
                                    },
                                    suggestedMin: 60,
                                    suggestedMax: 100
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对新增用户接入异常标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '新增用户接入异常') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">台区用户变动监测</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">新增用户数量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-yellow-500">7</span>
                                    <span class="text-xs text-gray-500 ml-1">户</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-yellow-500">较正常月增长183%</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">新增负荷容量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">38.7</span>
                                    <span class="text-xs text-gray-500 ml-1">kW</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">台区总容量的21.5%</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率变化</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">+4.8%</span>
                                    <span class="text-xs text-gray-500 ml-1">绝对值</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">高于预警阈值(2.5%)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">新增用户情况</h3>
                                <span class="text-xs py-1 px-2 bg-yellow-100 text-yellow-800 rounded-full">异常用电特征</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">表号</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">用电类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">接入时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">负荷容量</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253489</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">工业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-22</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">14.5kW</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253492</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">工业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-22</td>
                                            <td class="px-3 py-1.5 text-xs text-red-600 font-medium">12.8kW</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253495</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">工业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-22</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">5.2kW</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">21253501</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">商业用电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">05-23</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">6.2kW</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bg-gray-50 px-3 py-1.5 text-xs text-gray-500 text-center">
                                    显示4条 (共7条记录)
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-3">线损率与用户数变化趋势</h3>
                            <div class="h-60">
                                <canvas id="newUserChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-yellow-500 font-medium">5月22日至23日</span>期间集中新增<span class="text-yellow-500 font-medium">7户</span>用户</li>
                                <li>新增用户中工业用电比例高达<span class="text-red-500 font-medium">71.4%</span>，与台区现有用户结构不符</li>
                                <li>新增容量<span class="text-red-500 font-medium">38.7kW</span>，占台区总容量的<span class="text-red-500 font-medium">21.5%</span>，已超过台区剩余容量</li>
                                <li>线损率在新增用户接入后<span class="text-red-500 font-medium">急剧攀升</span>，从6.3%上升至11.1%</li>
                                <li>新增接入用户中<span class="text-red-500 font-medium">未进行负荷测算和容量评估</span>，导致台区重载运行</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">异常识别</h3>
                            </div>
                            <div class="bg-white rounded-lg p-3 border">
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                用户接入规范性
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                严重不规范
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-500 bg-red-100">
                                                台区负荷水平
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-red-500">
                                                超载运行
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 90%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"></div>
                                    </div>
                                </div>
                                <div class="relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-500 bg-yellow-100">
                                                线损异常指数
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-yellow-500">
                                                高度异常
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                        <div style="width: 75%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-yellow-50 p-3 rounded-md border border-yellow-100">
                            <p class="text-sm font-medium text-yellow-800 mb-1">治理建议</p>
                            <ol class="text-xs text-yellow-700 list-decimal pl-4">
                                <li>对新增用户开展负荷测算和验收检查，确保接入规范性</li>
                                <li>调整台区负荷分布，必要时分流部分用户至相邻台区</li>
                                <li>开展台区增容改造评估，加装无功补偿装置</li>
                                <li>完善新用户接入流程管理，规范负荷评估和容量验证</li>
                                <li>重点监测工业用户负荷特性，避免低质量用电影响线损指标</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const newUserCtx = document.getElementById('newUserChartModal').getContext('2d');
                    const newUserChartModal = new Chart(newUserCtx, {
                        type: 'line',
                        data: {
                            labels: ['5-17', '5-18', '5-19', '5-20', '5-21', '5-22', '5-23', '5-24', '5-25', '5-26'],
                            datasets: [
                                {
                                    label: '线损率(%)',
                                    data: [6.3, 6.2, 6.4, 6.3, 6.5, 8.8, 11.1, 11.3, 11.2, 11.0],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '用户数量',
                                    data: [145, 145, 145, 146, 146, 151, 153, 153, 153, 153],
                                    borderColor: '#3b82f6',
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    min: 5,
                                    max: 12,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '用户数量'
                                    },
                                    min: 140,
                                    max: 160,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对低压设备故障标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '低压设备故障') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">故障情况分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">故障开始时间</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-gray-700">06-05</span>
                                    <span class="text-xs text-gray-500 ml-1">22:47</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-orange-500">夜间高峰时段</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率异常上升</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">+9.6%</span>
                                    <span class="text-xs text-gray-500 ml-1">绝对值</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">突发性异常</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">电压波动</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">±12.3%</span>
                                    <span class="text-xs text-gray-500 ml-1">波动范围</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超出标准限值</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">电压异常分析</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">断相/接触不良</span>
                            </div>
                            <div class="h-60">
                                <canvas id="voltageChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">异常事件记录</h3>
                                <span class="text-xs py-1 px-2 bg-orange-100 text-orange-800 rounded-full">设备故障</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电压过低</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:47</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-5635</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相缺相</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:55</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-204</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:55</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-279</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电压不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">06-05 22:56</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-283</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">巡检排查情况</h3>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-bolt text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">熔断器故障</p>
                                            <p class="text-xs text-gray-500">6月6日01:15分现场巡检发现B相熔断器烧毁</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-plug text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">接头连接故障</p>
                                            <p class="text-xs text-gray-500">导线接头过热，绝缘层有烧蚀痕迹</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-green-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-tools text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">故障处理</p>
                                            <p class="text-xs text-gray-500">更换熔断器并重新压接导线接头，故障排除时间：6月6日03:20</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-red-500 font-medium">06月05日22:47</span>开始出现B相电压异常，随后发生断相</li>
                                <li>事件发生后，台区线损率迅速上升<span class="text-red-500 font-medium">9.6%</span>，达到<span class="text-red-500 font-medium">15.9%</span></li>
                                <li>主要故障原因为<span class="text-red-500 font-medium">B相熔断器烧毁</span>以及<span class="text-red-500 font-medium">导线接头过热</span></li>
                                <li>故障持续时长<span class="text-yellow-500 font-medium">4小时33分钟</span>，影响台区<span class="text-yellow-500 font-medium">47户</span>用户</li>
                                <li>缺相运行期间，A相和C相电流增大，出现<span class="text-red-500 font-medium">三相不平衡</span>情况</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-orange-50 p-3 rounded-md border border-orange-100">
                            <p class="text-sm font-medium text-orange-800 mb-1">治理建议</p>
                            <ol class="text-xs text-orange-700 list-decimal pl-4">
                                <li>加强台区关键点导线接头红外测温，排查过热隐患</li>
                                <li>开展台区熔断器老化替换计划，优先更换投运超5年熔断器</li>
                                <li>优化三相负荷分布，降低单相负荷集中度</li>
                                <li>对线路关键节点进行标识，提高紧急抢修效率</li>
                                <li>完善突发故障快速响应机制，减少故障持续时间</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const voltageCtx = document.getElementById('voltageChartModal').getContext('2d');
                    const voltageChartModal = new Chart(voltageCtx, {
                        type: 'line',
                        data: {
                            labels: ['22:00', '22:30', '23:00', '23:30', '00:00', '00:30', '01:00', '01:30', '02:00', '02:30', '03:00', '03:30'],
                            datasets: [
                                {
                                    label: 'A相电压(V)',
                                    data: [220, 218, 223, 225, 230, 232, 233, 231, 229, 226, 223, 221],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: 'B相电压(V)',
                                    data: [219, 217, 202, 165, 32, 0, 0, 0, 0, 0, 0, 210],
                                    borderColor: '#10b981',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: 'C相电压(V)',
                                    data: [222, 220, 225, 228, 233, 237, 235, 230, 227, 225, 222, 220],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    tension: 0.3
                                },
                                {
                                    label: '故障发生点',
                                    data: [null, null, 202, null, null, null, null, null, null, null, null, null],
                                    borderColor: '#ef4444',
                                    backgroundColor: '#ef4444',
                                    borderWidth: 0,
                                    pointRadius: 6,
                                    pointHoverRadius: 8,
                                    pointStyle: 'triangle'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            if (context.datasetIndex === 3) {
                                                return '故障发生点';
                                            }
                                            return `${context.dataset.label}: ${context.parsed.y} V`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: '电压 (V)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 250
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对恶劣天气引发问题标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '恶劣天气引发问题') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">天气情况分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">天气状况</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-blue-600">暴雨</span>
                                    <span class="text-xs text-gray-500 ml-1">雷暴</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-blue-600 rounded-full mr-1"></div>
                                    <span class="text-xs text-blue-600">气象台Ⅲ级预警</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">降雨量</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">87.5</span>
                                    <span class="text-xs text-gray-500 ml-1">mm/3h</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超出警戒值(50mm)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率波动</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">+7.2%</span>
                                    <span class="text-xs text-gray-500 ml-1">暴雨期间</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">短期波动异常</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">台区运行状态变化</h3>
                                <span class="text-xs py-1 px-2 bg-blue-100 text-blue-800 rounded-full">降雨影响</span>
                            </div>
                            <div class="h-60">
                                <canvas id="weatherChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">异常事件记录</h3>
                                <span class="text-xs py-1 px-2 bg-blue-100 text-blue-800 rounded-full">暴雨相关</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">关联天气</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 18:42</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-279</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">降雨初期</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">接地故障</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 19:15</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-307</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">降雨高峰</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">短时掉电</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 19:27</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-7</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">雷击频发</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">功率因数异常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">07-12 19:50</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-301</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">持续降雨</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">现场检查情况</h3>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-blue-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-tint text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">配电箱浸水</p>
                                            <p class="text-xs text-gray-500">多处低洼地带配电箱遭雨水浸泡，引起短路故障</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-bolt text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">设备接地泄漏</p>
                                            <p class="text-xs text-gray-500">雨水浸泡导致部分设备接地不良，引发泄漏电流增大</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white flex-shrink-0">
                                            <i class="fas fa-exclamation-triangle text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">防雷器损坏</p>
                                            <p class="text-xs text-gray-500">多处配电设施防雷装置失效，发现1处雷击痕迹</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-blue-600 font-medium">7月12日</span>遭遇<span class="text-blue-600 font-medium">暴雨雷暴天气</span>，3小时降雨量达<span class="text-red-500 font-medium">87.5mm</span></li>
                                <li>降雨导致多处配电设施<span class="text-red-500 font-medium">浸水</span>，引起接地泄漏电流增大</li>
                                <li>暴雨期间台区线损率<span class="text-red-500 font-medium">短时异常升高</span>，从6.3%上升至13.5%</li>
                                <li>防雷设施发挥有限作用，仍有<span class="text-red-500 font-medium">1处遭雷击</span>导致设备损坏</li>
                                <li>暴雨过后，线损恢复正常，但<span class="text-yellow-500 font-medium">波动幅度较大</span>，与设备潮湿有关</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-blue-50 p-3 rounded-md border border-blue-100">
                            <p class="text-sm font-medium text-blue-800 mb-1">治理建议</p>
                            <ol class="text-xs text-blue-700 list-decimal pl-4">
                                <li>提升低洼地带配电设施防水等级，增设防水墙和排水设施</li>
                                <li>增强防雷系统建设，更新老化避雷器</li>
                                <li>优化恶劣天气预警机制，提前做好应急准备</li>
                                <li>针对设备接地系统开展专项检查，提升绝缘等级</li>
                                <li>建立台区"一站一案"极端天气应对方案</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const weatherCtx = document.getElementById('weatherChartModal').getContext('2d');
                    const weatherChartModal = new Chart(weatherCtx, {
                        type: 'line',
                        data: {
                            labels: ['16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00', '00:00', '01:00', '02:00'],
                            datasets: [
                                {
                                    label: '线损率(%)',
                                    data: [6.3, 6.4, 8.2, 13.5, 12.7, 11.3, 9.5, 8.3, 7.4, 6.8, 6.5],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '降雨量(mm)',
                                    data: [2, 8, 22, 38, 27, 19, 12, 5, 2, 0, 0],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.3)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y1'
                                },
                                {
                                    label: '雷击次数',
                                    data: [0, 0, 3, 7, 4, 2, 1, 0, 0, 0, 0],
                                    borderColor: '#f59e0b',
                                    backgroundColor: '#f59e0b',
                                    borderWidth: 0,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    yAxisID: 'y2'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    suggestedMin: 5,
                                    suggestedMax: 15
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '降雨量 (mm)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 40,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                },
                                y2: {
                                    type: 'linear',
                                    display: false,
                                    position: 'right',
                                    suggestedMin: 0,
                                    suggestedMax: 10
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 针对短时漏电故障标签显示特殊内容
            else if (type === 'sudden-high' && tagData.title === '短时漏电故障') {
                modalContent.innerHTML = `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">漏电故障分析</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">故障持续时长</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-green-600">1.5</span>
                                    <span class="text-xs text-gray-500 ml-1">小时</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-green-600 rounded-full mr-1"></div>
                                    <span class="text-xs text-green-600">短暂性故障</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">漏电电流大小</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-red-500">2.8</span>
                                    <span class="text-xs text-gray-500 ml-1">A</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-red-500">超过安全阈值(0.5A)</span>
                                </div>
                            </div>
                            <div class="rounded-lg bg-white p-3 border">
                                <p class="text-xs text-gray-500 mb-1">线损率波动</p>
                                <div class="flex items-center">
                                    <span class="text-lg font-bold text-yellow-500">+5.2%</span>
                                    <span class="text-xs text-gray-500 ml-1">故障期间</span>
                                </div>
                                <div class="flex items-center mt-1">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div>
                                    <span class="text-xs text-yellow-500">中度异常</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">漏电电流趋势</h3>
                                <span class="text-xs py-1 px-2 bg-red-100 text-red-800 rounded-full">绝缘性故障</span>
                            </div>
                            <div class="h-60">
                                <canvas id="leakageChartModal"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-medium text-gray-700">发生的事件</h3>
                                <span class="text-xs py-1 px-2 bg-green-100 text-green-800 rounded-full">自愈性故障</span>
                            </div>
                            <div class="bg-white rounded-lg border overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件类型</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">时间</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">事件编码</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500">相位</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流不平衡</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 14:22</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-279</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">L2电流异常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 14:23</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-309</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">B相</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">PE-N电压异常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 14:25</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-303</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">N线</td>
                                        </tr>
                                        <tr>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">电流恢复正常</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">08-03 15:53</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">Event-280</td>
                                            <td class="px-3 py-1.5 text-xs text-gray-900">三相</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">故障定位分析</h3>
                            <div class="bg-white rounded-lg border p-3">
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex">
                                        <div class="h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white flex-shrink-0 mt-0.5">
                                            <i class="fas fa-map-marker-alt text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">故障位置</p>
                                            <p class="text-xs text-gray-500">台区支线末端211号电缆分接箱</p>
                                            <div class="mt-1 flex space-x-2">
                                                <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs">B相</span>
                                                <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs">分接箱</span>
                                                <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs">接地系统</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 pb-3 border-b border-gray-100">
                                    <div class="flex">
                                        <div class="h-6 w-6 rounded-full bg-yellow-500 flex items-center justify-center text-white flex-shrink-0 mt-0.5">
                                            <i class="fas fa-exclamation-circle text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">故障特征</p>
                                            <p class="text-xs text-gray-500">电缆终端头绝缘层老化，潮湿环境下引发暂时性接地故障</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex">
                                        <div class="h-6 w-6 rounded-full bg-green-500 flex items-center justify-center text-white flex-shrink-0 mt-0.5">
                                            <i class="fas fa-check-circle text-xs"></i>
                                        </div>
                                        <div class="ml-2">
                                            <p class="text-sm font-medium">自愈现象</p>
                                            <p class="text-xs text-gray-500">随着绝缘层干燥，漏电电流逐渐减小至安全范围，故障自动消除</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            <p class="font-medium mb-2">分析结论：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>台区在<span class="text-yellow-500 font-medium">8月3日14:22</span>开始出现漏电故障，持续<span class="text-green-600 font-medium">1.5小时</span>后自愈</li>
                                <li>漏电电流峰值达<span class="text-red-500 font-medium">2.8A</span>，属于较大漏电电流，主要路径经过<span class="text-red-500 font-medium">B相</span>和<span class="text-red-500 font-medium">接地线</span></li>
                                <li>故障期间线损率上升<span class="text-yellow-500 font-medium">5.2%</span>，随漏电电流下降逐渐恢复正常</li>
                                <li>根据波形分析，故障性质为<span class="text-yellow-500 font-medium">湿度导致的暂时性绝缘降低</span></li>
                                <li>此类漏电故障具有<span class="text-green-600 font-medium">间歇性</span>特点，可能在潮湿条件下再次发生</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-green-50 p-3 rounded-md border border-green-100">
                            <p class="text-sm font-medium text-green-800 mb-1">治理建议</p>
                            <ol class="text-xs text-green-700 list-decimal pl-4">
                                <li>对211号分接箱进行绝缘测试，更换老化的电缆终端头</li>
                                <li>加强接地系统检查，改善接地连接点的防潮措施</li>
                                <li>安装漏电监测装置，对此类易发故障点进行重点监控</li>
                                <li>对潮湿环境下的电气设备增加防潮措施，如增设保护罩</li>
                                <li>制定预防性维护计划，定期对老化电缆终端进行更换</li>
                            </ol>
                        </div>
                    </div>
                `;
                
                // 初始化图表
                setTimeout(() => {
                    const leakageCtx = document.getElementById('leakageChartModal').getContext('2d');
                    const leakageChartModal = new Chart(leakageCtx, {
                        type: 'line',
                        data: {
                            labels: ['14:00', '14:15', '14:30', '14:45', '15:00', '15:15', '15:30', '15:45', '16:00', '16:15', '16:30'],
                            datasets: [
                                {
                                    label: '漏电电流(A)',
                                    data: [0.2, 0.3, 2.8, 2.5, 1.8, 1.3, 0.8, 0.5, 0.3, 0.2, 0.2],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    fill: true,
                                    borderWidth: 2,
                                    tension: 0.3,
                                    yAxisID: 'y'
                                },
                                {
                                    label: '线损率(%)',
                                    data: [6.3, 6.4, 11.5, 11.2, 10.3, 9.5, 8.2, 7.5, 6.8, 6.4, 6.3],
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    tension: 0.3,
                                    yAxisID: 'y1'
                                },
                                {
                                    label: '安全阈值',
                                    data: [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5],
                                    borderColor: '#22c55e',
                                    backgroundColor: 'transparent',
                                    borderWidth: 2,
                                    borderDash: [2, 2],
                                    pointRadius: 0,
                                    tension: 0,
                                    yAxisID: 'y'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    align: 'end',
                                    labels: {
                                        boxWidth: 10,
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '漏电电流 (A)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 3
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '线损率 (%)'
                                    },
                                    suggestedMin: 5,
                                    suggestedMax: 12,
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                }, 100);
            }
            
            // 显示弹窗
            modal.classList.remove('hidden');
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 渲染标签
            renderTags('long-high');
            
            // 标签弹窗关闭按钮
            const closeTagModalBtn = document.getElementById('closeTagModal');
            const tagModal = document.getElementById('tagDetailModal');
            
            closeTagModalBtn.addEventListener('click', function() {
                tagModal.classList.add('hidden');
            });
            
            // 点击弹窗外部关闭
            tagModal.addEventListener('click', function(event) {
                if (event.target === tagModal) {
                    tagModal.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html> 