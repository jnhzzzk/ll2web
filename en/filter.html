<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area Filtering - Line Loss Diagnostic Analysis Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Add Choices.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <!-- Custom styles for hierarchical dropdown -->
    <style>
        /* Style for optgroups in Choices.js */
        .choices__list--dropdown .choices__list optgroup {
            padding: 8px 0 0 12px;
            font-weight: 600;
            color: #4b5563;
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 5px;
        }
        
        .choices__list--dropdown .choices__list optgroup option {
            margin-left: 12px;
            padding-left: 8px;
            font-weight: normal;
            color: #374151;
            border-left: 2px solid #e5e7eb;
        }
        
        .choices__list--dropdown .choices__list optgroup option:hover {
            background-color: #e6f1f1;
        }
        
        /* Highlight parent area in selected items */
        .choices__list--multiple .choices__item strong {
            font-weight: 600;
            color: #256e70;
        }

        /* Make sure optgroups are properly displayed */
        .choices__list {
            padding: 0;
            margin: 0;
            list-style: none;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#309C9F',
                        'primary-light': '#e6f1f1',
                        'primary-dark': '#256e70',
                    }
                }
            }
        }
    </script>
    <!-- Add Choices.js JS -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Top Navigation Bar -->
    <nav class="bg-white border-b border-gray-200 fixed w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center relative">
                        <span id="main-menu-button" class="text-primary text-xl font-bold cursor-pointer flex items-center">
                            Line Loss Diagnostic Analysis Application
                            <svg class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </span>
                        <div id="main-menu-dropdown" class="absolute left-0 top-full mt-1 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden">
                            <a href="/en" class="block px-4 py-2 text-sm text-gray-700 hover:bg-primary-light hover:text-primary">
                                Overview Statistics
                            </a>
                            <a href="/en/filter" class="block px-4 py-2 text-sm text-gray-700 bg-primary-light text-primary">
                                Filter Configuration
                            </a>
                            <a href="/en/diagnostic" class="block px-4 py-2 text-sm text-gray-700 hover:bg-primary-light hover:text-primary">
                                Diagnostic Analysis
                            </a>
                            <a href="/en/governance" class="block px-4 py-2 text-sm text-gray-700 hover:bg-primary-light hover:text-primary">
                                Governance Suggestions
                            </a>
                        </div>
                    </div>
                </div>
                <div class="flex items-center">
                    <span class="text-sm text-gray-600 mr-2">Engineer Wang</span>
                    <a href="/cn/filter" class="px-3 py-1 rounded-md text-sm font-medium text-white bg-primary hover:bg-primary-dark mr-3">中文</a>
                    <img class="h-8 w-8 rounded-full" src="https://api.dicebear.com/7.x/avataaars/svg?seed=John" alt="User Avatar">
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="pt-16 pb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Page Title -->
            <div class="mt-6 mb-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-900">Area Filtering</h1>
                <div>
                    <!-- Generate Report button removed from here -->
                </div>
            </div>

            <!-- Add Tab Page Switching -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex">
                    <button id="tab-reports" class="bg-white inline-flex py-4 px-6 border-b-2 border-primary text-sm font-medium text-primary focus:outline-none">
                        Abnormal Area Report
                    </button>
                    <button id="tab-abnormal-filter" class="bg-white inline-flex py-4 px-6 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 focus:outline-none">
                        Abnormal Area Filtering
                    </button>
                </nav>
            </div>

            <!-- Abnormal Area Report Content -->
            <div id="content-reports">
                <div class="bg-white rounded-lg shadow-sm mb-6">
                    <div class="px-5 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h2 class="text-lg font-medium text-gray-900">Line Loss Abnormal Area Report</h2>
                        <!-- Replace the static text with the dropdown -->
                        <div class="relative w-80"> <!-- Adjusted width -->
                            <select id="report-history-filter" class="block w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                <option>Select History Report...</option>
                                <option>2024-03-15 14:30:22 - Filter A - Line Loss Window: 2024-04-10 - 2024-05-10</option>
                                <option>2024-03-14 16:45:18 - Filter A - Line Loss Window: 2024-04-10 - 2024-05-10</option>
                                <option>2024-03-13 09:12:35 - Filter A - Line Loss Window: 2024-04-10 - 2024-05-10</option>
                                <option>2024-03-12 11:28:47 - Filter B - Line Loss Window: 2024-04-10 - 2024-05-10</option>
                                <option>2024-03-11 15:33:56 - Filter B - Line Loss Window: 2024-04-10 - 2024-05-10</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="p-5">
                        <!-- Quick Filter Options -->
                        <div class="flex flex-wrap gap-3 mb-4">
                            <div class="w-40">
                                <label class="block text-xs font-medium text-gray-700 mb-1">Region</label>
                                <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                    <option>All Regions</option>
                                    <option>East Area</option>
                                    <option>West Area</option>
                                    <option>South Area</option>
                                    <option>North Area</option>
                                    <option>Development Area</option>
                                </select>
                            </div>
                            <div class="w-40">
                                <label class="block text-xs font-medium text-gray-700 mb-1">Abnormality Type</label>
                                <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                    <option>All Abnormalities</option>
                                    <option>Long-term High Loss</option>
                                    <option>Sudden High Loss</option>
                                    <option>Long-term Negative Loss</option>
                                    <option>Slight Negative Loss</option>
                                    <option>Sudden Negative Loss</option>
                                </select>
                            </div>
                            <div class="w-40">
                                <label class="block text-xs font-medium text-gray-700 mb-1">Area Type</label>
                                <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                    <option>All Types</option>
                                    <option>Residential</option>
                                    <option>Commercial</option>
                                    <option>Industrial</option>
                                    <option>Mixed</option>
                                </select>
                            </div>
                            <!-- Date Range Selection -->
                            <div class="flex-grow">
                                <label class="block text-xs font-medium text-gray-700 mb-1">Date Range</label>
                                <div class="flex items-center space-x-2">
                                    <input type="date" class="w-full py-1.5 px-3 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                    <span class="text-gray-500">to</span>
                                    <input type="date" class="w-full py-1.5 px-3 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                    <button class="bg-primary hover:bg-primary-dark text-white p-2 rounded-md ml-2">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Abnormal Area Report Table -->
                        <div class="overflow-x-auto border border-gray-200 rounded-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Area Name
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Region
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Actual Loss Rate
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Theoretical Loss Rate
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Loss Difference
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Main Meter Reading (kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Consumption (kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Loss Amount (kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Deviation Loss (kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Date Occurred
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Abnormal Status
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Area Type
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Renewable Energy
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Action
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <!-- Long-term High Loss -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            河西变1324台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Hexi District
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            12.76%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            6.32%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500 font-medium">
                                            +6.44%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4,823
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4,208
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            615
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500">
                                            +310
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-08
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                                Long-term High Loss
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Residential
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            None
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=longHigh" class="text-primary hover:text-primary-dark">Diagnostic Analysis</a>
                                        </td>
                                    </tr>
                                    <!-- Sudden High Loss -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            城南532台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            South Area
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            10.21%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4.66%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500 font-medium">
                                            +5.55%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            3,612
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            3,243
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            369
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500">
                                            +200
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-07
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                                Sudden High Loss
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Commercial
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Photovoltaic
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=suddenHigh" class="text-primary hover:text-primary-dark">Diagnostic Analysis</a>
                                        </td>
                                    </tr>
                                    <!-- Long-term Negative Loss -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            北郊198台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            North Area
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            3.21%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            7.45%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500 font-medium">
                                            -4.24%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2,850
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2,758
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            92
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500">
                                            -120
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-07
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                Long-term Negative Loss
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Residential
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            None
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=longNegative" class="text-primary hover:text-primary-dark">Diagnostic Analysis</a>
                                        </td>
                                    </tr>
                                    <!-- Slight Negative Loss -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            东湖785台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            East Area
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            3.58%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4.85%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500 font-medium">
                                            -1.27%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            5,105
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4,922
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            183
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500">
                                            -65
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-08
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                Slight Negative Loss
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Mixed
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Wind Power
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=smallNegative" class="text-primary hover:text-primary-dark">Diagnostic Analysis</a>
                                        </td>
                                    </tr>
                                    <!-- Sudden Negative Loss -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            开发区672台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Development Area
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            2.13%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            5.37%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500 font-medium">
                                            -3.24%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            6,780
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            6,636
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            144
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500">
                                            -220
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-08
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                Sudden Negative Loss
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            Industrial
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            None
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=suddenNegative" class="text-primary hover:text-primary-dark">Diagnostic Analysis</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <div class="flex items-center justify-between mt-4">
                            <div class="text-sm text-gray-700">
                                Total <span class="font-medium">87</span> abnormal areas
                            </div>
                            <div class="flex space-x-2">
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">Previous</button>
                                <button class="bg-primary px-3 py-1 rounded text-sm text-white">1</button>
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">2</button>
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">3</button>
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">Next</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Abnormal Area Filtering (Merged Content) -->
            <div id="content-abnormal-filter" class="hidden space-y-6">
                <!-- Identification Standards Content (Moved Here) -->
                <div class="bg-white rounded-lg shadow-sm">
                            <div class="px-5 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h2 class="text-lg font-medium text-gray-900">Identification Standards for Line Loss Abnormality Types</h2>
                        <!-- Group buttons on the right -->
                        <div class="flex items-center space-x-2">
                            <button id="saveConfig" class="bg-gray-100 hover:bg-gray-200 text-gray-700 py-1 px-3 rounded-md text-sm transition-colors duration-200">
                                <i class="fas fa-save mr-1"></i> Save Configuration
                            </button>
                            <button id="resetToDefault" class="bg-gray-100 hover:bg-gray-200 text-gray-700 py-1 px-3 rounded-md text-sm transition-colors duration-200">
                                <i class="fas fa-undo mr-1"></i> Default
                            </button>
                            </div>
                                            </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Abnormality Type</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Definition</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Identification Standard</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Identification Priority</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                            Long-term High Loss
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Abnormal area where the [Absolute (Synchronized) Line Loss Rate] is consistently higher than the [Theoretical Line Loss Rate] for an extended period.
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Within the last 30 days, the number of abnormal days with [Relative Line Loss Rate] &gt; 5% is ≥ 20 days.
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                        1
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <button data-standard="longHigh" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                            Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                            Sudden High Loss
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Area where the line loss rate was stable but suddenly increased significantly.
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Within the last 7 days, the [Relative Line Loss Rate] suddenly increased to &gt; 5% and persisted for &gt; 3 days.
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                        5
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <button data-standard="suddenHigh" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                            Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            Long-term Negative Loss
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Abnormal area where the long-term line loss rate from the power consumption information collection system is &lt; 0%.
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Within the last 30 days, the number of abnormal days with [Relative Line Loss Rate] &lt; 0% is ≥ 20 days.
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                        4
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <button data-standard="longNegative" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                            Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-sky-100 text-sky-800">
                                            Slight Negative Loss
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Area where the line loss rate is between -1% and 0% during the statistical period.
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Within the last 30 days, the [Relative Line Loss Rate] is between -1% and 0% and persists for &gt; 7 days.
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                        2
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <button data-standard="smallNegative" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                            Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                                            Sudden Negative Loss
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Abnormal area where the line loss rate suddenly decreased to &lt; 0%.
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        Within the last 7 days, the [Relative Line Loss Rate] suddenly decreased to &lt; 0% and persisted for &gt; 3 days.
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                        3
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <button data-standard="suddenNegative" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                            Edit
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                                    </div>
                                </div>

                <!-- Advanced Filtering Conditions (Moved Here) -->
                        <div class="bg-white rounded-lg shadow-sm">
                            <div class="px-5 py-4 border-b border-gray-200 flex justify-between items-center">
                                <h2 class="text-lg font-medium text-gray-900">Advanced Filtering Conditions</h2>
                            </div>
                            <div class="p-5 space-y-4">
                                <!-- Area Attribute Filtering -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Area Attributes</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-500 mb-1">Area Capacity</label>
                                            <select id="capacity" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                <option>All</option>
                                                <option>≤ 315kVA</option>
                                                <option>315kVA - 500kVA</option>
                                                <option>500kVA - 800kVA</option>
                                                <option>≥ 800kVA</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-500 mb-1">Load Type</label>
                                            <select id="loadType" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                <option>All</option>
                                                <option>Residential</option>
                                                <option>Commercial</option>
                                                <option>Industrial</option>
                                                <option>Mixed</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-500 mb-1">Region</label>
                                            <div id="area-tree-container" class="mt-1">
                                                <select id="area" multiple class="area-tree mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                    <option value="all">All Regions</option>
                                                    <optgroup label="East Area">
                                                        <option value="east-1">East Area 1</option>
                                                        <option value="east-2">East Area 2</option>
                                                        <option value="east-3">East Area 3</option>
                                                    </optgroup>
                                                    <optgroup label="West Area">
                                                        <option value="west-1">West Area 1</option>
                                                        <option value="west-2">West Area 2</option>
                                                    </optgroup>
                                                    <optgroup label="South Area">
                                                        <option value="south-1">South Area 1</option>
                                                        <option value="south-2">South Area 2</option>
                                                        <option value="south-3">South Area 3</option>
                                                    </optgroup>
                                                    <optgroup label="North Area">
                                                        <option value="north-1">North Area 1</option>
                                                        <option value="north-2">North Area 2</option>
                                                    </optgroup>
                                                    <optgroup label="Development Area">
                                                        <option value="dev-1">Development Area 1</option>
                                                        <option value="dev-2">Development Area 2</option>
                                                        <option value="dev-3">Development Area 3</option>
                                                    </optgroup>
                                            </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-500 mb-1">Communication Method</label>
                                            <select id="station" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                <option>All</option>
                                                <option>PLC</option>
                                                <option>GPRS</option>
                                                <option>4G</option>
                                                <option>5G</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-500 mb-1">Renewable Energy</label>
                                            <select id="renewable-energy" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                <option>All</option>
                                                <option>Photovoltaic</option>
                                                <option>Wind Power</option>
                                                <option>None</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Data Quality Filtering -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Data Quality Filtering</label>
                                    <div class="flex flex-col space-y-2">
                                        <div class="flex items-center">
                                            <input id="exclude-data-error" name="exclude-data-error" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                            <label for="exclude-data-error" class="ml-2 block text-sm text-gray-700">Exclude areas with less than 25 data entries</label>
                                        </div>
                                        <div class="flex items-center">
                                    <input id="exclude-supply-error" name="exclude-supply-error" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                    <label for="exclude-supply-error" class="ml-2 block text-sm text-gray-700">Exclude areas where supply is 0 or null for more than 15 days</label>
                                        </div>
                                        <div class="flex items-center">
                                    <input id="exclude-usage-error" name="exclude-usage-error" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                    <label for="exclude-usage-error" class="ml-2 block text-sm text-gray-700">Exclude areas where consumption is 0 or null for more than 15 days</label>
                                        </div>
                                        <div class="flex items-center">
                                    <input id="exclude-recent-zero" name="exclude-recent-zero" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                    <label for="exclude-recent-zero" class="ml-2 block text-sm text-gray-700">Exclude areas where supply and consumption are both 0 in the last 3 days (including diagnosis day)</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input id="exclude-collect-fail" name="exclude-collect-fail" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                            <label for="exclude-collect-fail" class="ml-2 block text-sm text-gray-700">Exclude areas with collection success rate ≤ 5%</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Add More Filter Conditions -->
                                <div>
                                    <button id="addMoreConditions" class="text-primary hover:text-primary-dark text-sm flex items-center mt-2">
                                        <i class="fas fa-plus-circle mr-1"></i> Add More Filter Conditions
                                    </button>
                            </div>
                        </div>
                    </div>

                <!-- Preview Result Content (Moved Here) -->
                <div id="previewContentWrapper" class="bg-white rounded-lg shadow-sm">
                            <div class="px-5 py-4 border-b border-gray-200">
                                <h2 class="text-lg font-medium text-gray-900">Filter Result Preview</h2>
                            </div>
                    <div id="previewContent" class="p-5 hidden">
                                    <div class="mb-6">
                                        <div class="bg-primary-light rounded-lg p-4 text-center">
                                            <p class="text-sm text-gray-600 mb-1">Number of Areas Matching Criteria</p>
                                            <p class="text-3xl font-bold text-primary">87</p>
                                            <p class="text-sm text-gray-500 mt-1">7.0% of total areas</p>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <h3 class="text-sm font-medium text-gray-700 mb-2">Top 5 Abnormal Areas</h3>
                                        <div class="space-y-3">
                                            <div class="p-3 bg-gray-50 rounded-lg">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm font-medium">河西变1324台区</span>
                                                    <span class="text-sm text-red-500 font-medium">+6.44%</span>
                                                </div>
                                                <div class="mt-1 text-xs text-gray-500">Actual:12.76% / Theoretical:6.32%</div>
                                            </div>
                                            <div class="p-3 bg-gray-50 rounded-lg">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm font-medium">城南532台区</span>
                                                    <span class="text-sm text-red-500 font-medium">+5.55%</span>
                                                </div>
                                                <div class="mt-1 text-xs text-gray-500">Actual:10.21% / Theoretical:4.66%</div>
                                            </div>
                                            <div class="p-3 bg-gray-50 rounded-lg">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm font-medium">北郊198台区</span>
                                                    <span class="text-sm text-blue-500 font-medium">-4.24%</span>
                                                </div>
                                                <div class="mt-1 text-xs text-gray-500">Actual:3.21% / Theoretical:7.45%</div>
                                            </div>
                                            <div class="p-3 bg-gray-50 rounded-lg">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm font-medium">开发区672台区</span>
                                                    <span class="text-sm text-blue-500 font-medium">-3.24%</span>
                                                </div>
                                                <div class="mt-1 text-xs text-gray-500">Actual:2.13% / Theoretical:5.37%</div>
                                            </div>
                                            <div class="p-3 bg-gray-50 rounded-lg">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm font-medium">东湖785台区</span>
                                                    <span class="text-sm text-blue-500 font-medium">-1.27%</span>
                                                </div>
                                                <div class="mt-1 text-xs text-gray-500">Actual:3.58% / Theoretical:4.85%</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

            <!-- Original content-filter and content-standards divs are removed -->

                    </div>
                </div>

    <!-- Edit Standard Modal -->
    <div id="editStandardModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 id="modalTitle" class="text-lg font-medium text-gray-900">Edit Identification Standard</h3>
                <button id="closeModal" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4">
                <form id="editStandardForm">
                    <input type="hidden" id="standardType" value="">
                    
                    <!-- Long-term High Loss Parameters -->
                    <div id="longHighParams" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Statistical Period (days)</label>
                            <input type="number" id="longHigh-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="30">
                    </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Relative Loss Rate Threshold (%)</label>
                            <input type="number" id="longHigh-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="5">
                    </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Abnormal Days Threshold</label>
                            <input type="number" id="longHigh-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="20">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Identification Priority</label>
                            <input type="number" id="longHigh-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="1">
                    </div>
                </div>
                
                    <!-- Sudden High Loss Parameters -->
                    <div id="suddenHighParams" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Monitoring Period (days)</label>
                            <input type="number" id="suddenHigh-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="7">
                    </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Relative Loss Rate Threshold (%)</label>
                            <input type="number" id="suddenHigh-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="5">
                            </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Persistence Threshold (days)</label>
                            <input type="number" id="suddenHigh-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="3">
                            </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Identification Priority</label>
                            <input type="number" id="suddenHigh-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="5">
                            </div>
                            </div>

                    <!-- Long-term Negative Loss Parameters -->
                    <div id="longNegativeParams" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Statistical Period (days)</label>
                            <input type="number" id="longNegative-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="30">
                            </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Relative Loss Rate Threshold (%)</label>
                            <input type="number" id="longNegative-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Abnormal Days Threshold</label>
                            <input type="number" id="longNegative-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="20">
                    </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Identification Priority</label>
                            <input type="number" id="longNegative-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="4">
                </div>
            </div>

                    <!-- Slight Negative Loss Parameters -->
                    <div id="smallNegativeParams" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Statistical Period (days)</label>
                            <input type="number" id="smallNegative-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="30">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Minimum Loss Rate (%)</label>
                                <input type="number" id="smallNegative-min" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="-1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Maximum Loss Rate (%)</label>
                                <input type="number" id="smallNegative-max" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="0">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Persistence Threshold (days)</label>
                            <input type="number" id="smallNegative-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="7">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Identification Priority</label>
                            <input type="number" id="smallNegative-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="2">
                        </div>
                    </div>

                    <!-- Sudden Negative Loss Parameters -->
                    <div id="suddenNegativeParams" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Monitoring Period (days)</label>
                            <input type="number" id="suddenNegative-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="7">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Relative Loss Rate Threshold (%)</label>
                            <input type="number" id="suddenNegative-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Persistence Threshold (days)</label>
                            <input type="number" id="suddenNegative-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="3">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Identification Priority</label>
                            <input type="number" id="suddenNegative-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="3">
                        </div>
                    </div>
                </form>
            </div>
            <div class="px-6 py-3 bg-gray-50 text-right rounded-b-lg">
                <button id="cancelEdit" class="bg-white border border-gray-300 rounded-md shadow-sm px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 mr-2">
                    Cancel
                </button>
                <button id="saveStandardBtn" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md text-sm font-medium">
                    Save Configuration
                </button>
            </div>
        </div>
    </div>

    <!-- Filter Result Preview Modal -->
    <div id="previewResultModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-lg w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900">Filter Result Preview</h3>
                <button id="closePreviewModal" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <!-- Content previously in #previewContent goes here -->
                <div class="mb-6">
                    <div class="bg-primary-light rounded-lg p-4 text-center">
                        <p class="text-sm text-gray-600 mb-1">Number of Areas Matching Criteria</p>
                        <p class="text-3xl font-bold text-primary">87</p>
                        <p class="text-sm text-gray-500 mt-1">7.0% of total areas</p>
                    </div>
                </div>
                <div class="mb-4">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Top 5 Abnormal Areas</h3>
                    <div class="space-y-3">
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">河西变1324台区</span>
                                <span class="text-sm text-red-500 font-medium">+6.44%</span>
                            </div>
                            <div class="mt-1 text-xs text-gray-500">Actual:12.76% / Theoretical:6.32%</div>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">城南532台区</span>
                                <span class="text-sm text-red-500 font-medium">+5.55%</span>
                            </div>
                            <div class="mt-1 text-xs text-gray-500">Actual:10.21% / Theoretical:4.66%</div>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">北郊198台区</span>
                                <span class="text-sm text-blue-500 font-medium">-4.24%</span>
                            </div>
                            <div class="mt-1 text-xs text-gray-500">Actual:3.21% / Theoretical:7.45%</div>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">开发区672台区</span>
                                <span class="text-sm text-blue-500 font-medium">-3.24%</span>
                            </div>
                            <div class="mt-1 text-xs text-gray-500">Actual:2.13% / Theoretical:5.37%</div>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">东湖785台区</span>
                                <span class="text-sm text-blue-500 font-medium">-1.27%</span>
                            </div>
                            <div class="mt-1 text-xs text-gray-500">Actual:3.58% / Theoretical:4.85%</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-6 py-3 bg-gray-50 text-right rounded-b-lg">
                <button id="okPreviewModal" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md text-sm font-medium">
                    确定
                </button>
            </div>
        </div>
    </div>
    
    <!-- 保存配置名称模态框 -->
    <div id="saveConfigModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900">保存配置</h3>
                <button id="closeSaveConfigModal" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4">
                <div class="mb-4">
                    <label for="configName" class="block text-sm font-medium text-gray-700 mb-1">配置名称</label>
                    <input type="text" id="configName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" placeholder="请输入配置名称">
                </div>
            </div>
            <div class="px-6 py-3 bg-gray-50 text-right rounded-b-lg">
                <button id="cancelSaveConfig" class="bg-white border border-gray-300 rounded-md shadow-sm px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 mr-2">
                    取消
                </button>
                <button id="submitSaveConfig" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md text-sm font-medium">
                    保存
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 标签页切换逻辑 (Updated for new tab structure)
            const tabButtons = document.querySelectorAll('[id^="tab-"]');
            const contentDivs = document.querySelectorAll('[id^="content-"]');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    tabButtons.forEach(btn => {
                        btn.classList.remove('border-primary', 'text-primary');
                        btn.classList.add('border-transparent', 'text-gray-500', 'hover:border-gray-300', 'hover:text-gray-700');
                    });
                    this.classList.remove('border-transparent', 'text-gray-500', 'hover:border-gray-300', 'hover:text-gray-700');
                    this.classList.add('border-primary', 'text-primary');
                    contentDivs.forEach(div => {
                        div.classList.add('hidden');
                    });
                    const contentId = this.id.replace('tab-', 'content-');
                    const targetContent = document.getElementById(contentId);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });
            
            // Make '异常台区报表' active by default if needed (or handle server-side)
            const defaultActiveTab = document.getElementById('tab-reports');
            const defaultContent = document.getElementById('content-reports');
            const secondTab = document.getElementById('tab-abnormal-filter');
            const secondContent = document.getElementById('content-abnormal-filter');

            if (defaultActiveTab && defaultContent && secondTab && secondContent) {
                 // Assuming 'tab-reports' starts with active classes
                 secondTab.classList.add('border-transparent', 'text-gray-500', 'hover:border-gray-300', 'hover:text-gray-700');
                 secondTab.classList.remove('border-primary', 'text-primary');
                 secondContent.classList.add('hidden');
                 defaultActiveTab.classList.add('border-primary', 'text-primary');
                 defaultActiveTab.classList.remove('border-transparent', 'text-gray-500', 'hover:border-gray-300', 'hover:text-gray-700');
                 defaultContent.classList.remove('hidden');
            } else {
                 // Fallback or default if elements not found as expected
                 if (tabButtons.length > 0 && contentDivs.length > 0) {
                     tabButtons[0].click(); // Activate the first tab
                 }
            }
            
            // 下拉菜单行为 (Keep existing logic)
            const menuButton = document.getElementById('main-menu-button');
            const menuDropdown = document.getElementById('main-menu-dropdown');
            if (menuButton && menuDropdown) {
            menuButton.addEventListener('click', function(e) {
                e.stopPropagation();
                menuDropdown.classList.toggle('hidden');
            });
            document.addEventListener('click', function(e) {
                if (!menuButton.contains(e.target) && !menuDropdown.contains(e.target)) {
                    menuDropdown.classList.add('hidden');
                }
            });
            menuDropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            }

            // Initialize Choices.js for multi-select dropdowns
            const choicesConfig = {
                removeItemButton: true,
                searchEnabled: true,
                placeholder: true,
                placeholderValue: '请选择...', // Customize placeholder
                // Add more Choices.js config options if needed
            };

            const capacitySelect = document.getElementById('capacity');
            if (capacitySelect) new Choices(capacitySelect, choicesConfig);

            const loadTypeSelect = document.getElementById('loadType');
            if (loadTypeSelect) new Choices(loadTypeSelect, choicesConfig);

            // Special config for area dropdown to handle optgroups
            const areaSelect = document.getElementById('area');
            if (areaSelect) {
                const areaChoices = new Choices(areaSelect, {
                    ...choicesConfig,
                    renderSelectedChoices: 'always',
                    renderChoiceLimit: -1,
                    // Make sure the parent optgroup state is updated when children are selected
                    callbackOnCreateTemplates: function(template) {
                        return {
                            item: (classNames, data) => {
                                const itemHtml = template(`
                                <div class="${classNames.item} ${
                                    data.highlighted ? classNames.highlightedState : classNames.itemSelectable
                                } ${
                                    data.placeholder ? classNames.placeholder : ''
                                }" data-item data-id="${data.id}" data-value="${data.value}" ${
                                    data.active ? 'aria-selected="true"' : ''
                                } ${
                                    data.disabled ? 'aria-disabled="true"' : ''
                                }>
                                    <span class="choices__item-text">${data.label.replace(/东区|西区|南区|北区|开发区/g, match => `<strong>${match}</strong>`)}</span>
                                    ${
                                    data.removeButton ? `
                                    <button type="button" class="${classNames.button}" data-button aria-label="Remove item">
                                        Remove item
                                    </button>
                                    ` : ''
                                    }
                                </div>
                                `);
                                return itemHtml;
                            }
                        };
                    }
                });
                
                // Handle special case of selecting "全部区域"
                areaSelect.addEventListener('change', function() {
                    const allOption = this.querySelector('option[value="all"]');
                    const otherOptions = Array.from(this.querySelectorAll('option:not([value="all"])'));
                    
                    // If "all" is selected, select/deselect all other options
                    if (allOption && allOption.selected) {
                        otherOptions.forEach(option => {
                            option.selected = true;
                        });
                        // Force Choices.js to update
                        areaChoices.setChoiceByValue(otherOptions.map(o => o.value));
                    }
                    
                    // Handle optgroup selection logic
                    const optgroups = Array.from(this.querySelectorAll('optgroup'));
                    optgroups.forEach(group => {
                        const groupLabel = group.getAttribute('label');
                        const groupOptions = Array.from(group.querySelectorAll('option'));
                        const allSelected = groupOptions.every(o => o.selected);
                        
                        // Update visual representation in the dropdown
                        const itemElement = document.querySelector(`.choices__item[data-value="${groupLabel}"]`);
                        if (itemElement) {
                            if (allSelected) {
                                itemElement.classList.add('is-highlighted');
                } else {
                                itemElement.classList.remove('is-highlighted');
                            }
                        }
                    });
                });
            }

            const stationSelect = document.getElementById('station');
            if (stationSelect) new Choices(stationSelect, choicesConfig);

            const renewableEnergySelect = document.getElementById('renewable-energy');
            if (renewableEnergySelect) new Choices(renewableEnergySelect, choicesConfig);

            // --- Combined Tab Logic (异常台区筛选) ---
            const abnormalFilterContent = document.getElementById('content-abnormal-filter');
            if (abnormalFilterContent) {
                 // Add More Filters Button Logic (Keep existing)
                const addMoreBtn = abnormalFilterContent.querySelector('#addMoreConditions');
                if (addMoreBtn) {
                    addMoreBtn.addEventListener('click', function() {
                        alert('添加更多筛选条件功能待实现');
                    });
                }
                 // Standard Edit Modal Logic (Keep existing)
                 const editStandardModal = document.getElementById('editStandardModal'); 
                 const editStandardBtns = abnormalFilterContent.querySelectorAll('.edit-standard-btn');
                 const closeModalBtn = document.getElementById('closeModal');
                 const cancelEditBtn = document.getElementById('cancelEdit');
                 const saveStandardBtn = document.getElementById('saveStandardBtn');
                 const standardTypeInput = document.getElementById('standardType');
                 const modalTitle = document.getElementById('modalTitle');
                 
                 const paramContainers = {
                     longHigh: document.getElementById('longHighParams'),
                     suddenHigh: document.getElementById('suddenHighParams'),
                     longNegative: document.getElementById('longNegativeParams'),
                     smallNegative: document.getElementById('smallNegativeParams'),
                     suddenNegative: document.getElementById('suddenNegativeParams')
                 };
                 
                 const standardNames = {
                     longHigh: '长期高损',
                     suddenHigh: '突发高损',
                     longNegative: '长期负损',
                     smallNegative: '小负损',
                     suddenNegative: '突发负损'
                 };
                 
                 if (editStandardModal && editStandardBtns.length > 0 && closeModalBtn && cancelEditBtn && saveStandardBtn && standardTypeInput && modalTitle) {
                     // 点击编辑按钮
                     editStandardBtns.forEach(btn => {
                         btn.addEventListener('click', function() {
                             const standardType = this.getAttribute('data-standard');
                             standardTypeInput.value = standardType;
                             modalTitle.textContent = '编辑' + standardNames[standardType] + '识别标准';
                             
                             Object.values(paramContainers).forEach(container => {
                                 if (container) container.classList.add('hidden');
                             });
                             
                             if (paramContainers[standardType]) {
                                 paramContainers[standardType].classList.remove('hidden');
                             }
                             
                             editStandardModal.classList.remove('hidden');
                         });
                     });
                     
                     // 关闭模态框
                     function closeModal() {
                         editStandardModal.classList.add('hidden');
                     }
                     
                     closeModalBtn.addEventListener('click', closeModal);
                     cancelEditBtn.addEventListener('click', closeModal);
                     editStandardModal.addEventListener('click', function(e) {
                         if (e.target === editStandardModal) {
                             closeModal();
                         }
                     });
                     
                     // 保存标准配置
                     saveStandardBtn.addEventListener('click', function() {
                         const standardType = standardTypeInput.value;
                         const formData = {};
                         const currentParamsContainer = paramContainers[standardType];

                         if (currentParamsContainer) {
                             const inputs = currentParamsContainer.querySelectorAll('input[type="number"]');
                             inputs.forEach(input => {
                                 const key = input.id.split('-')[1]; 
                                 if (key) {
                                     formData[key] = input.value;
                                 }
                             });
                         }
                         
                         console.log('Saving standard:', standardType, formData);
                         updateTableDisplay(standardType, formData, abnormalFilterContent); // Pass context
                         closeModal();
                         alert('标准配置已保存');
                     });
                 }

                 // 更新表格中的标准显示 (Function needs context for rows)
                 function updateTableDisplay(standardType, formData, contextElement) {
                     const rows = contextElement.querySelectorAll('.bg-white.divide-y.divide-gray-200 tr'); // More specific selector
                     let row;
                     
                     rows.forEach(r => {
                         const btn = r.querySelector('.edit-standard-btn');
                         if (btn && btn.getAttribute('data-standard') === standardType) {
                             row = r;
                         }
                     });
                     
                     if (!row || !formData) return;
                     
                     const standardCell = row.querySelector('td:nth-child(3)');
                     const priorityCell = row.querySelector('td:nth-child(4)');
                     
                     if (standardCell && priorityCell) {
                          priorityCell.textContent = formData.priority || '';
                          
                         switch(standardType) {
                              case 'longHigh':
                                  standardCell.textContent = `近${formData.period || 'N/A'}天内【相对线损率】${formData.threshold || 'N/A'}%以上的异常天数≥${formData.days || 'N/A'}天`;
                                  break;
                              case 'suddenHigh':
                                  standardCell.textContent = `近${formData.period || 'N/A'}天【相对线损率】突然升高至${formData.threshold || 'N/A'}%以上，且持续${formData.days || 'N/A'}天以上`;
                                  break;
                              case 'longNegative':
                                  standardCell.textContent = `近${formData.period || 'N/A'}天内【相对线损率】${formData.threshold || 'N/A'}%以下的异常天数≥${formData.days || 'N/A'}天`;
                                  break;
                              case 'smallNegative':
                                  standardCell.textContent = `近${formData.period || 'N/A'}天内，【相对线损率】线损率在${formData.min || 'N/A'}%~${formData.max || 'N/A'}%之间，持续${formData.days || 'N/A'}天以上`;
                                  break;
                              case 'suddenNegative':
                                  standardCell.textContent = `近${formData.period || 'N/A'}天【相对线损率】突然降低至${formData.threshold || 'N/A'}%以下，且持续${formData.days || 'N/A'}天以上`;
                                  break;
                          }
                     }
                 }
             }
             // --- End Combined Tab Logic ---

             // --- Preview Modal Logic ---
             const previewButtonHeader = document.getElementById('previewButton'); 
             const previewResultModal = document.getElementById('previewResultModal');
             const closePreviewModalBtn = document.getElementById('closePreviewModal');
             const okPreviewModalBtn = document.getElementById('okPreviewModal');

             if (previewButtonHeader && previewResultModal && closePreviewModalBtn && okPreviewModalBtn) {
                 // Open Preview Modal
                 previewButtonHeader.addEventListener('click', function() {
                     // Here you might want to fetch real preview data before showing
                     console.log('Fetching preview data...');
                     // For now, just show the modal with example data
                     previewResultModal.classList.remove('hidden');
                 });

                 // Close Preview Modal Function
                 function closePreviewModal() {
                     previewResultModal.classList.add('hidden');
                 }

                 // Close via X button
                 closePreviewModalBtn.addEventListener('click', closePreviewModal);
                 // Close via OK button
                 okPreviewModalBtn.addEventListener('click', closePreviewModal);
                 // Close by clicking outside
                 previewResultModal.addEventListener('click', function(e) {
                     if (e.target === previewResultModal) {
                         closePreviewModal();
                     }
                 });
             }
             // --- End Preview Modal Logic ---

             // 保存配置按钮点击事件 (General)
             const saveConfigBtn = document.getElementById('saveConfig');
             if (saveConfigBtn) {
                 saveConfigBtn.addEventListener('click', function() {
                     // Show modal for saving configuration with name
                     const saveConfigModal = document.getElementById('saveConfigModal');
                     if (saveConfigModal) {
                         saveConfigModal.classList.remove('hidden');
                     }
                 });
             }
             
             // 保存配置模态框逻辑
             const saveConfigModal = document.getElementById('saveConfigModal');
             const closeSaveConfigModalBtn = document.getElementById('closeSaveConfigModal');
             const cancelSaveConfigBtn = document.getElementById('cancelSaveConfig');
             const submitSaveConfigBtn = document.getElementById('submitSaveConfig');
             const configNameInput = document.getElementById('configName');
             
             if (saveConfigModal && closeSaveConfigModalBtn && cancelSaveConfigBtn && submitSaveConfigBtn && configNameInput) {
                 // Close modal function
                 function closeSaveConfigModal() {
                     saveConfigModal.classList.add('hidden');
                     configNameInput.value = ''; // Clear input when closing
                 }
                 
                 // Close via X button
                 closeSaveConfigModalBtn.addEventListener('click', closeSaveConfigModal);
                 // Close via Cancel button
                 cancelSaveConfigBtn.addEventListener('click', closeSaveConfigModal);
                 // Close by clicking outside
                 saveConfigModal.addEventListener('click', function(e) {
                     if (e.target === saveConfigModal) {
                         closeSaveConfigModal();
                     }
                 });
                 
                 // Submit save configuration
                 submitSaveConfigBtn.addEventListener('click', function() {
                     const configName = configNameInput.value.trim();
                     if (!configName) {
                         alert('请输入配置名称');
                         return;
                     }
                     
                     // Collect config from the active tab
                     const activeConfig = {
                         name: configName,
                         timestamp: new Date().toISOString()
                     };
                     
                     const filterContainer = document.getElementById('content-abnormal-filter');
                     if (filterContainer && !filterContainer.classList.contains('hidden')) {
                         // Collect values from advanced filters
                         activeConfig.capacity = filterContainer.querySelector('#capacity')?.value;
                         activeConfig.loadType = filterContainer.querySelector('#loadType')?.value;
                         activeConfig.area = filterContainer.querySelector('#area')?.value;
                         activeConfig.station = filterContainer.querySelector('#station')?.value;
                         activeConfig.renewableEnergy = filterContainer.querySelector('#renewable-energy')?.value;
                         activeConfig.excludeDataError = filterContainer.querySelector('#exclude-data-error')?.checked;
                         activeConfig.excludeSupplyError = filterContainer.querySelector('#exclude-supply-error')?.checked;
                         activeConfig.excludeUsageError = filterContainer.querySelector('#exclude-usage-error')?.checked;
                         activeConfig.excludeRecentZero = filterContainer.querySelector('#exclude-recent-zero')?.checked;
                         activeConfig.excludeCollectFail = filterContainer.querySelector('#exclude-collect-fail')?.checked;
                     }
                     
                     console.log('Saving config:', activeConfig);
                     alert(`配置"${configName}"已保存`);
                     closeSaveConfigModal();
                 });
             }
             
             // 重置为默认值按钮点击事件
             const resetToDefaultBtn = document.getElementById('resetToDefault');
             if (resetToDefaultBtn) {
                 resetToDefaultBtn.addEventListener('click', function() {
                     if (confirm('确定要重置为默认识别标准吗？')) {
                         console.log('Resetting to default standards');
                         
                         // Example of default values (you would replace these with actual defaults)
                         const defaultStandards = {
                             longHigh: {period: 30, threshold: 5, days: 20, priority: 1},
                             suddenHigh: {period: 7, threshold: 5, days: 3, priority: 5},
                             longNegative: {period: 30, threshold: 0, days: 20, priority: 4},
                             smallNegative: {period: 30, min: -1, max: 0, days: 7, priority: 2},
                             suddenNegative: {period: 7, threshold: 0, days: 3, priority: 3}
                         };
                         
                         // Update displayed standards
                         const abnormalFilterContent = document.getElementById('content-abnormal-filter');
                         if (abnormalFilterContent) {
                             Object.entries(defaultStandards).forEach(([type, values]) => {
                                 updateTableDisplay(type, values, abnormalFilterContent);
                             });
                         }
                         
                         alert('已重置为默认识别标准');
                     }
                 });
             }

             // 生成报告按钮点击事件 (General)
             const generateReportBtn = document.getElementById('generateReport');
             if (generateReportBtn) {
                 generateReportBtn.addEventListener('click', function() {
                     window.location.href = 'diagnostic.html';
                 });
             }

             // 报表切换功能 (Inside 异常台区报表 Tab)
             const reportsTabContent = document.getElementById('content-reports');
             if (reportsTabContent) {
                  const reportButtons = reportsTabContent.querySelectorAll('.flex.space-x-2 button');
            reportButtons.forEach(button => {
                button.addEventListener('click', function() {
                    reportButtons.forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                        b.classList.add('bg-gray-100', 'text-gray-700');
                    });
                    this.classList.remove('bg-gray-100', 'text-gray-700');
                    this.classList.add('bg-primary', 'text-white');
                });
            });
             }

        });
    </script>
</body>
</html>