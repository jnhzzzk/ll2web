<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台区筛选 - 线损诊断分析应用</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Add Choices.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <!-- ECharts for Sankey Diagram -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Custom styles for hierarchical dropdown -->
    <style>
        /* Style for optgroups in Choices.js */
        .choices__list--dropdown .choices__list optgroup {
            padding: 8px 0 0 12px;
            font-weight: 600;
            color: #4b5563;
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 5px;
        }
        
        .choices__list--dropdown .choices__list optgroup option {
            margin-left: 12px;
            padding-left: 8px;
            font-weight: normal;
            color: #374151;
            border-left: 2px solid #e5e7eb;
        }
        
        .choices__list--dropdown .choices__list optgroup option:hover {
            background-color: #e6f1f1;
        }
        
        /* Highlight parent area in selected items */
        .choices__list--multiple .choices__item strong {
            font-weight: 600;
            color: #256e70;
        }

        /* Make sure optgroups are properly displayed */
        .choices__list {
            padding: 0;
            margin: 0;
            list-style: none;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#309C9F',
                        'primary-light': '#e6f1f1',
                        'primary-dark': '#256e70',
                    }
                }
            }
        }
    </script>
    <!-- Add Choices.js JS -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</head>
<body class="bg-gray-50">
    <!-- 顶部导航栏 -->
    <nav class="bg-white border-b border-gray-200 fixed w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center relative">
                        <span id="main-menu-button" class="text-primary text-xl font-bold cursor-pointer flex items-center">
                            线损诊断分析应用
                            <svg class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </span>
                        <div id="main-menu-dropdown" class="absolute left-0 top-full mt-1 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden">
                            <a href="/cn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-primary-light hover:text-primary">
                                统计总览
                            </a>
                            <a href="/cn/filter" class="block px-4 py-2 text-sm text-gray-700 bg-primary-light text-primary">
                                筛选配置
                            </a>
                        </div>
                    </div>
                </div>
                <div class="flex items-center">
                    <span class="text-sm text-gray-600 mr-2">王工</span>
                    <a href="/en/filter" class="px-3 py-1 rounded-md text-sm font-medium text-white bg-primary hover:bg-primary-dark mr-3">English</a>
                    <img class="h-8 w-8 rounded-full" src="https://api.dicebear.com/7.x/avataaars/svg?seed=John" alt="用户头像">
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <div class="pt-16 pb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- 页面标题 -->
            <div class="mt-6 mb-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-900">台区筛选</h1>
                <div class="flex gap-2">
                    <!-- 添加原因统计按钮 -->
                    <button id="openReasonStatsBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-1.5 rounded-md text-sm">
                        <i class="fas fa-chart-bar mr-1"></i> 原因统计
                    </button>
                    <!-- Change toggle button to modal open button -->
                    <button id="openFilterConfigBtn" class="bg-primary hover:bg-primary-dark text-white px-4 py-1.5 rounded-md text-sm">
                        <i class="fas fa-cog mr-1"></i> 筛选配置
                    </button>
                </div>
            </div>

            <!-- 异常台区报表内容 (Now Main and Only View) -->
            <div id="report-view-content">
                <div class="bg-white rounded-lg shadow-sm mb-6">
                    <div class="px-5 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h2 class="text-lg font-medium text-gray-900">线损异常台区报表</h2>
                        <!-- Replace the static text with the dropdown -->
                        <div class="relative w-80"> <!-- Adjusted width -->
                            <select id="report-history-filter" class="block w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                <option>选择历史报告...</option>
                                <option>2024-03-15 14:30:22 - 筛选A - 线损统计窗口：2024-04-10 - 2024-05-10</option>
                                <option>2024-03-14 16:45:18 - 筛选A - 线损统计窗口：2024-04-10 - 2024-05-10</option>
                                <option>2024-03-13 09:12:35 - 筛选A - 线损统计窗口：2024-04-10 - 2024-05-10</option>
                                <option>2024-03-12 11:28:47 - 筛选B - 线损统计窗口：2024-04-10 - 2024-05-10</option>
                                <option>2024-03-11 15:33:56 - 筛选B - 线损统计窗口：2024-04-10 - 2024-05-10</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="p-5">
                        <!-- 筛选选项 -->
                        <div class="mb-4">
                            <!-- 基础筛选条件 - 始终显示 -->
                            <div class="bg-gray-50 rounded-lg p-4 mb-3">
                                <div class="flex flex-wrap items-end gap-3">
                                    <!-- 台区名称搜索 -->
                                    <div class="w-48">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">台区名称</label>
                                        <div class="relative">
                                            <input type="text" placeholder="输入台区名称搜索..." class="w-full pl-8 pr-3 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            <div class="absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none">
                                                <i class="fas fa-search text-gray-400 text-xs"></i>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 所属区域 -->
                                    <div class="w-40">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">所属区域</label>
                                        <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            <option>全部区域</option>
                                            <option>东区</option>
                                            <option>西区</option>
                                            <option>南区</option>
                                            <option>北区</option>
                                            <option>开发区</option>
                                        </select>
                                    </div>
                                    
                                    <!-- 异常类型 -->
                                    <div class="w-40">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">异常类型</label>
                                        <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            <option>全部异常</option>
                                            <option>长期高损</option>
                                            <option>突发高损</option>
                                            <option>长期负损</option>
                                            <option>小负损</option>
                                            <option>突发负损</option>
                                        </select>
                                    </div>
                                    
                                    <!-- 日期范围选择 -->
                                    <div class="flex-grow">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">发生日期范围</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="date" class="w-full py-1.5 px-3 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            <span class="text-gray-500 text-xs">至</span>
                                            <input type="date" class="w-full py-1.5 px-3 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 高级筛选区域 - 可折叠 -->
                            <div class="border border-gray-200 rounded-lg">
                                <div class="bg-white px-4 py-3 border-b border-gray-200 flex justify-between items-center cursor-pointer" id="advancedFilterToggle">
                                    <span class="text-sm font-medium text-gray-700">
                                        <i class="fas fa-filter mr-2 text-primary"></i>高级筛选条件
                                    </span>
                                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform duration-200" id="advancedFilterIcon"></i>
                                </div>
                                
                                <div class="p-4 bg-white hidden" id="advancedFilterContent">
                                    <!-- 数值区间筛选 -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                        <!-- 实际线损率 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">实际线损率 (%)</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="0.01" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="0.01" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                        
                                        <!-- 理论线损率 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">理论线损率 (%)</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="0.01" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="0.01" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                        
                                        <!-- 线损差值 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">线损差值 (%)</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="0.01" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="0.01" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                        
                                        <!-- 总表电量 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">总表电量 (kWh)</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 第二行数值区间 -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                        <!-- 用电量 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">用电量 (kWh)</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                        
                                        <!-- 损失电量 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">损失电量 (kWh)</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                        
                                        <!-- 偏差损失电量 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">偏差损失电量 (kWh)</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                        
                                        <!-- 异常天数 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">异常天数</label>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" placeholder="最小值" step="1" min="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <span class="text-gray-500 text-xs">-</span>
                                                <input type="number" placeholder="最大值" step="1" min="1" class="w-full py-1.5 px-2 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 其他筛选条件 -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <!-- 治理状态 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">治理状态</label>
                                            <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <option>全部状态</option>
                                                <option>已生成</option>
                                                <option>未生成</option>
                                                <option>处理中</option>
                                            </select>
                                        </div>
                                        
                                        <!-- 可再生能源 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">可再生能源</label>
                                            <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <option>全部</option>
                                                <option>光伏</option>
                                                <option>风电</option>
                                                <option>无</option>
                                            </select>
                                        </div>
                                        
                                        <!-- 预留扩展 -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 mb-1">排序方式</label>
                                            <select class="w-full pl-3 pr-10 py-1.5 text-sm border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                                <option>发生日期</option>
                                                <option>线损差值（降序）</option>
                                                <option>线损差值（升序）</option>
                                                <option>异常天数（降序）</option>
                                                <option>异常天数（升序）</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 查询操作按钮 -->
                            <div class="flex justify-between items-center mt-4">
                                <div class="text-sm text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    提示：支持台区名称实时搜索，可使用高级筛选进行精确数值范围查询
                                    <br>
                                    <span class="text-xs mt-1 inline-block">
                                        快捷键：Ctrl+F 快速搜索，Enter 查询，Esc 重置
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <button id="resetFilters" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-1.5 rounded-md text-sm" title="快捷键：Esc">
                                        <i class="fas fa-redo-alt mr-1"></i> 重置
                                    </button>
                                    <button id="applyFilters" class="bg-primary hover:bg-primary-dark text-white px-4 py-1.5 rounded-md text-sm" title="快捷键：Enter">
                                        <i class="fas fa-search mr-1"></i> 查询
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 添加治理状态标签页筛选 -->
                        <div class="mb-4 border-b border-gray-200">
                            <nav class="-mb-px flex space-x-6">
                                <button class="py-2 border-b-2 border-primary text-sm font-medium text-primary">
                                    全部状态
                                </button>
                                <button class="py-2 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                    已生成
                                </button>
                                <button class="py-2 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                    未生成
                                </button>
                                <button class="py-2 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                    处理中
                                </button>
                            </nav>
                        </div>

                        <!-- 异常台区报表表格 -->
                        <div class="overflow-x-auto border border-gray-200 rounded-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            台区名称
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            所属区域
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            实际线损率
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            理论线损率
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            线损差值
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            总表电量(kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            用电量(kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            损失电量(kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            偏差损失电量(kWh)
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            发生日期
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            异常状态
                                        </th>
                                        <!-- 添加新的表头 -->
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            异常天数
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            治理状态
                                        </th>
                                        <!-- 移除台区类型列 -->
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            可再生能源
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            操作
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <!-- 长期高损 -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            河西变1324台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            河西区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            12.76%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            6.32%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500 font-medium">
                                            +6.44%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4,823
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4,208
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            615
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500">
                                            +310
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-08
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                                长期高损
                                            </span>
                                        </td>
                                        <!-- 第一行数据 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            28天
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                                            未生成
                                        </td>
                                        <!-- 移除台区类型单元格 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            无
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=longHigh" class="text-primary hover:text-primary-dark">诊断分析</a>
                                        </td>
                                    </tr>
                                    <!-- 突发高损 -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            城南532台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            南区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            10.21%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4.66%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500 font-medium">
                                            +5.55%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            3,612
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            3,243
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            369
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500">
                                            +200
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-07
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                                突发高损
                                            </span>
                                        </td>
                                        <!-- 第二行数据 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            5天
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-green-600">
                                            已生成
                                        </td>
                                        <!-- 移除台区类型单元格 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            光伏
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=suddenHigh" class="text-primary hover:text-primary-dark">诊断分析</a>
                                        </td>
                                    </tr>
                                    <!-- 长期负损 -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            北郊198台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            北区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            3.21%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            7.45%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500 font-medium">
                                            -4.24%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2,850
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2,758
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            92
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500">
                                            -120
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-07
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                长期负损
                                            </span>
                                        </td>
                                        <!-- 第三行数据 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            32天
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-green-600">
                                            已生成
                                        </td>
                                        <!-- 移除台区类型单元格 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            无
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=longNegative" class="text-primary hover:text-primary-dark">诊断分析</a>
                                        </td>
                                    </tr>
                                    <!-- 小负损 -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            东湖785台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            东区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            3.58%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4.85%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500 font-medium">
                                            -1.27%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            5,105
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4,922
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            183
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500">
                                            -65
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-08
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                小负损
                                            </span>
                                        </td>
                                        <!-- 第四行数据 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            25天
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                                            未生成
                                        </td>
                                        <!-- 移除台区类型单元格 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            风电
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=smallNegative" class="text-primary hover:text-primary-dark">诊断分析</a>
                                        </td>
                                    </tr>
                                    <!-- 突发负损 -->
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                            开发区672台区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            开发区
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                            2.13%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            5.37%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500 font-medium">
                                            -3.24%
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            6,780
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            6,636
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            144
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-blue-500">
                                            -220
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            2024-05-08
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                突发负损
                                            </span>
                                        </td>
                                        <!-- 第五行数据 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            4天
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                                            未生成
                                        </td>
                                        <!-- 移除台区类型单元格 -->
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                            无
                                        </td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                                            <a href="diagnostic.html?area=suddenNegative" class="text-primary hover:text-primary-dark">诊断分析</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 分页 -->
                        <div class="flex items-center justify-between mt-4">
                            <div class="text-sm text-gray-700">
                                共 <span class="font-medium">87</span> 个异常台区
                            </div>
                            <div class="flex space-x-2">
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">上一页</button>
                                <button class="bg-primary px-3 py-1 rounded text-sm text-white">1</button>
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">2</button>
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">3</button>
                                <button class="bg-gray-100 px-3 py-1 rounded text-sm text-gray-700">下一页</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 筛选配置模态框 -->
            <div id="filterConfigModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 h-5/6 flex flex-col">
                    <!-- Header with title and close button -->
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-medium text-gray-900">筛选配置</h3>
                        <button id="closeFilterConfigModal" class="text-gray-400 hover:text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <!-- Tab navigation -->
                    <div class="border-b border-gray-200 px-6">
                        <nav class="-mb-px flex space-x-6">
                            <button id="modal-tab-standards" class="py-4 border-b-2 border-primary text-sm font-medium text-primary focus:outline-none">
                                线损异常类型识别标准
                            </button>
                            <button id="modal-tab-advanced-filters" class="py-4 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 focus:outline-none">
                                高级筛选条件
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Content area (scrollable) -->
                    <div class="flex-grow overflow-y-auto px-6 py-4">
                        <!-- Tab content for 线损异常类型识别标准 -->
                        <div id="modal-content-standards">
                            <!-- 识别标准内容 -->
                            <div class="bg-white rounded-lg shadow-sm">
                                <div class="px-5 py-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">线损异常类型识别标准</h2>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">异常类型</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">定义</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">识别标准</th>
                                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">识别优先级</th>
                                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                        长期高损
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    在较长统计期内【绝对（同期）线损率】高于【理论线损率】持续超过指标要求的异常台区
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    近30天内【相对线损率】5%以上的异常天数≥20天
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                                    1
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                                    <button data-standard="longHigh" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                                        编辑
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                                        突发高损
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    线损率一直保持平稳，突然发生较大升幅的台区
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    近7天【相对线损率】突然升高至5%以上，且持续3天以上
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                                    5
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                                    <button data-standard="suddenHigh" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                                        编辑
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                        长期负损
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    用电信息采集系统长期台区线损率小于0%的异常台区
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    近30天内【相对线损率】0%以下的异常天数≥20天
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                                    4
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                                    <button data-standard="longNegative" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                                        编辑
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-sky-100 text-sky-800">
                                                        小负损
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    统计期内台区线损率在-1%~0%之间的台区
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    近30天内，【相对线损率】线损率在-1%~0%之间，持续7天以上
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                                    2
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                                    <button data-standard="smallNegative" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                                        编辑
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                                                        突发负损
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    台区线损率突然降低并小于0%的异常台区
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500">
                                                    近7天【相对线损率】突然降低至0%以下，且持续3天以上
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
                                                    3
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                                    <button data-standard="suddenNegative" class="edit-standard-btn bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded-md text-xs">
                                                        编辑
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tab content for 高级筛选条件 -->
                        <div id="modal-content-advanced-filters" class="hidden">
                            <!-- 高级筛选条件 -->
                            <div class="bg-white rounded-lg shadow-sm">
                                <div class="px-5 py-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">高级筛选条件</h2>
                                </div>
                                <div class="p-5 space-y-4">
                                    <!-- 台区属性筛选 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">台区属性</label>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-500 mb-1">台区容量</label>
                                                <select id="capacity" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                    <option>全部</option>
                                                    <option>≤ 315kVA</option>
                                                    <option>315kVA - 500kVA</option>
                                                    <option>500kVA - 800kVA</option>
                                                    <option>≥ 800kVA</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-500 mb-1">负荷类型</label>
                                                <select id="loadType" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                    <option>全部</option>
                                                    <option>居民</option>
                                                    <option>商业</option>
                                                    <option>工业</option>
                                                    <option>混合</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-500 mb-1">所属区域</label>
                                                <div id="area-tree-container" class="mt-1">
                                                    <select id="area" multiple class="area-tree mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                        <option value="all">全部区域</option>
                                                        <optgroup label="东区">
                                                            <option value="east-1">东区一片</option>
                                                            <option value="east-2">东区二片</option>
                                                            <option value="east-3">东区三片</option>
                                                        </optgroup>
                                                        <optgroup label="西区">
                                                            <option value="west-1">西区一片</option>
                                                            <option value="west-2">西区二片</option>
                                                        </optgroup>
                                                        <optgroup label="南区">
                                                            <option value="south-1">南区一片</option>
                                                            <option value="south-2">南区二片</option>
                                                            <option value="south-3">南区三片</option>
                                                        </optgroup>
                                                        <optgroup label="北区">
                                                            <option value="north-1">北区一片</option>
                                                            <option value="north-2">北区二片</option>
                                                        </optgroup>
                                                        <optgroup label="开发区">
                                                            <option value="dev-1">开发区一片</option>
                                                            <option value="dev-2">开发区二片</option>
                                                            <option value="dev-3">开发区三片</option>
                                                        </optgroup>
                                                    </select>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-500 mb-1">通讯方式</label>
                                                <select id="station" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                    <option>全部</option>
                                                    <option>PLC</option>
                                                    <option>GPRS</option>
                                                    <option>4G</option>
                                                    <option>5G</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-500 mb-1">可再生能源</label>
                                                <select id="renewable-energy" multiple class="mt-1 block w-full text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md">
                                                    <option>全部</option>
                                                    <option>光伏</option>
                                                    <option>风电</option>
                                                    <option>无</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 数据质量过滤 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">数据质量过滤</label>
                                        <div class="flex flex-col space-y-2">
                                            <div class="flex items-center">
                                                <input id="exclude-data-error" name="exclude-data-error" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                                <label for="exclude-data-error" class="ml-2 block text-sm text-gray-700">排除台区数据条数少于25条</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input id="exclude-supply-error" name="exclude-supply-error" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                                <label for="exclude-supply-error" class="ml-2 block text-sm text-gray-700">排除台区供电量为0或null的天数大于15天</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input id="exclude-usage-error" name="exclude-usage-error" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                                <label for="exclude-usage-error" class="ml-2 block text-sm text-gray-700">排除台区用电量为0或null的天数大于15天</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input id="exclude-recent-zero" name="exclude-recent-zero" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                                <label for="exclude-recent-zero" class="ml-2 block text-sm text-gray-700">排除台区近3日（包括诊断日当天）的供电两和用电量均为0</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input id="exclude-collect-fail" name="exclude-collect-fail" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                                                <label for="exclude-collect-fail" class="ml-2 block text-sm text-gray-700">排除采集成功率 ≤ 95% 的台区</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 更多筛选条件 -->
                                    <div>
                                        <button id="addMoreConditions" class="text-primary hover:text-primary-dark text-sm flex items-center mt-2">
                                            <i class="fas fa-plus-circle mr-1"></i> 添加更多筛选条件
                                        </button>
                                    </div>
                                </div>
                            </div>

                            
                        </div>
                    </div>
                    
                    <!-- Footer with action buttons -->
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                        <button id="resetToDefault" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm">
                            <i class="fas fa-undo mr-1"></i> 默认
                        </button>
                        <button id="saveConfig" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md text-sm">
                            <i class="fas fa-save mr-1"></i> 保存配置
                        </button>
                    </div>
                </div>
            </div>

            <!-- 编辑标准模态框 -->
            <div id="editStandardModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 id="modalTitle" class="text-lg font-medium text-gray-900">编辑识别标准</h3>
                        <button id="closeModal" class="text-gray-400 hover:text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="px-6 py-4">
                        <form id="editStandardForm">
                            <input type="hidden" id="standardType" value="">
                            
                            <!-- 长期高损参数 -->
                            <div id="longHighParams" class="space-y-4 hidden">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">统计周期（天）</label>
                                    <input type="number" id="longHigh-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="30">
                        </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">相对线损率阈值（%）</label>
                                <input type="number" id="longHigh-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="5">
                        </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">异常天数阈值</label>
                                <input type="number" id="longHigh-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="20">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">识别优先级</label>
                                <input type="number" id="longHigh-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="1">
                        </div>
                        </div>
                        
                            <!-- 突发高损参数 -->
                            <div id="suddenHighParams" class="space-y-4 hidden">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">监控周期（天）</label>
                                    <input type="number" id="suddenHigh-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="7">
                        </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">相对线损率阈值（%）</label>
                                <input type="number" id="suddenHigh-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="5">
                                </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">线性拟合斜率阈值（%）</label>
                                <input type="number" id="suddenHigh-slope" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="0.8">
                                </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">持续天数阈值</label>
                                <input type="number" id="suddenHigh-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="3">
                                </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">识别优先级</label>
                                <input type="number" id="suddenHigh-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="5">
                                </div>
                                </div>

                        <!-- 长期负损参数 -->
                        <div id="longNegativeParams" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">统计周期（天）</label>
                                <input type="number" id="longNegative-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="30">
                            </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">相对线损率阈值（%）</label>
                            <input type="number" id="longNegative-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">异常天数阈值</label>
                            <input type="number" id="longNegative-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="20">
                    </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">识别优先级</label>
                            <input type="number" id="longNegative-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="4">
                </div>
            </div>

                        <!-- 小负损参数 -->
                        <div id="smallNegativeParams" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">统计周期（天）</label>
                                <input type="number" id="smallNegative-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="30">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">最小线损率（%）</label>
                                    <input type="number" id="smallNegative-min" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="-1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">最大线损率（%）</label>
                                    <input type="number" id="smallNegative-max" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="0">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">持续天数阈值</label>
                                <input type="number" id="smallNegative-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="7">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">识别优先级</label>
                                <input type="number" id="smallNegative-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="2">
                            </div>
                        </div>

                        <!-- 突发负损参数 -->
                        <div id="suddenNegativeParams" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">监控周期（天）</label>
                                <input type="number" id="suddenNegative-period" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="7">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">相对线损率阈值（%）</label>
                                <input type="number" id="suddenNegative-threshold" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">线性拟合斜率阈值（%）</label>
                                <input type="number" id="suddenNegative-slope" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="-0.8">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">持续天数阈值</label>
                                <input type="number" id="suddenNegative-days" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="3">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">识别优先级</label>
                                <input type="number" id="suddenNegative-priority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" value="3">
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="px-6 py-3 bg-gray-50 text-right rounded-b-lg">
                        <button id="cancelEdit" class="bg-white border border-gray-300 rounded-md shadow-sm px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 mr-2">
                            取消
                        </button>
                        <button id="saveStandardBtn" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md text-sm font-medium">
                            保存配置
                        </button>
                    </div>
                </div>
            </div>

            <!-- 筛选结果预览模态框 -->
            <div id="previewResultModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl max-w-lg w-full mx-4">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-medium text-gray-900">筛选结果预览</h3>
                        <button id="closePreviewModal" class="text-gray-400 hover:text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <!-- Content previously in #previewContent goes here -->
                        <div class="mb-6">
                            <div class="bg-primary-light rounded-lg p-4 text-center">
                                <p class="text-sm text-gray-600 mb-1">符合条件的台区数量</p>
                                <p class="text-3xl font-bold text-primary">87</p>
                                <p class="text-sm text-gray-500 mt-1">占总台区的 7.0%</p>
                            </div>
                        </div>
                        <div class="mb-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">Top 5 异常台区</h3>
                            <div class="space-y-3">
                                <div class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium">河西变1324台区</span>
                                        <span class="text-sm text-red-500 font-medium">+6.44%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">实际:12.76% / 理论:6.32%</div>
                                </div>
                                <div class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium">城南532台区</span>
                                        <span class="text-sm text-red-500 font-medium">+5.55%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">实际:10.21% / 理论:4.66%</div>
                                </div>
                                <div class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium">北郊198台区</span>
                                        <span class="text-sm text-blue-500 font-medium">-4.24%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">实际:3.21% / 理论:7.45%</div>
                                </div>
                                <div class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium">开发区672台区</span>
                                        <span class="text-sm text-blue-500 font-medium">-3.24%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">实际:2.13% / 理论:5.37%</div>
                                </div>
                                <div class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium">东湖785台区</span>
                                        <span class="text-sm text-blue-500 font-medium">-1.27%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">实际:3.58% / 理论:4.85%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="px-6 py-3 bg-gray-50 text-right rounded-b-lg">
                        <button id="okPreviewModal" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md text-sm font-medium">
                            确定
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 保存配置名称模态框 -->
            <div id="saveConfigModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-medium text-gray-900">保存配置</h3>
                        <button id="closeSaveConfigModal" class="text-gray-400 hover:text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="px-6 py-4">
                        <div class="mb-4">
                            <label for="configName" class="block text-sm font-medium text-gray-700 mb-1">配置名称</label>
                            <input type="text" id="configName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" placeholder="请输入配置名称">
                        </div>
                    </div>
                    <div class="px-6 py-3 bg-gray-50 text-right rounded-b-lg">
                        <button id="cancelSaveConfig" class="bg-white border border-gray-300 rounded-md shadow-sm px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 mr-2">
                            取消
                        </button>
                        <button id="submitSaveConfig" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md text-sm font-medium">
                            保存
                        </button>
                    </div>
                </div>
            </div>

            <!-- 原因统计弹窗 -->
            <div id="reasonStatsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl max-w-7xl w-full mx-4 h-5/6 flex flex-col">
                    <!-- Header -->
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-medium text-gray-900">异常原因统计分析</h3>
                        <button id="closeReasonStatsModal" class="text-gray-400 hover:text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <!-- Content area (scrollable) -->
                    <div class="flex-grow overflow-y-auto p-6">
                        <!-- 桑基图容器 -->
                        <div class="bg-white rounded-lg shadow-sm mb-6">
                            <div class="px-5 py-4 border-b border-gray-200">
                                <h4 class="text-md font-medium text-gray-900">异常类型与诊断原因关联分析</h4>
                                <p class="text-sm text-gray-500 mt-1">连线宽度表示该异常类型下对应原因的台区数量</p>
                            </div>
                            <div class="p-5">
                                <div id="sankeyChart" style="height: 500px;"></div>
                            </div>
                        </div>

                        <!-- 数据统计矩阵 -->
                        <div class="bg-white rounded-lg shadow-sm">
                            <div class="px-5 py-4 border-b border-gray-200">
                                <h4 class="text-md font-medium text-gray-900">详细数据统计矩阵</h4>
                            </div>
                            <div class="p-5">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    异常类型
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    CT互感器倍率错误
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    档案户变关系异常
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    疑似低压窃电
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    采集设备故障
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    电表计量故障
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    计量装置接线错误
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    理论模型计算偏差
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    倍率变更未同步
                                                </th>
                                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    合计
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            <tr>
                                                <td class="px-4 py-3 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                                        长期高损
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-medium">18</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">12</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">8</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">6</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">44</td>
                                            </tr>
                                            <tr>
                                                <td class="px-4 py-3 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">
                                                        突发高损
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">4</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">3</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">2</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-medium">9</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">18</td>
                                            </tr>
                                            <tr>
                                                <td class="px-4 py-3 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                        长期负损
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">3</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-medium">12</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">15</td>
                                            </tr>
                                            <tr>
                                                <td class="px-4 py-3 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-sky-100 text-sky-800">
                                                        小负损
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-medium">8</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">8</td>
                                            </tr>
                                            <tr>
                                                <td class="px-4 py-3 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-indigo-100 text-indigo-800">
                                                        突发负损
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900">1</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">-</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-medium">1</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">2</td>
                                            </tr>
                                            <tr class="bg-gray-50">
                                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                                    合计
                                                </td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">22</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">18</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">10</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">15</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">1</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">12</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">8</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold">1</td>
                                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-900 font-bold text-lg">87</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer -->
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                        <button id="closeReasonStatsModalBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm">
                            关闭
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 下拉菜单行为 (保持现有逻辑)
            const menuButton = document.getElementById('main-menu-button');
            const menuDropdown = document.getElementById('main-menu-dropdown');
            if (menuButton && menuDropdown) {
                menuButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    menuDropdown.classList.toggle('hidden');
                });
                document.addEventListener('click', function(e) {
                    if (!menuButton.contains(e.target) && !menuDropdown.contains(e.target)) {
                        menuDropdown.classList.add('hidden');
                    }
                });
                menuDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }

            // 高级筛选折叠功能
            const advancedFilterToggle = document.getElementById('advancedFilterToggle');
            const advancedFilterContent = document.getElementById('advancedFilterContent');
            const advancedFilterIcon = document.getElementById('advancedFilterIcon');
            
            if (advancedFilterToggle && advancedFilterContent && advancedFilterIcon) {
                advancedFilterToggle.addEventListener('click', function() {
                    const isHidden = advancedFilterContent.classList.contains('hidden');
                    
                    if (isHidden) {
                        advancedFilterContent.classList.remove('hidden');
                        advancedFilterIcon.classList.add('rotate-180');
                    } else {
                        advancedFilterContent.classList.add('hidden');
                        advancedFilterIcon.classList.remove('rotate-180');
                    }
                });
            }

            // 筛选功能实现
            const applyFiltersBtn = document.getElementById('applyFilters');
            const resetFiltersBtn = document.getElementById('resetFilters');
            const stationNameInput = document.querySelector('input[placeholder="输入台区名称搜索..."]');
            
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', function() {
                    applyFilters();
                });
            }
            
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', function() {
                    resetAllFilters();
                });
            }

            // 台区名称实时搜索
            if (stationNameInput) {
                stationNameInput.addEventListener('input', function() {
                    const searchTerm = this.value.trim().toLowerCase();
                    const tableRows = document.querySelectorAll('.min-w-full tbody tr');
                    
                    tableRows.forEach(row => {
                        const stationNameCell = row.querySelector('td:first-child');
                        if (stationNameCell) {
                            const stationName = stationNameCell.textContent.toLowerCase();
                            if (searchTerm === '' || stationName.includes(searchTerm)) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        }
                    });
                    
                    // 显示搜索结果数量
                    if (searchTerm) {
                        const visibleRows = document.querySelectorAll('.min-w-full tbody tr:not([style*="display: none"])').length;
                        updateResultCounter(visibleRows);
                    } else {
                        updateResultCounter(tableRows.length);
                    }
                });
            }

            // 应用筛选逻辑
            function applyFilters() {
                const filters = collectFilterValues();
                filterTable(filters);
                
                // 显示筛选结果提示
                const resultCount = document.querySelectorAll('.min-w-full tbody tr:not([style*="display: none"])').length;
                showFilterResultToast(resultCount);
            }

            // 收集所有筛选条件
            function collectFilterValues() {
                return {
                    // 基础筛选
                    stationName: document.querySelector('input[placeholder="输入台区名称搜索..."]')?.value.trim() || '',
                    area: document.querySelector('select').value,
                    anomalyType: document.querySelectorAll('select')[1]?.value,
                    dateFrom: document.querySelector('input[type="date"]')?.value,
                    dateTo: document.querySelectorAll('input[type="date"]')[1]?.value,
                    
                    // 数值区间筛选
                    actualLossRateMin: parseFloat(document.querySelectorAll('input[placeholder="最小值"]')[0]?.value) || null,
                    actualLossRateMax: parseFloat(document.querySelectorAll('input[placeholder="最大值"]')[0]?.value) || null,
                    theoreticalLossRateMin: parseFloat(document.querySelectorAll('input[placeholder="最小值"]')[1]?.value) || null,
                    theoreticalLossRateMax: parseFloat(document.querySelectorAll('input[placeholder="最大值"]')[1]?.value) || null,
                    lossDifferenceMin: parseFloat(document.querySelectorAll('input[placeholder="最小值"]')[2]?.value) || null,
                    lossDifferenceMax: parseFloat(document.querySelectorAll('input[placeholder="最大值"]')[2]?.value) || null,
                    totalPowerMin: parseFloat(document.querySelectorAll('input[placeholder="最小值"]')[3]?.value) || null,
                    totalPowerMax: parseFloat(document.querySelectorAll('input[placeholder="最大值"]')[3]?.value) || null,
                    usagePowerMin: parseFloat(document.querySelectorAll('input[placeholder="最小值"]')[4]?.value) || null,
                    usagePowerMax: parseFloat(document.querySelectorAll('input[placeholder="最大值"]')[4]?.value) || null,
                    lossPowerMin: parseFloat(document.querySelectorAll('input[placeholder="最小值"]')[5]?.value) || null,
                    lossPowerMax: parseFloat(document.querySelectorAll('input[placeholder="最大值"]')[5]?.value) || null,
                    deviationLossPowerMin: parseFloat(document.querySelectorAll('input[placeholder="最小值"]')[6]?.value) || null,
                    deviationLossPowerMax: parseFloat(document.querySelectorAll('input[placeholder="最大值"]')[6]?.value) || null,
                    abnormalDaysMin: parseInt(document.querySelectorAll('input[placeholder="最小值"]')[7]?.value) || null,
                    abnormalDaysMax: parseInt(document.querySelectorAll('input[placeholder="最大值"]')[7]?.value) || null,
                    
                    // 其他筛选
                    governanceStatus: document.querySelector('#advancedFilterContent select')?.value,
                    renewableEnergy: document.querySelector('#advancedFilterContent select:nth-of-type(2)')?.value,
                    sortBy: document.querySelector('#advancedFilterContent select:nth-of-type(3)')?.value
                };
            }

            // 表格筛选逻辑
            function filterTable(filters) {
                const tableRows = document.querySelectorAll('.min-w-full tbody tr');
                
                tableRows.forEach(row => {
                    let shouldShow = true;
                    
                    // 台区名称筛选
                    if (filters.stationName) {
                        const stationNameCell = row.querySelector('td:first-child');
                        if (stationNameCell && !stationNameCell.textContent.toLowerCase().includes(filters.stationName.toLowerCase())) {
                            shouldShow = false;
                        }
                    }
                    
                    // 所属区域筛选
                    if (filters.area && filters.area !== '全部区域') {
                        const areaCell = row.querySelector('td:nth-child(2)');
                        if (areaCell && !areaCell.textContent.includes(filters.area.replace('区', ''))) {
                            shouldShow = false;
                        }
                    }
                    
                    // 异常类型筛选
                    if (filters.anomalyType && filters.anomalyType !== '全部异常') {
                        const anomalyCell = row.querySelector('td:nth-child(11) span');
                        if (anomalyCell && anomalyCell.textContent.trim() !== filters.anomalyType) {
                            shouldShow = false;
                        }
                    }
                    
                    // 数值区间筛选
                    if (shouldShow && filters.actualLossRateMin !== null) {
                        const actualLossRate = parseFloat(row.querySelector('td:nth-child(3)').textContent.replace('%', ''));
                        if (actualLossRate < filters.actualLossRateMin) {
                            shouldShow = false;
                        }
                    }
                    
                    if (shouldShow && filters.actualLossRateMax !== null) {
                        const actualLossRate = parseFloat(row.querySelector('td:nth-child(3)').textContent.replace('%', ''));
                        if (actualLossRate > filters.actualLossRateMax) {
                            shouldShow = false;
                        }
                    }
                    
                    // 理论线损率筛选
                    if (shouldShow && filters.theoreticalLossRateMin !== null) {
                        const theoreticalLossRate = parseFloat(row.querySelector('td:nth-child(4)').textContent.replace('%', ''));
                        if (theoreticalLossRate < filters.theoreticalLossRateMin) {
                            shouldShow = false;
                        }
                    }
                    
                    if (shouldShow && filters.theoreticalLossRateMax !== null) {
                        const theoreticalLossRate = parseFloat(row.querySelector('td:nth-child(4)').textContent.replace('%', ''));
                        if (theoreticalLossRate > filters.theoreticalLossRateMax) {
                            shouldShow = false;
                        }
                    }
                    
                    // 线损差值筛选
                    if (shouldShow && (filters.lossDifferenceMin !== null || filters.lossDifferenceMax !== null)) {
                        const lossDifference = parseFloat(row.querySelector('td:nth-child(5)').textContent.replace(/[+%]/g, ''));
                        if (filters.lossDifferenceMin !== null && lossDifference < filters.lossDifferenceMin) {
                            shouldShow = false;
                        }
                        if (filters.lossDifferenceMax !== null && lossDifference > filters.lossDifferenceMax) {
                            shouldShow = false;
                        }
                    }
                    
                    // 总表电量筛选
                    if (shouldShow && (filters.totalPowerMin !== null || filters.totalPowerMax !== null)) {
                        const totalPower = parseFloat(row.querySelector('td:nth-child(6)').textContent.replace(/,/g, ''));
                        if (filters.totalPowerMin !== null && totalPower < filters.totalPowerMin) {
                            shouldShow = false;
                        }
                        if (filters.totalPowerMax !== null && totalPower > filters.totalPowerMax) {
                            shouldShow = false;
                        }
                    }
                    
                    // 异常天数筛选
                    if (shouldShow && (filters.abnormalDaysMin !== null || filters.abnormalDaysMax !== null)) {
                        const abnormalDays = parseInt(row.querySelector('td:nth-child(12)').textContent.replace('天', ''));
                        if (filters.abnormalDaysMin !== null && abnormalDays < filters.abnormalDaysMin) {
                            shouldShow = false;
                        }
                        if (filters.abnormalDaysMax !== null && abnormalDays > filters.abnormalDaysMax) {
                            shouldShow = false;
                        }
                    }
                    
                    // 治理状态筛选
                    if (shouldShow && filters.governanceStatus && filters.governanceStatus !== '全部状态') {
                        const governanceCell = row.querySelector('td:nth-child(13)');
                        if (governanceCell && governanceCell.textContent.trim() !== filters.governanceStatus) {
                            shouldShow = false;
                        }
                    }
                    
                    // 可再生能源筛选
                    if (shouldShow && filters.renewableEnergy && filters.renewableEnergy !== '全部') {
                        const renewableCell = row.querySelector('td:nth-child(14)');
                        if (renewableCell && renewableCell.textContent.trim() !== filters.renewableEnergy) {
                            shouldShow = false;
                        }
                    }
                    
                    // 显示或隐藏行
                    row.style.display = shouldShow ? '' : 'none';
                });
            }

            // 重置所有筛选条件
            function resetAllFilters() {
                // 重置基础筛选
                document.querySelector('input[placeholder="输入台区名称搜索..."]').value = '';
                document.querySelector('select').selectedIndex = 0;
                document.querySelectorAll('select')[1].selectedIndex = 0;
                document.querySelectorAll('input[type="date"]').forEach(input => input.value = '');
                
                // 重置高级筛选
                document.querySelectorAll('#advancedFilterContent input[type="number"]').forEach(input => input.value = '');
                document.querySelectorAll('#advancedFilterContent select').forEach(select => select.selectedIndex = 0);
                
                // 显示所有行
                document.querySelectorAll('.min-w-full tbody tr').forEach(row => {
                    row.style.display = '';
                });
                
                // 收起高级筛选
                if (advancedFilterContent && !advancedFilterContent.classList.contains('hidden')) {
                    advancedFilterContent.classList.add('hidden');
                    advancedFilterIcon.classList.remove('rotate-180');
                }
                
                showFilterResultToast('已重置筛选条件');
            }

            // 更新结果计数器
            function updateResultCounter(count) {
                const counterElement = document.querySelector('.text-sm.text-gray-700');
                if (counterElement) {
                    counterElement.innerHTML = `共 <span class="font-medium">${count}</span> 个异常台区`;
                }
            }

            // 显示筛选结果提示
            function showFilterResultToast(message) {
                // 创建提示框
                const toast = document.createElement('div');
                toast.className = 'fixed top-20 right-4 bg-primary text-white px-4 py-2 rounded-md shadow-lg z-50 text-sm';
                
                if (typeof message === 'number') {
                    toast.textContent = `筛选完成，找到 ${message} 条符合条件的记录`;
                    updateResultCounter(message);
                } else {
                    toast.textContent = message;
                }
                
                document.body.appendChild(toast);
                
                // 3秒后自动消失
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 3000);
            }

            // 键盘快捷键支持
            document.addEventListener('keydown', function(e) {
                // Ctrl+F 或 Cmd+F 聚焦到台区名称搜索框
                if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                    e.preventDefault();
                    if (stationNameInput) {
                        stationNameInput.focus();
                        stationNameInput.select();
                    }
                }
                
                // Enter 键执行查询
                if (e.key === 'Enter' && document.activeElement.tagName !== 'BUTTON') {
                    if (applyFiltersBtn) {
                        applyFiltersBtn.click();
                    }
                }
                
                // Escape 键重置筛选
                if (e.key === 'Escape') {
                    if (resetFiltersBtn) {
                        resetFiltersBtn.click();
                    }
                }
            });

            // 添加治理状态标签页事件监听
            const governanceStatusTabs = document.querySelectorAll('.mb-4.border-b.border-gray-200 button');
            if (governanceStatusTabs.length > 0) {
                governanceStatusTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // 移除所有标签页的激活状态
                        governanceStatusTabs.forEach(t => {
                            t.classList.remove('border-primary', 'text-primary');
                            t.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                        });
                        
                        // 添加点击标签页的激活状态
                        this.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                        this.classList.add('border-primary', 'text-primary');
                        
                        // 根据选中的标签页筛选表格
                        const status = this.textContent.trim();
                        filterTableByGovernanceStatus(status);
                    });
                });
            }
            
            // 根据治理状态筛选表格的函数
            function filterTableByGovernanceStatus(status) {
                const tableRows = document.querySelectorAll('.min-w-full tbody tr');
                
                tableRows.forEach(row => {
                    const governanceStatusCell = row.querySelector('td:nth-child(13)'); // 调整索引如果需要
                    
                    if (governanceStatusCell) {
                        const rowStatus = governanceStatusCell.textContent.trim();
                        
                        if (status === '全部状态' || rowStatus === status) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                });
            }

            // 初始化Choices.js多选下拉菜单
            const choicesConfig = {
                removeItemButton: true,
                searchEnabled: true,
                placeholder: true,
                placeholderValue: '请选择...', // Customize placeholder
                // Add more Choices.js config options if needed
            };

            const capacitySelect = document.getElementById('capacity');
            if (capacitySelect) new Choices(capacitySelect, choicesConfig);

            const loadTypeSelect = document.getElementById('loadType');
            if (loadTypeSelect) new Choices(loadTypeSelect, choicesConfig);

            // Special config for area dropdown to handle optgroups
            const areaSelect = document.getElementById('area');
            if (areaSelect) {
                const areaChoices = new Choices(areaSelect, {
                    ...choicesConfig,
                    renderSelectedChoices: 'always',
                    renderChoiceLimit: -1,
                    // Make sure the parent optgroup state is updated when children are selected
                    callbackOnCreateTemplates: function(template) {
                        return {
                            item: (classNames, data) => {
                                const itemHtml = template(`
                                <div class="${classNames.item} ${
                                    data.highlighted ? classNames.highlightedState : classNames.itemSelectable
                                } ${
                                    data.placeholder ? classNames.placeholder : ''
                                }" data-item data-id="${data.id}" data-value="${data.value}" ${
                                    data.active ? 'aria-selected="true"' : ''
                                } ${
                                    data.disabled ? 'aria-disabled="true"' : ''
                                }>
                                    <span class="choices__item-text">${data.label.replace(/东区|西区|南区|北区|开发区/g, match => `<strong>${match}</strong>`)}</span>
                                    ${
                                    data.removeButton ? `
                                    <button type="button" class="${classNames.button}" data-button aria-label="Remove item">
                                        Remove item
                                    </button>
                                    ` : ''
                                    }
                                </div>
                                `);
                                return itemHtml;
                            }
                        };
                    }
                });
                
                // Handle special case of selecting "全部区域"
                areaSelect.addEventListener('change', function() {
                    const allOption = this.querySelector('option[value="all"]');
                    const otherOptions = Array.from(this.querySelectorAll('option:not([value="all"])'));
                    
                    // If "all" is selected, select/deselect all other options
                    if (allOption && allOption.selected) {
                        otherOptions.forEach(option => {
                            option.selected = true;
                        });
                        // Force Choices.js to update
                        areaChoices.setChoiceByValue(otherOptions.map(o => o.value));
                    }
                    
                    // Handle optgroup selection logic
                    const optgroups = Array.from(this.querySelectorAll('optgroup'));
                    optgroups.forEach(group => {
                        const groupLabel = group.getAttribute('label');
                        const groupOptions = Array.from(group.querySelectorAll('option'));
                        const allSelected = groupOptions.every(o => o.selected);
                        
                        // Update visual representation in the dropdown
                        const itemElement = document.querySelector(`.choices__item[data-value="${groupLabel}"]`);
                        if (itemElement) {
                            if (allSelected) {
                                itemElement.classList.add('is-highlighted');
                            } else {
                                itemElement.classList.remove('is-highlighted');
                            }
                        }
                    });
                });
            }

            const stationSelect = document.getElementById('station');
            if (stationSelect) new Choices(stationSelect, choicesConfig);

            const renewableEnergySelect = document.getElementById('renewable-energy');
            if (renewableEnergySelect) new Choices(renewableEnergySelect, choicesConfig);

            // Remove old tab switching code
            
            // Add Filter Configuration Modal functionality
            const openFilterConfigBtn = document.getElementById('openFilterConfigBtn');
            const filterConfigModal = document.getElementById('filterConfigModal');
            const closeFilterConfigModal = document.getElementById('closeFilterConfigModal');
            
            // Modal Tab Navigation
            const modalTabStandards = document.getElementById('modal-tab-standards');
            const modalTabAdvancedFilters = document.getElementById('modal-tab-advanced-filters');
            const modalContentStandards = document.getElementById('modal-content-standards');
            const modalContentAdvancedFilters = document.getElementById('modal-content-advanced-filters');
            
            // Open Modal
            if (openFilterConfigBtn && filterConfigModal) {
                openFilterConfigBtn.addEventListener('click', function() {
                    filterConfigModal.classList.remove('hidden');
                });
            }
            
            // Close Modal
            if (closeFilterConfigModal && filterConfigModal) {
                closeFilterConfigModal.addEventListener('click', function() {
                    filterConfigModal.classList.add('hidden');
                });
                
                // Close on click outside the modal content
                filterConfigModal.addEventListener('click', function(e) {
                    if (e.target === filterConfigModal) {
                        filterConfigModal.classList.add('hidden');
                    }
                });
            }
            
            // Modal Tab Switching
            if (modalTabStandards && modalTabAdvancedFilters && modalContentStandards && modalContentAdvancedFilters) {
                modalTabStandards.addEventListener('click', function() {
                    // Update tab appearance
                    modalTabStandards.classList.add('border-primary', 'text-primary');
                    modalTabStandards.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    modalTabAdvancedFilters.classList.remove('border-primary', 'text-primary');
                    modalTabAdvancedFilters.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    
                    // Show/hide content
                    modalContentStandards.classList.remove('hidden');
                    modalContentAdvancedFilters.classList.add('hidden');
                });
                
                modalTabAdvancedFilters.addEventListener('click', function() {
                    // Update tab appearance
                    modalTabAdvancedFilters.classList.add('border-primary', 'text-primary');
                    modalTabAdvancedFilters.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    modalTabStandards.classList.remove('border-primary', 'text-primary');
                    modalTabStandards.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    
                    // Show/hide content
                    modalContentAdvancedFilters.classList.remove('hidden');
                    modalContentStandards.classList.add('hidden');
                });
            }

            // --- Keep existing edit modal and other functionality ---
            // Standard Edit Modal Logic
            const editStandardModal = document.getElementById('editStandardModal'); 
            const editStandardBtns = document.querySelectorAll('.edit-standard-btn');
            const closeModalBtn = document.getElementById('closeModal');
            const cancelEditBtn = document.getElementById('cancelEdit');
            const saveStandardBtn = document.getElementById('saveStandardBtn');
            const standardTypeInput = document.getElementById('standardType');
            const modalTitle = document.getElementById('modalTitle');
            
            const paramContainers = {
                longHigh: document.getElementById('longHighParams'),
                suddenHigh: document.getElementById('suddenHighParams'),
                longNegative: document.getElementById('longNegativeParams'),
                smallNegative: document.getElementById('smallNegativeParams'),
                suddenNegative: document.getElementById('suddenNegativeParams')
            };
            
            const standardNames = {
                longHigh: '长期高损',
                suddenHigh: '突发高损',
                longNegative: '长期负损',
                smallNegative: '小负损',
                suddenNegative: '突发负损'
            };
            
            if (editStandardModal && editStandardBtns.length > 0 && closeModalBtn && cancelEditBtn && saveStandardBtn && standardTypeInput && modalTitle) {
                // 点击编辑按钮
                editStandardBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const standardType = this.getAttribute('data-standard');
                        standardTypeInput.value = standardType;
                        modalTitle.textContent = '编辑' + standardNames[standardType] + '识别标准';
                        
                        Object.values(paramContainers).forEach(container => {
                            if (container) container.classList.add('hidden');
                        });
                        
                        if (paramContainers[standardType]) {
                            paramContainers[standardType].classList.remove('hidden');
                        }
                        
                        editStandardModal.classList.remove('hidden');
                    });
                });
                
                // 关闭模态框
                function closeModal() {
                    editStandardModal.classList.add('hidden');
                }
                
                closeModalBtn.addEventListener('click', closeModal);
                cancelEditBtn.addEventListener('click', closeModal);
                editStandardModal.addEventListener('click', function(e) {
                    if (e.target === editStandardModal) {
                        closeModal();
                    }
                });
                
                // 保存标准配置
                saveStandardBtn.addEventListener('click', function() {
                    const standardType = standardTypeInput.value;
                    const formData = {};
                    const currentParamsContainer = paramContainers[standardType];

                    if (currentParamsContainer) {
                        const inputs = currentParamsContainer.querySelectorAll('input[type="number"]');
                        inputs.forEach(input => {
                            const key = input.id.split('-')[1]; 
                            if (key) {
                                formData[key] = input.value;
                            }
                        });
                    }
                    
                    console.log('Saving standard:', standardType, formData);
                    updateTableDisplay(standardType, formData); 
                    closeModal();
                    alert('标准配置已保存');
                });
            }

            // 更新表格中的标准显示
            function updateTableDisplay(standardType, formData) {
                // Find the correct tab content
                const modalContent = document.getElementById('modal-content-standards');
                if (!modalContent) return;
                
                const rows = modalContent.querySelectorAll('tbody tr');
                let row;
                
                rows.forEach(r => {
                    const btn = r.querySelector('.edit-standard-btn');
                    if (btn && btn.getAttribute('data-standard') === standardType) {
                        row = r;
                    }
                });
                
                if (!row || !formData) return;
                
                const standardCell = row.querySelector('td:nth-child(3)');
                const priorityCell = row.querySelector('td:nth-child(4)');
                
                if (standardCell && priorityCell) {
                    priorityCell.textContent = formData.priority || '';
                    
                    switch(standardType) {
                        case 'longHigh':
                            standardCell.textContent = `近${formData.period || 'N/A'}天内【相对线损率】${formData.threshold || 'N/A'}%以上的异常天数≥${formData.days || 'N/A'}天`;
                            break;
                        case 'suddenHigh':
                            standardCell.textContent = `近${formData.period || 'N/A'}天【相对线损率】突然升高至${formData.threshold || 'N/A'}%以上，且持续${formData.days || 'N/A'}天以上`;
                            break;
                        case 'longNegative':
                            standardCell.textContent = `近${formData.period || 'N/A'}天内【相对线损率】${formData.threshold || 'N/A'}%以下的异常天数≥${formData.days || 'N/A'}天`;
                            break;
                        case 'smallNegative':
                            standardCell.textContent = `近${formData.period || 'N/A'}天内，【相对线损率】线损率在${formData.min || 'N/A'}%~${formData.max || 'N/A'}%之间，持续${formData.days || 'N/A'}天以上`;
                            break;
                        case 'suddenNegative':
                            standardCell.textContent = `近${formData.period || 'N/A'}天【相对线损率】突然降低至${formData.threshold || 'N/A'}%以下，且持续${formData.days || 'N/A'}天以上`;
                            break;
                    }
                }
            }
             
            // --- Preview Button Logic ---
            const previewButton = document.getElementById('addMoreConditions'); 
            if (previewButton) {
                previewButton.addEventListener('click', function() {
                    alert('添加更多筛选条件功能待实现');
                });
            }

            // 保存配置按钮点击事件 (moved to modal footer)
            const saveConfigBtn = document.getElementById('saveConfig');
            if (saveConfigBtn) {
                saveConfigBtn.addEventListener('click', function() {
                    // Show modal for saving configuration with name
                    const saveConfigModal = document.getElementById('saveConfigModal');
                    if (saveConfigModal) {
                        saveConfigModal.classList.remove('hidden');
                    }
                });
            }
            
            // 保存配置模态框逻辑
            const saveConfigModal = document.getElementById('saveConfigModal');
            const closeSaveConfigModalBtn = document.getElementById('closeSaveConfigModal');
            const cancelSaveConfigBtn = document.getElementById('cancelSaveConfig');
            const submitSaveConfigBtn = document.getElementById('submitSaveConfig');
            const configNameInput = document.getElementById('configName');
            
            if (saveConfigModal && closeSaveConfigModalBtn && cancelSaveConfigBtn && submitSaveConfigBtn && configNameInput) {
                // Close modal function
                function closeSaveConfigModal() {
                    saveConfigModal.classList.add('hidden');
                    configNameInput.value = ''; // Clear input when closing
                }
                
                // Close via X button
                closeSaveConfigModalBtn.addEventListener('click', closeSaveConfigModal);
                // Close via Cancel button
                cancelSaveConfigBtn.addEventListener('click', closeSaveConfigModal);
                // Close by clicking outside
                saveConfigModal.addEventListener('click', function(e) {
                    if (e.target === saveConfigModal) {
                        closeSaveConfigModal();
                    }
                });
                
                // Submit save configuration
                submitSaveConfigBtn.addEventListener('click', function() {
                    const configName = configNameInput.value.trim();
                    if (!configName) {
                        alert('请输入配置名称');
                        return;
                    }
                    
                    // Collect config
                    const activeConfig = {
                        name: configName,
                        timestamp: new Date().toISOString()
                    };
                    
                    // Collect filters from both tabs
                    // For standards tab
                    const standardsContent = document.getElementById('modal-content-standards');
                    if (standardsContent) {
                        // Collect standards configuration
                        const standardsData = [];
                        const rows = standardsContent.querySelectorAll('tbody tr');
                        rows.forEach(row => {
                            const typeCell = row.querySelector('td:nth-child(1) span');
                            const standardCell = row.querySelector('td:nth-child(3)');
                            const priorityCell = row.querySelector('td:nth-child(4)');
                            
                            if (typeCell && standardCell && priorityCell) {
                                standardsData.push({
                                    type: typeCell.textContent.trim(),
                                    standard: standardCell.textContent.trim(),
                                    priority: priorityCell.textContent.trim()
                                });
                            }
                        });
                        activeConfig.standards = standardsData;
                    }
                    
                    // For advanced filters tab
                    const advancedContent = document.getElementById('modal-content-advanced-filters');
                    if (advancedContent) {
                        // Collect values from advanced filters
                        activeConfig.capacity = document.getElementById('capacity')?.value;
                        activeConfig.loadType = document.getElementById('loadType')?.value;
                        activeConfig.area = document.getElementById('area')?.value;
                        activeConfig.station = document.getElementById('station')?.value;
                        activeConfig.renewableEnergy = document.getElementById('renewable-energy')?.value;
                        activeConfig.excludeDataError = document.getElementById('exclude-data-error')?.checked;
                        activeConfig.excludeSupplyError = document.getElementById('exclude-supply-error')?.checked;
                        activeConfig.excludeUsageError = document.getElementById('exclude-usage-error')?.checked;
                        activeConfig.excludeRecentZero = document.getElementById('exclude-recent-zero')?.checked;
                        activeConfig.excludeCollectFail = document.getElementById('exclude-collect-fail')?.checked;
                    }
                    
                    console.log('Saving config:', activeConfig);
                    alert(`配置"${configName}"已保存`);
                    closeSaveConfigModal();
                    
                    // Also close the main config modal
                    if (filterConfigModal) {
                        filterConfigModal.classList.add('hidden');
                    }
                });
            }
            
            // 重置为默认值按钮点击事件
            const resetToDefaultBtn = document.getElementById('resetToDefault');
            if (resetToDefaultBtn) {
                resetToDefaultBtn.addEventListener('click', function() {
                    if (confirm('确定要重置为默认识别标准吗？')) {
                        console.log('Resetting to default standards');
                        
                        // Example of default values (you would replace these with actual defaults)
                        const defaultStandards = {
                            longHigh: {period: 30, threshold: 5, days: 20, priority: 1},
                            suddenHigh: {period: 7, threshold: 5, days: 3, priority: 5},
                            longNegative: {period: 30, threshold: 0, days: 20, priority: 4},
                            smallNegative: {period: 30, min: -1, max: 0, days: 7, priority: 2},
                            suddenNegative: {period: 7, threshold: 0, days: 3, priority: 3}
                        };
                        
                        // Update displayed standards
                        Object.entries(defaultStandards).forEach(([type, values]) => {
                            updateTableDisplay(type, values);
                        });
                        
                        // Reset advanced filters
                        if (document.getElementById('capacity')) new Choices(document.getElementById('capacity')).removeActiveItems();
                        if (document.getElementById('loadType')) new Choices(document.getElementById('loadType')).removeActiveItems();
                        if (document.getElementById('area')) new Choices(document.getElementById('area')).removeActiveItems();
                        if (document.getElementById('station')) new Choices(document.getElementById('station')).removeActiveItems();
                        if (document.getElementById('renewable-energy')) new Choices(document.getElementById('renewable-energy')).removeActiveItems();
                        
                        // Reset checkboxes
                        const checkboxes = ['exclude-data-error', 'exclude-supply-error', 'exclude-usage-error', 'exclude-recent-zero', 'exclude-collect-fail'];
                        checkboxes.forEach(id => {
                            const checkbox = document.getElementById(id);
                            if (checkbox) checkbox.checked = false;
                        });
                        
                        alert('已重置为默认识别标准');
                    }
                });
            }

            // 报表切换功能 (Inside 异常台区报表 Tab)
            const reportButtons = document.querySelectorAll('.flex.space-x-2 button');
            if (reportButtons.length > 0) {
                reportButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        reportButtons.forEach(b => {
                            b.classList.remove('bg-primary', 'text-white');
                            b.classList.add('bg-gray-100', 'text-gray-700');
                        });
                        this.classList.remove('bg-gray-100', 'text-gray-700');
                        this.classList.add('bg-primary', 'text-white');
                    });
                });
            }

            // 原因统计弹窗功能
            const openReasonStatsBtn = document.getElementById('openReasonStatsBtn');
            const reasonStatsModal = document.getElementById('reasonStatsModal');
            const closeReasonStatsModal = document.getElementById('closeReasonStatsModal');
            const closeReasonStatsModalBtn = document.getElementById('closeReasonStatsModalBtn');

            // 桑基图实例
            let sankeyChart = null;

            if (openReasonStatsBtn && reasonStatsModal) {
                openReasonStatsBtn.addEventListener('click', function() {
                    reasonStatsModal.classList.remove('hidden');
                    // 延迟初始化图表以确保容器已显示
                    setTimeout(initSankeyChart, 100);
                });
            }

            if (closeReasonStatsModal && reasonStatsModal) {
                closeReasonStatsModal.addEventListener('click', function() {
                    reasonStatsModal.classList.add('hidden');
                });
            }

            if (closeReasonStatsModalBtn && reasonStatsModal) {
                closeReasonStatsModalBtn.addEventListener('click', function() {
                    reasonStatsModal.classList.add('hidden');
                });
            }

            // 点击外部关闭弹窗
            if (reasonStatsModal) {
                reasonStatsModal.addEventListener('click', function(e) {
                    if (e.target === reasonStatsModal) {
                        reasonStatsModal.classList.add('hidden');
                    }
                });
            }

            // 初始化桑基图
            function initSankeyChart() {
                const chartContainer = document.getElementById('sankeyChart');
                if (!chartContainer) return;

                // 销毁已存在的图表实例
                if (sankeyChart) {
                    sankeyChart.dispose();
                }

                sankeyChart = echarts.init(chartContainer);

                // 桑基图数据
                const sankeyData = {
                    nodes: [
                        // 异常类型节点（左侧）
                        { name: '长期高损', category: 0, value: 44, itemStyle: { color: '#FEE2E2' } },
                        { name: '突发高损', category: 0, value: 18, itemStyle: { color: '#FED7AA' } },
                        { name: '长期负损', category: 0, value: 15, itemStyle: { color: '#DBEAFE' } },
                        { name: '小负损', category: 0, value: 8, itemStyle: { color: '#E0F2FE' } },
                        { name: '突发负损', category: 0, value: 2, itemStyle: { color: '#E0E7FF' } },
                        
                        // 诊断原因节点（右侧）
                        { name: 'CT互感器倍率错误', category: 1, value: 22, itemStyle: { color: '#F3F4F6' } },
                        { name: '档案户变关系异常', category: 1, value: 18, itemStyle: { color: '#F3F4F6' } },
                        { name: '采集设备故障', category: 1, value: 15, itemStyle: { color: '#F3F4F6' } },
                        { name: '计量装置接线错误', category: 1, value: 12, itemStyle: { color: '#F3F4F6' } },
                        { name: '疑似低压窃电', category: 1, value: 10, itemStyle: { color: '#F3F4F6' } },
                        { name: '理论模型计算偏差', category: 1, value: 8, itemStyle: { color: '#F3F4F6' } },
                        { name: '电表计量故障', category: 1, value: 1, itemStyle: { color: '#F3F4F6' } },
                        { name: '倍率变更未同步', category: 1, value: 1, itemStyle: { color: '#F3F4F6' } }
                    ],
                    links: [
                        // 长期高损的连接
                        { source: '长期高损', target: 'CT互感器倍率错误', value: 18 },
                        { source: '长期高损', target: '档案户变关系异常', value: 12 },
                        { source: '长期高损', target: '疑似低压窃电', value: 8 },
                        { source: '长期高损', target: '采集设备故障', value: 6 },
                        
                        // 突发高损的连接
                        { source: '突发高损', target: '采集设备故障', value: 9 },
                        { source: '突发高损', target: 'CT互感器倍率错误', value: 4 },
                        { source: '突发高损', target: '档案户变关系异常', value: 3 },
                        { source: '突发高损', target: '疑似低压窃电', value: 2 },
                        
                        // 长期负损的连接
                        { source: '长期负损', target: '计量装置接线错误', value: 12 },
                        { source: '长期负损', target: '档案户变关系异常', value: 3 },
                        
                        // 小负损的连接
                        { source: '小负损', target: '理论模型计算偏差', value: 8 },
                        
                        // 突发负损的连接
                        { source: '突发负损', target: '电表计量故障', value: 1 },
                        { source: '突发负损', target: '倍率变更未同步', value: 1 }
                    ]
                };

                const option = {
                    title: {
                        text: '',
                        left: 'center',
                        textStyle: {
                            fontSize: 16,
                            fontWeight: 'normal'
                        }
                    },
                    tooltip: {
                        trigger: 'item',
                        triggerOn: 'mousemove',
                        formatter: function(params) {
                            if (params.dataType === 'edge') {
                                return `${params.data.source} → ${params.data.target}<br/>台区数量: ${params.data.value}`;
                            } else {
                                return `${params.data.name}<br/>总计: ${params.data.value} 个台区`;
                            }
                        }
                    },
                    series: [{
                        type: 'sankey',
                        data: sankeyData.nodes,
                        links: sankeyData.links,
                        nodeWidth: 20,
                        nodeGap: 8,
                        layoutIterations: 0,
                        focusNodeAdjacency: 'allEdges',
                        levels: [
                            {
                                depth: 0,
                                itemStyle: {
                                    color: '#5470c6'
                                },
                                lineStyle: {
                                    color: 'gradient',
                                    opacity: 0.6
                                }
                            },
                            {
                                depth: 1,
                                itemStyle: {
                                    color: '#91cc75'
                                },
                                lineStyle: {
                                    color: 'gradient',
                                    opacity: 0.6
                                }
                            }
                        ],
                        lineStyle: {
                            curveness: 0.5,
                            opacity: 0.6
                        },
                        itemStyle: {
                            borderWidth: 1,
                            borderColor: '#aaa'
                        },
                        label: {
                            show: true,
                            position: 'right',
                            fontSize: 12,
                            fontWeight: 'normal'
                        },
                        emphasis: {
                            focus: 'adjacency',
                            lineStyle: {
                                opacity: 0.8
                            }
                        }
                    }]
                };

                sankeyChart.setOption(option);

                // 响应式调整
                window.addEventListener('resize', function() {
                    if (sankeyChart) {
                        sankeyChart.resize();
                    }
                });
            }
        });
    </script>
</body>
</html>